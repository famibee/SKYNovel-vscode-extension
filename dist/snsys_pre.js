var w=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function S(r){return typeof r=="string"&&w.test(r)}var v=S;var l=[];for(let r=0;r<256;++r)l.push((r+256).toString(16).slice(1));function b(r,t=0){return l[r[t+0]]+l[r[t+1]]+l[r[t+2]]+l[r[t+3]]+"-"+l[r[t+4]]+l[r[t+5]]+"-"+l[r[t+6]]+l[r[t+7]]+"-"+l[r[t+8]]+l[r[t+9]]+"-"+l[r[t+10]]+l[r[t+11]]+l[r[t+12]]+l[r[t+13]]+l[r[t+14]]+l[r[t+15]]}function D(r){if(!v(r))throw TypeError("Invalid UUID");let t,e=new Uint8Array(16);return e[0]=(t=parseInt(r.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(r.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(r.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(r.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(r.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}var I=D;function T(r){r=unescape(encodeURIComponent(r));let t=[];for(let e=0;e<r.length;++e)t.push(r.charCodeAt(e));return t}var C="6ba7b810-9dad-11d1-80b4-00c04fd430c8",E="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function g(r,t,e){function u(n,s,o,i){var a;if(typeof n=="string"&&(n=T(n)),typeof s=="string"&&(s=I(s)),((a=s)===null||a===void 0?void 0:a.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+n.length);if(f.set(s),f.set(n,s.length),f=e(f),f[6]=f[6]&15|t,f[8]=f[8]&63|128,o){i=i||0;for(let x=0;x<16;++x)o[i+x]=f[x];return o}return b(f)}try{u.name=r}catch{}return u.DNS=C,u.URL=E,u}function K(r,t,e,u){switch(r){case 0:return t&e^~t&u;case 1:return t^e^u;case 2:return t&e^t&u^e&u;case 3:return t^e^u}}function m(r,t){return r<<t|r>>>32-t}function R(r){let t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){let o=unescape(encodeURIComponent(r));r=[];for(let i=0;i<o.length;++i)r.push(o.charCodeAt(i))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);let u=r.length/4+2,n=Math.ceil(u/16),s=new Array(n);for(let o=0;o<n;++o){let i=new Uint32Array(16);for(let a=0;a<16;++a)i[a]=r[o*64+a*4]<<24|r[o*64+a*4+1]<<16|r[o*64+a*4+2]<<8|r[o*64+a*4+3];s[o]=i}s[n-1][14]=(r.length-1)*8/Math.pow(2,32),s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(r.length-1)*8&4294967295;for(let o=0;o<n;++o){let i=new Uint32Array(80);for(let c=0;c<16;++c)i[c]=s[o][c];for(let c=16;c<80;++c)i[c]=m(i[c-3]^i[c-8]^i[c-14]^i[c-16],1);let a=e[0],f=e[1],x=e[2],d=e[3],h=e[4];for(let c=0;c<80;++c){let A=Math.floor(c/20),P=m(a,5)+K(A,f,x,d)+h+t[A]+i[c]>>>0;h=d,d=x,x=m(f,30)>>>0,f=a,a=P}e[0]=e[0]+a>>>0,e[1]=e[1]+f>>>0,e[2]=e[2]+x>>>0,e[3]=e[3]+d>>>0,e[4]=e[4]+h>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}var U=R;var H=g("v5",80,U),y=H;function B(r){return new Uint8Array((r.match(/../g)??[]).map(t=>parseInt(t,16))).buffer}function M(r){return btoa(new Uint8Array(r).reduce((t,e)=>t+String.fromCharCode(e),""))}function L(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0))}var p=class{constructor(t,e){this.hPass=t;this.subtle=e;this.#r=JSON.stringify(this.hPass),this.#t={name:"AES-GCM",iv:B(t.iv)}}#r;#t;get strHPass(){return this.#r}#n(t){return this.subtle.digest("SHA-512",new TextEncoder().encode(t))}uuidv5(t){return y(t,this.hPass.pass)}async init(){let t=await this.subtle.importKey("raw",await this.#n(this.hPass.pass),"PBKDF2",!1,["deriveKey"]);this.#e=await this.subtle.deriveKey({name:"PBKDF2",hash:"SHA-512",iterations:this.hPass.ite,salt:B(this.hPass.salt)},t,{name:this.#t.name,length:256},!1,["encrypt","decrypt"])}#e;async encAb(t){return await this.subtle.encrypt(this.#t,this.#e,t)}async enc(t){return M(await this.encAb(new TextEncoder().encode(t)))}async decAb(t){return await this.subtle.decrypt(this.#t,this.#e,t)}async dec(t){return new TextDecoder().decode(await this.decAb(L(t)))}};var{subtle:N}=crypto;async function rt(r){let t=r.tstDecryptInfo(),e=new p(t,N);await e.init(),r.setDec(async(n,s)=>u.test(n)?await e.dec(s):s);let u=/(^|\.)(sn|ssn|json|html?)$/;r.setDecAB(async n=>{let s=new DataView(n.slice(0,4)).getUint32(0,!0),o=n.slice(4,4+s),i=await e.decAb(o),a=new DataView(i.slice(1,2)).getUint8(0),f=i.slice(2),x=n.slice(4+s),d=await new Blob([f,x]).arrayBuffer();return{ext_num:a,ab:d}}),r.setEnc(n=>e.enc(n)),r.getStK(()=>t.stk),r.getHash(n=>e.uuidv5(n))}export{rt as init};
