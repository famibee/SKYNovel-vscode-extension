export async function init(r){const t=r.tstDecryptInfo(),{enc:e,AES:c,PBKDF2:y,RIPEMD160:b}=require("crypto-js"),i=e.Hex.parse(t.iv),f=y(e.Utf8.parse(t.pass),e.Hex.parse(t.salt),{keySize:t.keySize,iterations:t.ite}),a=/(^|\.)(sn|ssn|json|html?)$/,{Buffer:o}=require("buffer");r.setDec((s,n)=>{if(a.lastIndex=0,typeof n=="string")return{ret:a.test(s)?c.decrypt(n,f,{iv:i}).toString(e.Utf8):n,ext_num:0};const g=new DataView(n).getUint32(0,!0),l=n.slice(4,4+g),p=c.decrypt(o.from(l,"binary").toString("utf8"),f,{iv:i}).toString(e.Utf8),u=o.from(p,"base64"),m=u.slice(2),S=o.from(n.slice(4+g),"binary");return{ret:o.concat([m,S]),ext_num:u.readUInt8(1)}}),r.setEnc(s=>String(c.encrypt(s,f,{iv:i}))),r.getStK(()=>t.stk),r.getHash(s=>b(s).toString(e.Hex))}
