export async function init(r){const t=r.tstDecryptInfo(),{enc:e,AES:c,PBKDF2:u,RIPEMD160:b}=require("crypto-js"),i=e.Hex.parse(t.iv),f=u(e.Utf8.parse(t.pass),e.Hex.parse(t.salt),{keySize:t.keySize,iterations:t.ite}),y=/(^|\.)(sn|ssn|json|html?)$/,{Buffer:o}=require("buffer");r.setDec((s,n)=>{if(typeof n=="string")return{ret:y.test(s)?c.decrypt(n,f,{iv:i}).toString(e.Utf8):n,ext_num:0};const a=new DataView(n).getUint32(0,!0),p=n.slice(4,4+a),m=c.decrypt(o.from(p,"binary").toString("utf8"),f,{iv:i}).toString(e.Utf8),g=o.from(m,"base64"),S=g.slice(2),l=o.from(n.slice(4+a),"binary");return{ret:o.concat([S,l]),ext_num:g.readUInt8(1)}}),r.setEnc(s=>String(c.encrypt(s,f,{iv:i}))),r.getStK(()=>t.stk),r.getHash(s=>b(s).toString(e.Hex))}
