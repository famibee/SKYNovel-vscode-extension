exports.id=993,exports.ids=[993],exports.modules={2016:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PRE_TASK_TYPE:()=>Me,WorkSpaces:()=>Je,aPickItems:()=>Oe,openURL:()=>Be});var a=n(5903),s=n(37342);const i={"cnv.font.subset":!1,"cnv.icon.shape":0,"cnv.mat.pic":!1,"cnv.mat.webp_quality":90,"cnv.mat.snd":!1,"cnv.mat.snd.codec":"opus"},r={book:{title:"",creator:"",cre_url:"",publisher:"",pub_url:"",detail:"",version:"1.0"},save_ns:"",window:{width:300,height:300},log:{max_len:1024},init:{bg_color:"#000000",tagch_msecwait:10,auto_msecpagewait:3500,escape:""},debug:{devtool:!1,dumpHtm:!1,token:!1,tag:!1,putCh:!1,debugLog:!1,baseTx:!1,masume:!1,variable:!1},code:{},debuger_token:""},o=":DEF_FONT:",c={sum:{baseSize:0,webpSize:0,pathPicCmpWebP:"",pathPicCmpBase:""},hSize:{}},l={sum:{baseSize:0,optSize:0,pathSndOpt:"",pathSndBase:""},hSize:{}},m=/;[^\n]*|(?:&(\S+)|\[let\s+name\s*=\s*(\S+)\s+text)\s*=\s*((["'#]).+?\4|[^;\s]+)(?:[^;\n]*;(.*))?/g;var d;!function(e){e.DEFAULT="",e.SP_GSM="png|jpg|jpeg|json|svg|webp|mp4|webm",e.SCRIPT="sn|ssn",e.FONT="woff2|woff|otf|ttf",e.SOUND="mp3|m4a|ogg|aac|flac|wav",e.HTML="htm|html",e.CSS="css",e.SN="sn",e.TST_PNGPNG_="png|png_",e.TST_HH="hh",e.TST_EEE="eee",e.TST_GGG="ggg",e.TST_PNGXML="png|xml"}(d||(d={}));const p={save_ns:"",window:{width:300,height:300},book:{title:"",creator:"",cre_url:"",publisher:"",pub_url:"",detail:"",version:"1.0"},log:{max_len:64},init:{bg_color:"#000000",tagch_msecwait:10,auto_msecpagewait:3500,escape:""},debug:{devtool:!1,dumpHtm:!1,token:!1,tag:!1,putCh:!1,debugLog:!1,baseTx:!1,masume:!1,variable:!1},code:{},debuger_token:""};class h{sys;oCfg=p;userFnTail="";hPathFn2Exts={};constructor(e){this.sys=e}async load(e){this.oCfg.save_ns=e.save_ns||this.oCfg.save_ns,this.oCfg.window.width=e.window.width||this.oCfg.window.width,this.oCfg.window.height=e.window.height||this.oCfg.window.height,this.oCfg.book={...this.oCfg.book,...e.book},this.oCfg.log.max_len=e.log.max_len||this.oCfg.log.max_len,this.oCfg.init={...this.oCfg.init,...e.init},this.oCfg.debug={...this.oCfg.debug,...e.debug},this.oCfg.debuger_token=e.debuger_token,await this.sys.loadPath(this.hPathFn2Exts,this),this.#e=this.matchPath("^breakline$",d.SP_GSM).length>0,this.#t=this.matchPath("^breakpage$",d.SP_GSM).length>0;const t={};if(this.sys.arg.crypto)for(const[e,n]of Object.entries(this.hPathFn2Exts))for(const[a,s]of Object.entries(n)){if(!a.startsWith(":")){t[e]=a;continue}if(!a.endsWith(":id"))continue;const i=s.slice(s.lastIndexOf("/")+1),r=n[a.slice(0,-10)]??"",o=await this.sys.fetch(r),c=await o.text();if(i!==this.sys.hash(c))throw`ファイル改竄エラーです fn:${r}`}else for(const[e,n]of Object.entries(this.hPathFn2Exts))for(const a of Object.keys(n))a.startsWith(":")||(t[e]=a)}#e=!1;get existsBreakline(){return this.#e}#t=!1;get existsBreakpage(){return this.#t}getNs(){return`skynovel.${this.oCfg.save_ns} - `}#n=/([^/\s]+)\.([^\d]\w+)/;searchPath(e,t=d.DEFAULT){if(!e)throw"[searchPath] fnが空です";if(e.startsWith("http://"))return e;const n=e.match(this.#n);let s=n?n[1]??"":e;const i=n?n[2]:"";if(this.userFnTail){const e=s+"@@"+this.userFnTail;if(e in this.hPathFn2Exts)if(t===d.DEFAULT)s=e;else for(const n of Object.keys(this.hPathFn2Exts[e]??{}))if(`|${t}|`.includes(`|${n}|`)){s=e;break}}const r=this.hPathFn2Exts[s];if(!r)throw`サーチパスに存在しないファイル【${e}】です`;if(!i){const n=(0,a.Wh)(r[":cnt"]);if(t===d.DEFAULT){if(n>1)throw`指定ファイル【${e}】が複数マッチします。サーチ対象拡張子群【${t}】で絞り込むか、ファイル名を個別にして下さい。`;return e}const s=`|${t}|`;if(n>1){let n=0;for(const a of Object.keys(r))if(s.includes(`|${a}|`)&&++n>1)throw`指定ファイル【${e}】が複数マッチします。サーチ対象拡張子群【${t}】で絞り込むか、ファイル名を個別にして下さい。`}for(const[e,t]of Object.entries(r))if(s.includes(`|${e}|`))return t;throw`サーチ対象拡張子群【${t}】にマッチするファイルがサーチパスに存在しません。探索ファイル名=【${e}】`}if(t!==d.DEFAULT&&!`|${t}|`.includes(`|${i}|`))throw`指定ファイルの拡張子【${i}】は、サーチ対象拡張子群【${t}】にマッチしません。探索ファイル名=【${e}】`;const o=r[i];if(!o)throw`サーチパスに存在しない拡張子【${i}】です。探索ファイル名=【${e}】、サーチ対象拡張子群【${t}】`;return o}matchPath(e,t=d.DEFAULT){const n=[],a=new RegExp(e),s=new RegExp(t);for(const[e,i]of Object.entries(this.hPathFn2Exts)){if(-1===e.search(a))continue;if(t===d.DEFAULT){n.push(i);continue}const r={};let o=!1;for(const t of Object.keys(i))-1!==t.search(s)&&(r[t]=e,o=!0);o&&n.push(r)}return n}addPath(e,t){const n={};for(const[e,a]of Object.entries(t))n[e]=(e.startsWith(":")?"":this.sys.arg.cur)+String(a);this.hPathFn2Exts[e]=n}}var u=n(91398),f=n(21605);class g{ctx;PATH_WS;PATH_PRJ;diff;#a=void 0;#s=null;#i=null;#r;#o;constructor(e,t,n,a){this.ctx=e,this.PATH_WS=t,this.PATH_PRJ=n,this.diff=a;const i=e.extensionPath+"/views/";this.#r=u.Uri.file(i),(0,f.readFile)(i+"folder.htm",{encoding:"utf8"}).then((e=>this.#o=e.replace("<meta_autooff ","<meta ").replaceAll("${nonce}",(0,s.m9)()).replace('.ts"><\/script>','.js"><\/script>')))}open(e){const t=u.window.activeTextEditor?.viewColumn,n=this.#a;if(this.#s===e&&n)n.reveal(t);else{if(!n){const e=this.#a=u.window.createWebviewPanel("SKYNovel-folder","",t??u.ViewColumn.One,{enableScripts:!0,localResourceRoots:[this.#r,u.Uri.file(this.PATH_WS)]}),n=e.webview;this.ctx.subscriptions.push(e.onDidDispose((()=>this.#a=void 0),void 0,this.ctx.subscriptions),n.onDidReceiveMessage((({cmd:e,text:t})=>{switch(e){case"info":u.window.showInformationMessage(t);break;case"warn":u.window.showWarningMessage(t)}}),!1)),n.html=(0,a.J4)(this.#o,n,this.#r).replace(/<!--SOL-->.+?<!--EOL-->/s,"")}this.#s=e,this.#c(e)}}#c(e){const t=e.path,n=(0,a.DH)(t),s=this.diff.fp2pp(n);this.#a.title=s+" フォルダ";let i="";const r=this.#a.webview;this.#i=r.asWebviewUri(u.Uri.file(this.PATH_PRJ));const o=String(this.#i);(0,a.ad)(n,((e,t)=>{const n=(0,a.DH)(u.Uri.file(e).path),s=this.diff.fp2pp(n);this.#l.test(n)?i+=`<div class="col pe-0">\n\t<div class="card text-bg-secondary">\n\t\t<video controls controlsList="nodownload" playsinline preload="metadata" class="w-100" src="${o}${s}" class="card-img-top"></video>\n\t\t<div class="card-body">\n\t\t\t<a href="${o}${s}" title="エディタにドラッグできます" class="btn btn-primary" title="エディタにドラッグできます">${t}</a>\n\t\t</div>\n\t</div>\n</div>`:this.#m.test(s)?i+=`<div class="col pe-0">\n\t<img loading="lazy" src="${o}${s}" title="${t}"/>\n</div>`:this.#d.test(s)&&(i+=`<div class="col pe-0">\n\t<div class="card text-bg-secondary">\n\t\t<audio controls src="${o}${s}" class="card-img-top"></audio>\n\t\t<div class="card-body">\n\t\t\t<a href="${o}${s}" title="エディタにドラッグできます" class="btn btn-primary" title="エディタにドラッグできます">${t}</a>\n\t\t</div>\n\t</div>\n</div>`)}),(()=>{})),r.postMessage({cmd:"refresh",o:{htm:i}})}#l=/\.(mp4|webm)$/;#m=new RegExp(`\\.${d.SP_GSM}$`);#d=new RegExp(`\\.${d.SOUND}$`);updateDelay({path:e}){const t=this.#s;if(!this.#a||!t)return;const n=(0,a.DH)(e),s=(0,a.DH)(t.path);n.startsWith(s)&&(this.#p&&clearTimeout(this.#p),this.#p=setTimeout((()=>{this.#p=void 0,this.#c(t)}),500))}#p=void 0;isOpend(e){return!!this.#i&&e.startsWith(this.#i.path)}close(){this.#a?.dispose(),this.#a=void 0,this.#s=null}}let y=";";function b(e){y=e}var _;!function(e){e[e.SnUpd=0]="SnUpd",e[e.ReBuild=1]="ReBuild",e[e.PrjSet=2]="PrjSet",e[e.Crypto=3]="Crypto",e[e.TaskWeb=4]="TaskWeb",e[e.TaskApp=5]="TaskApp",e[e.Pack=6]="Pack"}(_||(_={}));class S extends u.TreeItem{ctx;pathWs;cfg;static create(e,t,n,a){const s={cmd:"",icon:"",label:"",desc:t.name,children:[{cmd:"SnUpd",icon:"skynovel",label:"ベース更新",task_type:"Sys",npm:"npm update"+(a?"":` ${y} npm run webpack:dev`)},{cmd:"ReBuild",icon:"refresh",label:"リビルド",task_type:"Sys",npm:"npm run rebuild"},{cmd:"PrjSet",icon:"gear",label:"設定",task_type:"Sys"},{cmd:"Crypto",icon:"gear",label:"暗号化",task_type:"Sys",npm:a?'echo "Crypto"':"npm run webpack:dev"},{cmd:"TaskWeb",icon:"browser",label:"起動：ブラウザ版",task_type:"Web",npm:"npm run web",exe:!0},{cmd:"TaskApp",icon:"electron",label:"起動：アプリ版",task_type:"App",npm:"npm run "+(a?"app":"start"),exe:!0},{cmd:"",icon:"",label:"生成",children:[{cmd:"PackWin",icon:"windows",label:"Windows exe x64",npm:`npm run webpack:pro ${y} electron-builder -w --x64`},{cmd:"PackWin32",icon:"windows",label:"Windows exe ia32",npm:`npm run webpack:pro ${y} electron-builder -w --ia32`},{cmd:"PackMac",icon:"macosx",label:"macOS dmg x64",npm:`npm run webpack:pro ${y} electron-builder -m --x64`,forMac:!0},{cmd:"PackMacArm64",icon:"macosx",label:"macOS dmg arm64",npm:`npm run webpack:pro ${y} electron-builder -m --arm64`,forMac:!0},{cmd:"PackLinux",icon:"linux",label:"Linux AppImage",npm:`npm run webpack:pro ${y} electron-builder -l`},{cmd:"PackFreem",icon:"freem",label:"ふりーむ！形式 zip",npm:"npm run webpack:pro"}]}]};if(a){const e=s.children[_.Pack];e.children=e.children.map((e=>({...e,npm:e.npm?.replace("webpack:pro","app_bld")})))}const i=t.uri.fsPath,r=new S(e,i,s);return r.collapsibleState=u.TreeItemCollapsibleState.Collapsed,S.regCmds=()=>{},S.#h[i]=n,r}static#h={};#u=[];constructor(e,t,n){if(super(a.Ex&&n.forMac?"":n.label),this.ctx=e,this.pathWs=t,this.cfg=n,a.Ex&&n.forMac)this.description="（Windowsでは使えません）";else if(this.description=n.desc??"",n.cmd){const t=this.contextValue="skynovel.dev"+n.cmd;S.regCmds(e,t,n)}n.children?(this.iconPath=u.ThemeIcon.Folder,this.collapsibleState=u.TreeItemCollapsibleState.Collapsed,this.#u=n.children.map((n=>new S(e,t,n)))):(this.iconPath=(0,s.Vt)(n.icon),this.collapsibleState=u.TreeItemCollapsibleState.None)}static regCmds(e,t,n){""!==n.cmd&&(S.#f(e,t,n.cmd,n),n.exe&&(S.#f(e,t+"Dbg",n.cmd+"Dbg",n),S.#f(e,t+"Stop",n.cmd+"Stop",n)))}static#f(e,t,n,a){e.subscriptions.push(u.commands.registerCommand(t,(e=>S.#h[e.pathWs]?.(e,n,a))))}get children(){return this.#u}}var v=n(33257),w=n(92026),P=n(31421);class x{PATH_WS;ps;is_new_tmp;constructor(e,t,n){this.PATH_WS=e,this.ps=t,this.is_new_tmp=n}async go(e,t,n,a){const s=e=>this.ps.cmd2Vue({cmd:"updpic",pathIcon:a,err_mes:e}),{width:i,height:r}=await(0,v.F)(e);i&&r||s("  画像のサイズが不明です");(i<1024||r<1024)&&s(`元画像のサイズは 1024 x 1024 以上にして下さい。（width:${i} height:${r}）`);try{await(0,w.Nc)(this.PATH_WS+"/build/icon/");const e=this.PATH_WS+"/build/icon.png";console.log(`fn:BatCutRound.ts fnIcon=${e}`);const t=(0,P.execSync)("electron-icon-builder -i=build/icon.png -o=./build/icon -f").toString();console.log(`fn:BatCutRound.ts line:99 g=${t}`),await Promise.allSettled([(0,w.C)(e,this.PATH_WS+`/doc/${this.is_new_tmp?"":"app/"}icon.png`)]),console.log("fn:BatCutRound.ts line:80 ")}catch(e){console.error(e)}s("")}}var k=n(39047);const $={cnv_mat_pic:{title:"画像ファイル最適化",aNeedLib:["fs-extra","sharp","p-queue"]},cnv_mat_snd:{title:"音声ファイル最適化",aNeedLib:["fs-extra","@ffmpeg-installer/ffmpeg","fluent-ffmpeg","p-queue"]},cnv_psd_face:{title:"PSDファイル変換",aNeedLib:["fs-extra","psd.js","sharp"]},cut_round:{title:"アイコン生成・加工中",aNeedLib:["fs-extra","sharp","png2icons"]},subset_font:{title:"フォントサイズ最適化",aNeedLib:["fs-extra"]}};class T{static ctx;static wsFld;static#g;static fp2pp(e){return this.#y.fp2pp(e)}static#y;static encIfNeeded;static FLD_SRC;static hTaskExe;static hOnEndTask;static#b;static#_;static wss;static PATH_WS;static#S;static PATH_PRJ;static PATH_PRJ_BASE;static#v=!1;static set watchFile(e){this.#v=e}static#w;static init(e,t,n,s,i,r,o,c,l,m){this.ctx=e,this.wsFld=t,this.#g=n,this.encIfNeeded=s,this.#y=i,this.FLD_SRC=r,this.hTaskExe=o,this.hOnEndTask=c,this.#b=l,this.#_=m,this.wss=e.workspaceState,this.PATH_WS=(0,a.DH)(t.uri.path),this.#S=this.PATH_WS.length,this.PATH_PRJ=this.PATH_WS+"/doc/prj/",this.PATH_PRJ_BASE=this.PATH_WS+`/${r}/${ke}/`,u.workspace.onDidRenameFiles((e=>this.#P(e)));const d="doc/prj/*",p=u.workspace.createFileSystemWatcher(new u.RelativePattern(t,d));p.onDidCreate((e=>this.#x((()=>this.#k(e)),`CRE ${d}`))),p.onDidDelete((e=>this.#x((()=>this.#$(e)),`DEL ${d}`)))}static async#P({files:e}){for(const{oldUri:t,newUri:n}of e){const e=t.path.slice(this.#S+1),a=e.startsWith("doc/"),s=n.path.slice(this.#S+1),i=s.startsWith("doc/");for(const r of this.#T){const{pat:o}=r;a&&r.del&&(0,k.xF)(e,o)&&await r.del(t),i&&r.crechg&&(0,k.xF)(s,o)&&await r.crechg(n,!0)}}}static async#k(e){if(!(0,f.statSync)(e.path).isDirectory())return;this.ps.onCreDir(e);const t=(0,a.dd)(e.path)+"/",n=(await u.workspace.fs.readDirectory(e)).filter((([,e])=>e===u.FileType.File)).map((([e])=>"doc/prj/"+t+e));for(const e of this.#T){const{pat:t}=e;if(e.crechg&&t.startsWith("doc/prj/"))for(const a of n)(0,k.xF)(a,t)&&await e.crechg(u.Uri.file(this.PATH_WS+"/"+a),!0)}}static async#$(e){this.ps.onDelDir(e);const t=(0,a.dd)(e.path)+"/",n=this.#y.keysPP.filter((e=>e.startsWith(t))).map((e=>"doc/prj/"+e));for(const e of this.#T){const{pat:t}=e;if(e.del&&t.startsWith("doc/prj/"))for(const a of n)(0,k.xF)(a,t)&&await e.del(u.Uri.file(this.PATH_WS+"/"+a))}}static isBaseUrl(e){return e.startsWith(this.PATH_PRJ_BASE)}static init2th(e){this.ps=e,this.#w=new x(this.PATH_WS,e,T.#b)}static async init3th(e){this.sendNeedGo=e,await this.#g(),this.#v=!0}static ps;static sendNeedGo=async()=>{};static lasyPathJson(){this.#q&&clearTimeout(this.#q),this.#q=setTimeout((()=>{this.#g()}),500)}static#q=void 0;static async exeBatch(e,t){const n=$[e];return u.window.withProgress({location:u.ProgressLocation.Notification,title:n.title,cancellable:!1},(a=>new Promise((s=>{const i=(0,f.readJsonSync)(this.PATH_WS+"/package.json",{encoding:"utf8"}),r=n.aNeedLib.filter((e=>!(i.devDependencies??={})[e])).join(" "),o=this.PATH_WS+`/${T.FLD_SRC}/batch/${e}.js`;(0,f.copySync)(this.ctx.extensionPath+`/dist/${e}.js`,o);try{const a=`npm i -D ${r} ${y} `;u.tasks.executeTask(new u.Task({type:Me+"Sys"},this.wsFld,n.title,"SKYNovel",new u.ShellExecution(`cd "${this.PATH_WS}" ${y} ${a} node ./${T.FLD_SRC}/batch/${e}.js ${t}`))).then((e=>this.hTaskExe.set("Batch",e)))}catch(e){console.error("Project exeTask() e:%o",e)}this.hOnEndTask.set("Sys",(e=>{a.report({message:"完了",increment:100}),setTimeout((()=>s(e.exitCode??0)),4e3)}))}))))}static async cnvIconShape({title:e,openlabel:t,path:n},a){const s=await u.window.showOpenDialog({title:`${e}を選択して下さい`,openLabel:t||"ファイルを選択",canSelectMany:!1,canSelectFiles:!1,canSelectFolders:!1}),i=s?.[0]?.fsPath;i&&await this.#w.go(i,this.ps.oWss["cnv.icon.shape"],n,a)}static async watchFld(e,t,n,a,s,i=!1){this.#T.push({pat:e,crechg:a,del:s});const r=e.startsWith("doc/prj/*/")?async e=>{(0,f.existsSync)(e.path)&&await this.encIfNeeded(e)}:async()=>{};n&&await Promise.allSettled((await u.workspace.findFiles(e)).map((async e=>(await n(e),r(e)))));const o=u.workspace.createFileSystemWatcher(new u.RelativePattern(this.wsFld,e),!a,!a,!s);a&&this.ctx.subscriptions.push(o.onDidCreate((t=>{this.#x((async()=>{await a(t,!0),await r(t),this.ps.pnlWVFolder.updateDelay(t),i&&this.lasyPathJson()}),`CRE ${e}`)})),o.onDidChange((n=>{this.#x((async()=>{await this.#R(t,n),await a(n,!1),await r(n),this.ps.pnlWVFolder.updateDelay(n)}),`CHG ${e}`)}))),s&&this.ctx.subscriptions.push(o.onDidDelete((n=>{this.#x((async()=>{if(await this.#R(t,n),await s(n)){const{pathCn:e,pp:t}=this.#y.path2cn(n.path);e&&await(0,f.remove)(e),this.#y.del(t),await this.#y.save()}this.ps.pnlWVFolder.updateDelay(n),i&&this.lasyPathJson()}),`DEL ${e}`)})))}static#T=[];static chkUpdate(e,t){if(this.#_()){const{pathCn:n}=this.#y.path2cn(t);return!n||(0,a.Wp)(e,n)}return(0,a.Wp)(e,t)}static async#R(e,{path:t}){if(""===e)return;const n=(0,a.dd)(t),s=await u.workspace.findFiles(e.replaceAll("[FN]",n));await Promise.allSettled(s.map((async({path:e})=>{await(0,f.remove)(e);const{pathCn:t,pp:n}=this.#y.path2cn(e);t&&await(0,f.remove)(t),this.#y.del(n)}))),await this.#y.save()}static#x(e,t){this.#v&&1===this.#A.push({uniq:t,fnc:e})&&(this.#C&&clearTimeout(this.#C),this.#C=setTimeout((()=>this.#E()),100))}static#A=[];static#C=void 0;static async#E(){let e;for(this.#v=!1;e=this.#A.shift();)this.#A=this.#A.filter((t=>t.uniq!==e.uniq)),await e.fnc();this.#v=!0}static async delOldDiff(e){this.#_()&&await this.#y.filter(e)}}class q extends T{reqPrj2LSP;constructor(e){super(),this.reqPrj2LSP=e}async init(){await T.watchFld("doc/prj/*/setting.sn","",(async({path:e})=>Promise.try((()=>{this.#D=e,this.chkMultiMatch=()=>this.#H(),this.chkMultiMatch(),this.update=e=>this.#F(e)}))),(async(e,t)=>Promise.try((()=>{t&&this.chkMultiMatch()}))),(async()=>Promise.resolve(!0))),u.workspace.onDidSaveTextDocument((e=>{e.fileName.endsWith("/setting.sn")&&this.chkMultiMatch()}),null,T.ctx.subscriptions)}#N=!0;chkMultiMatch=()=>{};#H(){this.#N=!0;const e=[],t=(0,f.readFileSync)(this.#D,{encoding:"utf8"});for(const[n,a,s,i="",r="",o=""]of t.matchAll(m)){if(";"===n.at(0))continue;const t=o.trim();if(""===t||t.startsWith("(HIDE GUI)"))continue;const c=a??s??"";let l={id:"/setting.sn:"+c,nm:c,lbl:t,type:"txt",val:r?i.slice(1,-1):i};"{"===t.at(0)&&(l={...l,...JSON.parse(t)}),"rng"===l.type||"true"!==i&&"false"!==i||(l.type="chk"),e.push(l)}T.ps.cmd2Vue({cmd:"update.aTemp",err:"",aTemp:e})}#D="";update=e=>{};#F(e){this.#N?this.#N=!1:(this.#p&&clearTimeout(this.#p),this.#p=setTimeout((()=>{const t=[];for(const{nm:n,val:a}of e.aRes)t.push([new RegExp(`(&${n}\\s*=\\s*)((["'#]).+?\\3|[^;\\s]+)`),`$1$3${a}$3`]);if((0,a._Z)(this.#D,t,!1)){const e=this.#D,t={};t[T.fp2pp(e)]=(0,f.readFileSync)(e,{encoding:"utf8"}),this.reqPrj2LSP({cmd:"onchg_scr",pp2s:t})}}),500))}#p=void 0}var R=n(16928),A=n(76982),C=n(70857);class E{ctx;wsFld;cfg;setTitle;reqPrj2LSP;diff;optPic;optSnd;optFont;FLD_SRC;is_new_tmp;#j;#L=i;get oWss(){return this.#L}#W;#O;#B;#M;#J;#Y;#K;#I;#r;#o="";#G;get pnlWVFolder(){return this.#G}#U;#z=[];#V;constructor(e,t,n,r,o,c,l,m,d,p,h){this.ctx=e,this.wsFld=t,this.cfg=n,this.setTitle=r,this.reqPrj2LSP=o,this.diff=c,this.optPic=l,this.optSnd=m,this.optFont=d,this.FLD_SRC=p,this.is_new_tmp=h,this.#j=e.workspaceState;const y=i;for(const[e,t]of Object.entries(y)){const n=this.#j.get(e);n?y[e]=n:this.#j.update(e,t)}this.#L=y,this.#W=(0,a.DH)(t.uri.path),this.#O=this.#W+"/doc/prj/",this.#B=this.#O+"prj.json",this.#M=this.#W+"/doc/app.js",this.#J=this.#W+"/package.json",this.#G=new g(e,this.#W,this.#O,c),this.#U=new q(o),this.#I=this.#W+"/build/include/readme.txt",this.#Y=this.#W+"/build/installer.nsh",this.#K=this.#W+"/build/icon.png",this.#V=()=>o({cmd:"need_go"});const b=e.extensionPath,_=b+"/dist/";this.#r=u.Uri.file(_),Promise.allSettled([()=>Promise.try((()=>{r(n.oCfg.book.title),E.#X[t.uri.path]=()=>n.oCfg.debuger_token})),async()=>{this.#o=(await(0,f.readFile)(_+"setting.html",{encoding:"utf8"})).replace("<meta_autooff ","<meta ").replaceAll("${nonce}",(0,s.m9)()).replace('.ts"><\/script>','.js"><\/script>'),this.#Q.has(n.oCfg.save_ns)&&this.open()},()=>this.#U.init(),async()=>{(0,f.existsSync)(this.#I)||(await(0,f.ensureFile)(this.#I),await(0,f.copyFile)(b+"/res/readme.txt",this.#I)),(0,f.existsSync)(this.#Y)||await(0,f.copyFile)(b+"/res/installer.nsh",this.#Y),(0,f.existsSync)(this.#K)||await(0,f.copyFile)(b+"/res/img/icon.png",this.#K);const e=this.#W+"/.vscode/launch.json";(0,f.existsSync)(e)||await(0,f.copyFile)(b+"/res/launch.json",e)}].map((e=>e())))}#Q=new Set(["tmp_esm_uc","tmp_cjs_sample","tmp_cjs_hatsune","tmp_cjs_uc","sn_sample","hatsune","uc"]);dispose(){for(const e of this.#z)e.dispose()}getLocalSNVer(){const e=(0,f.readJsonSync)(this.#J,{encoding:"utf8"}),t=this.#W+"/CHANGELOG.md",n="@famibee/skynovel"+(this.is_new_tmp?"_esm":"");return{verSN:e.dependencies?.[n]?.slice(1)??"",verTemp:(0,f.existsSync)(t)?/## v(.+)\s/.exec((0,f.readFileSync)(t,{encoding:"utf8"}))?.[1]??"":""}}static#X={};static getDebugertoken(e){return e?E.#X[e.uri.path]?.()??"":""}onCreDir({path:e}){this.cfg.oCfg.code[(0,R.basename)(e)]=!1,this.cmd2Vue({cmd:"update.oCfg",oCfg:this.cfg.oCfg})}onDelDir({path:e}){delete this.cfg.oCfg.code[(0,R.basename)(e)],this.#Z(),this.cmd2Vue({cmd:"update.oCfg",oCfg:this.cfg.oCfg}),this.#G.close()}#Z(){const e={...this.cfg.oCfg};e.code={};for(const[t,n]of Object.entries(this.cfg.oCfg.code))n&&(e.code[t]=!0);return(0,f.writeFile)(this.#B,JSON.stringify(e,null,"\t"))}#a=void 0;get isOpenPnlWV(){return!!this.#a}cmd2Vue=e=>{};#ee;get wvuWs(){return String(this.#ee)}#te;open(){if(!s.fj.aReady[s.JJ.NPM])return;const e=u.window.activeTextEditor?.viewColumn;if(this.#a){this.#a.reveal(e);const t=this.#a.webview;return void(t.html=(0,a.J4)(this.#o,t,this.#r))}const t=this.#a=u.window.createWebviewPanel("SKYNovel-setting","設定",e??u.ViewColumn.One,{enableScripts:!0,localResourceRoots:[this.#r,u.Uri.file(this.#W)]});t.onDidDispose((()=>this.#a=void 0),void 0,this.ctx.subscriptions);const n=t.webview;this.#ee=n.asWebviewUri(u.Uri.file(this.#W)),this.#te=`${String(this.#ee)}/build/icon.png`,this.cmd2Vue=e=>n.postMessage(e),n.onDidReceiveMessage((e=>this.#ne(e)),void 0,this.ctx.subscriptions),n.html=(0,a.J4)(this.#o,n,this.#r)}async#ne(e){switch(e.cmd){case"?":await Promise.allSettled([Promise.try((()=>{this.cmd2Vue({cmd:"!",oCfg:this.cfg.oCfg,oWss:this.#L,pathIcon:this.#te,fld_src:this.FLD_SRC}),this.#U.chkMultiMatch()})),this.optFont.disp()]),this.optPic.disp(),this.optSnd.disp();break;case"update.oCfg":{const{oCfg:t}=e,n=this.cfg.oCfg.init.escape,s=this.cfg.oCfg,i=t.save_ns??s.save_ns,r=this.cfg.oCfg={...s,book:{...s.book,...t.book},save_ns:i,window:{...s.window,...t.window},log:{...s.log,...t.log},init:{...s.init,...t.init},debug:{...s.debug,...t.debug},code:{...s.code,...t.code},debuger_token:this.#Q.has(i)?"":(t.debuger_token??s.debuger_token)||(0,A.randomUUID)()};r.init.escape!==n&&await this.#V(),await this.#Z(),this.setTitle(r.book.title);const o=(new Date).getFullYear(),c=await(0,f.readJson)(this.#J,{encoding:"utf8"});c.name=r.save_ns,c.appBundleId=c.appId=`com.fc2.blog.famibee.skynovel.${r.save_ns}`,c.version=r.book.version,c.productName=r.book.title,c.author=r.book.creator,c.appCopyright=`(c)${r.book.creator}`,c.homepage=r.book.pub_url,c.description=r.book.detail,c.build.appId=c.appId,c.build.productName=r.book.title.normalize("NFD"),c.build.artifactName="${name}-${version}-${arch}.${ext}",await(0,f.writeFile)(this.#J,JSON.stringify(c,null,"\t")),this.is_new_tmp?(0,a._Z)(this.#W+"/src/main/main.ts",[[/(companyName\s*:\s*)(['"]).*\2/,`$1"${r.book.publisher}"`],[/(pkg.appCopyright \+' )\d+/,`$1${o}`]],!1):(0,a._Z)(this.#M,[[/(companyName\s*:\s*)(['"]).*\2/,`$1"${r.book.publisher}"`],[/(pkg.appCopyright \+' )\d+/,`$1${o}`]],!1),(0,a._Z)(this.#I,[[/(【Version】)[^\n]+/g,`$1${r.book.version}`],[/(【タイトル】)[^\n]+/g,`$1${r.book.title}`],[/(【著 作 者】)[^\n]+/g,`$1${r.book.creator}`],[/(【連 絡 先】メール： )[^\n]+/,`$1${r.book.cre_url}`],[/(Copyright \(C\) )\d+ "([^"]+)"/g,`$1${o} "${r.book.publisher}"`],[/(　　　　　　ＷＥＢ： )[^\n]+/g,`$1${r.book.pub_url}`]],!1),(0,a._Z)(this.#Y,[[/(!define PUBLISHER ").+"/,`$1${r.book.publisher}"`]],!1)}break;case"change.range.webp_q_def":await this.optPic.chgWebp_q_def(e);break;case"change.range.webp_q":await this.optPic.chgWebp_q(e);break;case"update.oWss":for(const[t,n]of Object.entries(e.oWss)){const e=this.#L[t];if(e===n)continue;switch(await this.#j.update(t,n),this.#L[t]=n,t){case"cnv.font.subset":case"cnv.mat.pic":case"cnv.mat.snd":case"cnv.mat.snd.codec":break;default:continue}const a={cmd:"notice.Component",id:t,mode:"wait"};this.cmd2Vue(a),await this.#ae(t,String(n))?a.mode="comp":(await this.#j.update(t,this.#L[t]=e),a.mode="cancel"),this.cmd2Vue(a);break}break;case"update.aTemp":this.#U.update(e);break;case"info":u.window.showInformationMessage(e.mes);break;case"warn":u.window.showWarningMessage(e.mes);break;case"openURL":Be(u.Uri.parse(e.url),this.#W);break;case"copyTxt":{if("copy.folder_save_app"!==e.id)break;const{username:t}=(0,C.userInfo)();switch(process.platform){case"win32":await u.env.clipboard.writeText(`C:\\Users\\${t}\\AppData\\Roaming\\${this.cfg.oCfg.save_ns}\\storage\\`);break;case"darwin":await u.env.clipboard.writeText(`/Users/${t}/Library/Application Support/${this.cfg.oCfg.save_ns}/storage/`);break;case"linux":await u.env.clipboard.writeText(`~/.config/${this.cfg.oCfg.save_ns}/storage/`)}u.window.showInformationMessage("クリップボードに【アプリ版（通常実行）セーブデータ保存先パス】をコピーしました")}break;case"selectFile":await T.cnvIconShape(e,this.#te)}}async#ae(e,t){switch(e){case"cnv.font.subset":if("はい"!==await u.window.showInformationMessage("フォントサイズ最適化（する / しない）を切り替えますか？",{modal:!0},"はい"))return!1;if(!s.fj.aReady[s.JJ.PY_FONTTOOLS])break;(0,a.Ni)(t)?await this.optFont.enable():await this.optFont.disable();break;case"cnv.mat.pic":if("はい"!==await u.window.showInformationMessage("画像ファイル最適化（する / しない）を切り替えますか？",{modal:!0},"はい"))return!1;(0,a.Ni)(t)?await this.optPic.enable():await this.optPic.disable();break;case"cnv.mat.snd":if("はい"!==await u.window.showInformationMessage("音声ファイル最適化（する / しない）を切り替えますか？",{modal:!0},"はい"))return!1;(0,a.Ni)(t)?await this.optSnd.enable():await this.optSnd.disable();break;case"cnv.mat.snd.codec":await this.optSnd.reconv()}return!0}}var D=n(31705);function H(e){return new Uint8Array(e.match(/../g)?.map((e=>parseInt(e,16)))??[]).buffer}function F(e){return[...new Uint8Array(e)].map((e=>e.toString(16).padStart(2,"0"))).join("")}function N(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}class j{hPass;subtle;#se;#ie;constructor(e,t){this.hPass=e,this.subtle=t,this.#se=JSON.stringify(e),this.#ie={name:"AES-GCM",iv:H(e.iv)}}get strHPass(){return this.#se}#re(e){return this.subtle.digest("SHA-512",(new TextEncoder).encode(e))}uuidv5(e){return(0,D.Ay)(e,this.hPass.pass)}async init(){const e=await this.subtle.importKey("raw",await this.#re(this.hPass.pass),"PBKDF2",!1,["deriveKey"]);this.#oe=await this.subtle.deriveKey({name:"PBKDF2",hash:"SHA-512",iterations:this.hPass.ite,salt:H(this.hPass.salt)},e,{name:this.#ie.name,length:256},!1,["encrypt","decrypt"])}#oe;encAb(e){return this.subtle.encrypt(this.#ie,this.#oe,e)}async enc(e){return N(await this.encAb((new TextEncoder).encode(e).buffer))}decAb(e){return this.subtle.decrypt(this.#ie,this.#oe,e)}async dec(e){return(new TextDecoder).decode(await this.decAb((t=e,Uint8Array.from(atob(t),(e=>e.charCodeAt(0)))).buffer));var t}}var L=n(57075),W=n(4573);class O extends L.Transform{encry;short_path;static#ce=10240;#le=O.#ce;#me=2;#de;#pe={jpg:1,jpeg:1,png:2,svg:3,webp:4,mp3:10,m4a:11,ogg:12,aac:13,flac:14,wav:15,mp4:20,webm:21,ogv:22};constructor(e,t){super(),this.encry=e,this.short_path=t,this.#de=W.Buffer.alloc(this.#me+this.#le),this.#de[0]=0,this.#de[1]=this.#pe[(0,R.extname)(t).slice(1)]??0}_transform(e,t,n){const a=e.length;if(0===this.#le)return this.push(e),void n();if(a<this.#le)return this.#de.set(e,this.#me),this.#me+=a,this.#le-=a,void n();this.#de.set(e.slice(0,this.#le),this.#me),this.#me+=this.#le;const s=this.#le;this.#he().then((()=>{a>s&&this.push(e.slice(s)),n()}))}_final(e){this.#he().then((()=>e()))}async#he(){if(0===this.#le)return;this.#le=0;const e=await this.encry.encAb(this.#de.buffer.slice(0,this.#me)),t=W.Buffer.alloc(4);t.writeUInt32LE(e.byteLength,0),this.push(t),this.push(new Uint8Array(e))}}var B=n(76760),M=n(51455);class J{arg;constructor(e){this.arg=e}async loadPath(e,t){const n=this.arg.cur+"path.json",a=await(0,f.readJson)(n,{encoding:"utf8"});for(const[t,n]of Object.entries(a)){const a=e[t]=n;for(const[e,t]of Object.entries(a))":cnt"!==e&&(a[e]=this.arg.cur+t)}}dec=(e,t)=>Promise.resolve(t);decAB=e=>Promise.resolve(e);set crypto(e){this.arg.crypto=e}fetch=async e=>new Response(await(0,f.readJson)(e,{encoding:"utf8"}));hash;$path_downloads="";get path_downloads(){return this.$path_downloads}$path_userdata="";get path_userdata(){return this.$path_userdata}}class Y extends h{sys;encry;constructor(e,t){super(e),this.sys=e,this.encry=t}setCryptoMode(e){this.sys.crypto=e}async loadEx(e,t){const n=this.sys.arg.cur+"prj.json",a=this.sys.arg.cur+"path.json";try{const s=await(0,f.readJson)(n,{encoding:"utf8"});await super.load({...r,...s,book:{...r.book,...s.book},window:{...r.window,...s.window},log:{...r.log,...s.log},init:{...r.init,...s.init},debug:{...r.debug,...s.debug},code:{...r.code,...s.code}}),this.hPathFn2Exts=await this.#ue(this.sys.arg.cur,t),await(0,f.outputJson)(a,this.hPathFn2Exts),this.sys.crypto&&await e(u.Uri.file(a))}catch(e){console.error(`Project loadPrjJs ${e} fpPrj=${n}= fpPath=${a}=`)}}#fe=/\.(js|css)$/;#ge=/^(.+)\.(\d+)x(\d+)\.(png|jpe?g)$/;async#ue(e,t){const n={},s=[],{mes:i,sev:r}=a.Fv.ファイル名合成文字;return(0,a.ad)(e,(()=>{}),(o=>{const c=(0,B.resolve)(e,o);(0,a.ad)(c,((e,l)=>{const m=[];this.#ye(n,o,l,m),l.normalize("NFC").length!==l.normalize("NFD").length&&m.push({mes:i,sev:r}),m.length>0&&(t[e]=m);const d=l.match(this.#fe);if(d){const t=l.slice(0,-d[0].length),a=n[t];a&&s.push((async()=>{const t=await(0,M.readFile)(e,{encoding:"utf8"});a[d[1]+":id"]="u5:"+this.encry.uuidv5(t)})())}const p=l.match(this.#ge);if(!p)return;const[,h="",g="",y=""]=p,b=(0,B.resolve)(c,h+".json");(0,f.existsSync)(b)||s.push((async()=>{const{width:s,height:i}=await(0,v.F)(e),r=(0,a._A)(g),c=(0,a._A)(y),d=s/r,_=i/c,S=p[4],w={frames:{},meta:{app:"skynovel",version:"1.0",image:p[0],format:"RGBA8888",size:{w:s,h:i},scale:1,animationSpeed:1}};let P=0;for(let e=0;e<r;++e)for(let t=0;t<c;++t)w.frames[h+String(++P).padStart(4,"0")+"."+S]={frame:{x:e*d,y:t*_,w:d,h:_},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:s,h:i},sourceSize:{w:d,h:_},pivot:{x:.5,y:.5}};await(0,f.writeJson)(b,w),u.window.showInformationMessage(`[SKYNovel] ${l} からスプライトシート用 ${h}.json を自動生成しました`),this.#ye(n,o,`${h}.json`,m),m.length>0&&(t[e]=m)})())}),(()=>{}))})),await Promise.allSettled(s),n}#ye(e,t,n,s){const{name:i,base:r,ext:o}=(0,B.parse)(n),c=o.slice(1);let l=e[i];if(l){if(c in l){const{mes:e,sev:t}=a.Fv.ファイル重複;return void s.push({mes:e.replace("$",r),sev:t})}}else l=e[i]={":cnt":0};l[":cnt"]=(0,a._A)(l[":cnt"])+1,l[c]=t+"/"+n}}var K=n(73024);const I="cnv.mat.pic",G=/\.(jpe?g|png)$/,U=/\.(htm|html)$/,z=/\w+\/\*WEBP\*\//g,V=/("image"\s*:\s*")([^.]+(?:\.\d+x\d+)?).*\.(jpe?g|png)"/,X='$1$2.webp","image_bkup":"$2.$3"',Q=/webp","image_bkup":".+(jpe?g|png)"/;class Z{PATH_WS;FLD_SRC;ps;#be;#_e;#O;#Se;constructor(e,t,n){this.PATH_WS=e,this.FLD_SRC=t,this.ps=n,this.#_e=e+`/${t}/batch/cnv_mat_pic.json`,this.#O=e+"/doc/prj/",this.#Se=e+`/${t}/${ke}/`,(async()=>{(0,K.existsSync)(this.#_e)?this.#be=await(0,w.Vh)(this.#_e,{encoding:"utf8"}):await(0,w.GF)(this.#_e,this.#be=c)})()}async go(e){const t={cmd:"notice.Component",id:I,mode:"wait"};this.ps.cmd2Vue(t);const n={location:u.ProgressLocation.Notification,title:"画像最適化処理",cancellable:!0};switch(e){case"enable":n.title="変換有効化";break;case"disable":n.title="変換無効化";break;case"reconv":n.title="再変換";break;case"prj_scan":n.title="prjフォルダ走査";break;case"base_scan":n.title="baseフォルダ走査"}await u.window.withProgress(n,((t,n)=>this.#ve(e,t,n))),t.mode="comp",this.ps.cmd2Vue(t)}disp(){this.ps.cmd2Vue({cmd:"update.optPic",oOptPic:{...this.#be,sum:{...this.#be.sum,pathPicOpt:this.ps.wvuWs+"/doc/prj/",pathPicBase:this.ps.wvuWs+`/${this.FLD_SRC}/${ke}/`}}})}async chgLog(e){await e(this.#be),await(0,w.GF)(this.#_e,this.#be),this.disp()}async#ve(e,t,n){const s=this.ps.oWss["cnv.mat.webp_quality"];this.#be={sum:{baseSize:0,webpSize:0,pathPicCmpWebP:"",pathPicCmpBase:""},hSize:{}},t.report({message:"処理ファイル調査中"});const i=[];switch(e){case"enable":(0,w.ah)(this.#Se),(0,a.ad)(this.#O,(()=>{}),(e=>{const t=(0,B.resolve)(this.#Se,e);(0,w.ah)(t),(0,a.ad)((0,B.resolve)(this.#O,e),((e,n)=>{G.test(n)?i.push((()=>this.#we(e,(0,B.resolve)(t,n),s))):U.test(n)?i.push((()=>Promise.try((()=>{(0,a.fR)(e,z,"true/*WEBP*/",!1)})))):n.endsWith(".json")&&i.push((()=>Promise.try((()=>{(0,a.fR)(e,V,X)}))))}),(()=>{}))}));break;case"disable":(0,a.ad)(this.#Se,(()=>{}),(e=>{(0,a.ad)((0,B.resolve)(this.#Se,e),((t,n)=>{if(!G.test(n))return;const a=(0,B.resolve)(this.#O,e,n);i.push((()=>(0,w.Cy)(t,a,{overwrite:!0})));const{name:s}=(0,B.parse)(n),r=(0,B.resolve)(this.#O,e,s+".webp");i.push((()=>(0,w.TF)(r)))}),(()=>{}))})),(0,a.ad)(this.#O,(()=>{}),(e=>{(0,a.ad)((0,B.resolve)(this.#O,e),((e,t)=>{if(U.test(t))return z.lastIndex=0,void i.push((()=>Promise.try((()=>{(0,a.fR)(e,z,"false/*WEBP*/",!1)}))));t.endsWith(".json")&&i.push((()=>Promise.try((()=>{(0,a.fR)(e,Q,'$1"')}))))}),(()=>{}))}));break;case"reconv":this.#Pe(this.#O,this.#Se),this.#be.sum.baseSize=this.#be.sum.webpSize=0;for(const{ext:e,fld_nm:t}of Object.values(this.#be.hSize))i.push((()=>this.#we((0,B.resolve)(this.#O,t+"."+e),(0,B.resolve)(this.#Se,t+"."+e),s,!1)));break;case"prj_scan":this.#Pe(this.#O,this.#Se),(0,w.ah)(this.#Se),(0,a.ad)(this.#O,(()=>{}),(e=>{const t=(0,B.resolve)(this.#Se,e);(0,w.ah)(t),(0,a.ad)((0,B.resolve)(this.#O,e),((e,n)=>{if(G.test(n)){const{name:a}=(0,B.parse)(n),r=this.#be.hSize[a];if(r){const{baseSize:e=0,webpSize:t=0}=r;this.#be.sum.baseSize-=e,this.#be.sum.webpSize-=t}i.push((()=>this.#we(e,(0,B.resolve)(t,n),s)))}else U.test(n)?i.push((async()=>Promise.try((()=>{(0,a.fR)(e,z,"true/*WEBP*/",!1)})))):n.endsWith(".json")&&i.push((()=>Promise.try((()=>{(0,a.fR)(e,V,X)}))))}),(()=>{}))}));break;case"base_scan":this.#Pe(this.#O,this.#Se),(0,a.ad)(this.#Se,(()=>{}),(e=>{const t=(0,B.resolve)(this.#Se,e);(0,w.ah)(t);const n=(0,B.resolve)(this.#O,e);(0,a.ad)(t,((e,t)=>{if(!G.test(e))return;const r=(0,B.resolve)(n,t.replace(G,".webp"));if(!(0,a.Wp)(e,r))return;const{name:o}=(0,B.parse)(t),c=this.#be.hSize[o];if(c){const{baseSize:e=0,webpSize:t=0}=c;this.#be.sum.baseSize-=e,this.#be.sum.webpSize-=t}i.push((()=>this.#we(r,e,s,!1)))}),(()=>{}))}));break;default:{this.#Pe(this.#O,this.#Se);const{dir:t,name:n,ext:a}=(0,B.parse)(e),i={...this.#be.hSize[n],fld_nm:(0,B.basename)(t)+"/"+n,ext:a.slice(1)};this.#be.sum.baseSize-=i.baseSize,this.#be.sum.webpSize-=i.webpSize,await this.#we(e,this.#O,s,Boolean(this.#Se))}}let r=0;await Promise.allSettled(i.map((e=>(async()=>{n.isCancellationRequested||(await e(),t.report({increment:++r/i.length*100,message:`処理中 ${String(++r)}/${String(i.length)} tasks`}))})()))).catch((e=>console.log(`fn:BatOptPic.ts ${String(e)}`))),await this.chgLog((async e=>{const t=Object.entries(this.#be.hSize).sort((([e],[t])=>{const n=e.toUpperCase(),a=t.toUpperCase();return n<a?-1:n>a?1:0}));this.#be.hSize=Object.fromEntries(t)})),t.report({message:"完了"})}#Pe(e,t){const n=this.#be;for(const[a,s]of Object.entries(this.#be.hSize)){const{fld_nm:i,ext:r,baseSize:o,webpSize:c}=s,l=i+"."+r;(0,K.existsSync)((0,B.resolve)(e,l))||(0,K.existsSync)((0,B.resolve)(t,l))?n.hSize[a]=s:(n.sum.baseSize-=o,n.sum.webpSize-=c)}this.#be=n}async#we(e,t,n,a=!0){a&&await(0,w.Cy)(e,t,{overwrite:!0})}async delRes(e){const t=(0,a.dd)(e);if(!(t in this.#be.hSize))return;const n=this.#be.hSize[t];if(!n)return;const{baseSize:s,webpSize:i}=n;this.#be.sum.baseSize-=s,this.#be.sum.webpSize-=i,delete this.#be.hSize[t],this.disp(),await(0,w.GF)(this.#_e,this.#be,{encoding:"utf8"})}}var ee=n(14784);class te{PATH_WS;#O;#xe=(0,K.mkdtempSync)("/tmp/BatPsdFace-");constructor(e){this.PATH_WS=e,this.#O=e+"/doc/prj/"}async go(e){const t=[],n=(await ee.A.open(e)).tree(),{document:{width:s,height:i}}=n.export();let r=`;#ED FACE\n; *******************************************************\n;#ED {"width":${String(s)}, "height":${String(i)}}\n`;const o=n.descendants();let c=o.length;for(;0<=--c;){const{type:e,parent:t}=o[c];if("group"===e||t.isRoot())break}let l="";const m=(0,a.dd)(e);o.forEach(((e,n)=>{const{type:a,name:o,parent:d}=e;if("group"===a)return r+=`;#ED FACE_FOLDER ${o}\n`,void(l="_"+o);d.isRoot()&&(""!==l&&(r+=";#ED FACE_FOLDER /\n"),l=""),r+=this.#ke(m+l,e,c<=n,t,s,i)})),r+="\n; *******************************************************\n\n[return]\n";const d=this.#O+`face/face${m}.sn`;await(0,w.bh)(d),t.push((0,w.i9)(d,r,"utf8")),await Promise.allSettled(t),await(0,w.TF)(this.#xe)}#ke(e,{name:t,left:n,top:a,width:s,height:i,layer:r},o,c,l,m){const d=e+"_"+t.replaceAll(this.#$e,"#"),p=`${this.#O}face/${d}.png`,h=r.blendingMode(),u=`${o?";":""}\t[add_face name=${d} dx=${n} dy=${a}${"normal"===h?"":` blendmode=${h}`}]\n`;if(!o)return c.push((async()=>{await r.image.saveAsPng(p)})()),u;const f=`${this.#xe}/${d}.png`;return c.push((async()=>{try{await r.image.saveAsPng(f)}catch(e){console.error((String(n<0||l-n-s<0||a<0||m-a-i<0),"。レイヤがキャンバスからはみ出ています。レイヤを動かすかトリミングしてください")),console.error(`  [ERR] ${String(e)}`)}})()),u}#$e=/[\\/:*?"<>|.\s]/g}const ne="doc/prj/*/*.{jpg,jpeg,png}";class ae extends T{#Te;#qe;async init(){await Promise.allSettled([T.watchFld(ne,"doc/prj/*/[FN].webp",(async()=>{}),((e,t)=>this.#Re(e,t)),(e=>this.#Ae(e)),!0),T.watchFld(`${T.FLD_SRC}/${ke}/*/*.{jpg,jpeg,png}`,"",void 0,((e,t)=>this.#Re(e,t)),(e=>this.#Ae(e)),!0),(0,w.Nc)(T.PATH_WS+`/${T.FLD_SRC}/resource/`),T.watchFld(`${T.FLD_SRC}/resource/*.psd`,`{doc/prj,${T.FLD_SRC}/${ke}}/face/{[FN]_*.png,[FN]_*.webp,face[FN].sn}`,(e=>this.#Ce(e)),((e,t)=>this.#Ee(e,t)),(()=>Promise.resolve(!0)),!0)]),this.#Te=new Z(T.PATH_WS,T.FLD_SRC,T.ps),this.#qe=new te(T.PATH_WS)}async#Re(e,t=!1){if(!T.ps.oWss[I])return;const n=(0,a.DH)(e.path),s=T.isBaseUrl(n);await this.#Te.go(s?"base_scan":"prj_scan");const i=this.#De(n);await T.encIfNeeded(u.Uri.file(i))}#De(e){return e.replace(T.PATH_PRJ_BASE,T.PATH_PRJ).replace(this.#He,".webp")}#He=/\.(jpeg|jpg|png)$/;async#Ae(e){if(!T.ps.oWss[I])return!0;const t=(0,a.DH)(e.path);if(!T.isBaseUrl(t)){const e=t.replace(T.PATH_PRJ,T.PATH_PRJ_BASE);return await Promise.allSettled(["jpeg","jpg","png"].map((t=>(0,w.TF)(e.replace(/webp$/,t))))),!0}return await(0,w.TF)(this.#De(t)),await this.#Te.delRes(t),!0}disp(){this.#Te.disp()}async enable(){return this.#Fe("enable","doc/prj/*/*.webp")}async disable(){return this.#Fe("disable",ne)}async#Fe(e,t){T.watchFile=!1,await T.delOldDiff(/\.(jpe?g|png|svg|webp)$/),await this.#Te.go(e),await Promise.allSettled((await u.workspace.findFiles(t)).map((e=>T.encIfNeeded(e)))),T.lasyPathJson(),T.watchFile=!0}async#Ce(e){const{fsPath:t}=e,n=(0,a.dd)(t);T.chkUpdate(t,`${T.PATH_PRJ}face/face${n}.sn`)&&await this.#Ee(e,!1)}async#Ee(e,t=!1){const{fsPath:n}=e;await this.#qe.go(n),T.ps.oWss[I]&&await this.#Te.go("prj_scan");const s=(0,a.dd)(n),i=await u.workspace.findFiles("doc/prj/*/[FN]_*.{jpg,jpeg,png,webp}".replaceAll("[FN]",s)),r=i.at(0)?.path.replace(/[^/]+\.\w+$/,`face${s}.sn`);r&&(0,K.existsSync)(r)&&i.push(u.Uri.file(r)),await Promise.allSettled(i.map((e=>T.encIfNeeded(e))))}async chgWebp_q_def(e){T.ps.oWss[I]&&(T.watchFile=!1,await T.wss.update("cnv.mat.webp_quality",T.ps.oWss["cnv.mat.webp_quality"]=e.webp_q),await this.#Te.go("reconv"),T.watchFile=!0)}async chgWebp_q(e){T.ps.oWss[I]&&(T.watchFile=!1,await this.#Te.chgLog((async t=>{const n=t.hSize[e.nm];e.no_def?n.webp_q=e.webp_q:delete n.webp_q,await this.#Re(u.Uri.file(T.PATH_PRJ_BASE+n.fld_nm+"."+n.ext))})),T.watchFile=!0)}}var se=n(38811),ie=n.n(se);const re="cnv.mat.snd",oe=/\.(mp3|wav)$/;class ce{PATH_WS;FLD_SRC;ps;#be;#_e;#O;#Se;constructor(e,t,n){this.PATH_WS=e,this.FLD_SRC=t,this.ps=n,this.#_e=e+`/${t}/batch/cnv_mat_snd.json`,this.#O=e+"/doc/prj/",this.#Se=e+`/${t}/${ke}/`,(async()=>{(0,K.existsSync)(this.#_e)?this.#be=await(0,w.Vh)(this.#_e,{encoding:"utf8"}):await(0,w.GF)(this.#_e,this.#be=l)})()}async go(e){const t={cmd:"notice.Component",id:re,mode:"wait"};this.ps.cmd2Vue(t);const n={location:u.ProgressLocation.Notification,title:"画像最適化処理",cancellable:!0};switch(e){case"enable":n.title="変換有効化";break;case"disable":n.title="変換無効化";break;case"reconv":n.title="再変換";break;case"prj_scan":n.title="prjフォルダ走査";break;case"base_scan":n.title="baseフォルダ走査"}await u.window.withProgress(n,((t,n)=>this.#ve(e,t,n))),t.mode="comp",this.ps.cmd2Vue(t)}disp(){this.ps.cmd2Vue({cmd:"update.optSnd",oOptSnd:{...this.#be,sum:{...this.#be.sum,pathSndOpt:this.ps.wvuWs+"/doc/prj/",pathSndBase:this.ps.wvuWs+`/${this.FLD_SRC}/${ke}/`}}})}async chgLog(e){await e(this.#be),await(0,w.GF)(this.#_e,this.#be),this.disp()}async#ve(e,t,n){const s=this.ps.oWss["cnv.mat.snd.codec"],i="."+s,r="."+("opus"===s?"m4a":s);this.#be={sum:{baseSize:0,optSize:0,pathSndOpt:"",pathSndBase:""},hSize:{}},t.report({message:"処理ファイル調査中"});const o=[];switch(e){case"enable":(0,w.ah)(this.#Se),(0,a.ad)(this.#O,(()=>{}),(e=>{const t=(0,B.resolve)(this.#Se,e);(0,w.ah)(t),(0,a.ad)((0,B.resolve)(this.#O,e),((e,n)=>{oe.test(n)&&o.push((()=>this.#we(i,r,e,(0,B.resolve)(t,n))))}),(()=>{}))}));break;case"disable":(0,a.ad)(this.#Se,(()=>{}),(e=>{(0,a.ad)((0,B.resolve)(this.#Se,e),((t,n)=>{if(!oe.test(n))return;const a=(0,B.resolve)(this.#O,e,n);o.push((async()=>(0,w.Cy)(t,a,{overwrite:!0})));const s=a.slice(0,-3);for(const e of["m4a","aac","ogg"])o.push((()=>(0,w.TF)(s+e)))}),(()=>{}))}));break;case"reconv":this.#Pe(this.#O,this.#Se),this.#be.sum.baseSize=this.#be.sum.optSize=0;for(const{ext:e,fld_nm:t}of Object.values(this.#be.hSize))o.push((()=>this.#we(i,r,(0,B.resolve)(this.#O,t+"."+e),(0,B.resolve)(this.#Se,t+"."+e),!1)));break;case"prj_scan":this.#Pe(this.#O,this.#Se),(0,w.ah)(this.#Se),(0,a.ad)(this.#O,(()=>{}),(e=>{const t=(0,B.resolve)(this.#Se,e);(0,w.ah)(t),(0,a.ad)((0,B.resolve)(this.#O,e),((e,n)=>{if(oe.test(n)){const{name:a}=(0,B.parse)(n),s=this.#be.hSize[a];if(s){const{baseSize:e=0,optSize:t=0}=s;this.#be.sum.baseSize-=e,this.#be.sum.optSize-=t}o.push((()=>this.#we(i,r,e,(0,B.resolve)(t,n))))}}),(()=>{}))}));break;case"base_scan":this.#Pe(this.#O,this.#Se),(0,a.ad)(this.#Se,(()=>{}),(e=>{const t=(0,B.resolve)(this.#Se,e);(0,w.ah)(t);const n=(0,B.resolve)(this.#O,e);(0,a.ad)(t,((e,t)=>{if(!oe.test(e))return;const s=(0,B.resolve)(n,t.replace(oe,".webp"));if(!(0,a.Wp)(e,s))return;const{name:c}=(0,B.parse)(t),l=this.#be.hSize[c];if(l){const{baseSize:e=0,optSize:t=0}=l;this.#be.sum.baseSize-=e,this.#be.sum.optSize-=t}o.push((()=>this.#we(i,r,s,e,!1)))}),(()=>{}))}));break;default:{this.#Pe(this.#O,this.#Se);const{dir:t,name:n,ext:a}=(0,B.parse)(e),s={...this.#be.hSize[n],fld_nm:(0,B.basename)(t)+"/"+n,ext:a.slice(1)};this.#be.sum.baseSize-=s.baseSize,this.#be.sum.optSize-=s.optSize,await this.#we(i,r,e,this.#O,Boolean(this.#Se))}}let c=0;await Promise.allSettled(o.map((e=>(async()=>{n.isCancellationRequested||(await e(),t.report({increment:++c/o.length*100,message:`処理中 ${String(++c)}/${String(o.length)} tasks`}))})()))).catch((e=>console.log(`fn:BatOptSnd.ts ${String(e)}`))),await this.chgLog((async e=>{const t=Object.entries(this.#be.hSize).sort((([e],[t])=>{const n=e.toUpperCase(),a=t.toUpperCase();return n<a?-1:n>a?1:0}));this.#be.hSize=Object.fromEntries(t)})),t.report({message:"完了"})}#Pe(e,t){const n=this.#be;for(const[a,s]of Object.entries(this.#be.hSize)){const{fld_nm:i,ext:r,baseSize:o,optSize:c}=s,l=i+"."+r;(0,K.existsSync)((0,B.resolve)(e,l))||(0,K.existsSync)((0,B.resolve)(t,l))?n.hSize[a]=s:(n.sum.baseSize-=o,n.sum.optSize-=c)}this.#be=n}async#we(e,t,n,a,s=!0){const{dir:i,name:r}=(0,B.parse)(n);s?await(0,w.Cy)(n,a,{overwrite:!0}):await Promise.allSettled(["m4a","aac","ogg"].map((e=>(0,w.TF)(i+"/"+r+"."+e))));const{dir:o,ext:c}=(0,B.parse)(a),l=o+"/"+r+e,m=this.#be.hSize[r]??={fld_nm:(0,B.basename)(i)+"/"+r,baseSize:0,optSize:0,ext:""};await new Promise((e=>ie()(a).save(l).on("error",(e=>console.error(e))).on("end",((n,s)=>{const o=(0,K.statSync)(a).size,d=(0,K.statSync)(l).size;this.#be.hSize[r]={...m,baseSize:o,optSize:d,ext:c.slice(1)},this.#be.sum.baseSize+=o,this.#be.sum.optSize+=d,(0,w.TK)(l,i+"/"+r+t,{overwrite:!0}),e()}))))}async delRes(e){const t=(0,a.dd)(e);if(!(t in this.#be.hSize))return;const n=this.#be.hSize[t];if(!n)return;const{baseSize:s,optSize:i}=n;this.#be.sum.baseSize-=s,this.#be.sum.optSize-=i,delete this.#be.hSize[t],this.disp(),await(0,w.GF)(this.#_e,this.#be,{encoding:"utf8"})}}const le="doc/prj/*/*.{mp3,wav}";class me extends T{#Te;async init(){await Promise.allSettled([T.watchFld(le,"doc/prj/*/[FN].{m4a,aac,ogg}",(async()=>{}),((e,t)=>this.#Re(e,t)),(e=>this.#Ae(e)),!0),T.watchFld(`${T.FLD_SRC}/${ke}/*/*.{mp3,wav}`,"",void 0,((e,t)=>this.#Re(e,t)),(e=>this.#Ae(e)),!0)]),this.#Te=new ce(T.PATH_WS,T.FLD_SRC,T.ps)}async#Re(e,t=!1){if(!T.ps.oWss[re])return;const n=(0,a.DH)(e.path),s=T.isBaseUrl(n);await this.#Te.go(s?"base_scan":"prj_scan"),await T.encIfNeeded(u.Uri.file(this.#De(n)))}#De(e){e=e.replace(T.PATH_PRJ_BASE,T.PATH_PRJ);for(const t of["m4a","aac","ogg"]){const n=e.replace(this.#He,"."+t);if((0,f.existsSync)(n))return n}return e}#He=/\.(mp3|wav)$/;async#Ae(e){if(!T.ps.oWss[re])return!0;const t=(0,a.DH)(e.path);if(!T.isBaseUrl(t)){const e=t.replace(T.PATH_PRJ,T.PATH_PRJ_BASE);return await Promise.allSettled(["mp3","wav"].map((t=>(0,f.remove)(e.replace(/(m4a|aac|ogg)$/,t))))),!0}return await Promise.allSettled(["m4a","aac","ogg"].map((e=>(0,f.remove)(t.replace(T.PATH_PRJ_BASE,T.PATH_PRJ).replace(this.#He,"."+e))))),await this.#Te.delRes(t),!0}disp(){this.#Te.disp()}async enable(){return this.#Fe("enable","doc/prj/*/*.{m4a,aac,ogg}")}async disable(){return this.#Fe("disable",le)}async#Fe(e,t){T.watchFile=!1,await T.delOldDiff(this.#Ne),await this.#Te.go(e),await Promise.allSettled((await u.workspace.findFiles(t)).map((e=>T.encIfNeeded(e)))),T.lasyPathJson(),T.watchFile=!0}#Ne=/\.(mp3|m4a|ogg|aac|flac|wav)$/;async reconv(){T.ps.oWss[re]&&(T.watchFile=!1,await T.delOldDiff(this.#Ne),await this.#Te.go("reconv"),T.lasyPathJson(),T.watchFile=!0)}}var de=n(48161);class pe extends T{constructor(){super();const{username:e}=(0,de.userInfo)();this.#je=[`${T.PATH_WS}/${T.FLD_SRC}/font`,a.Ex?`C:/Users/${e}/AppData/Local/Microsoft/Windows/Fonts`:`/Users/${e}/Library/Fonts`,a.Ex?"C:/Windows/Fonts":"/Library/Fonts"],this.#Le={"::PATH_PRJ_F":`${T.FLD_SRC}/font/ 下）`,"::PATH_USER_":"OS（ユーザー別）へのインストール済みフォント","::PATH_OS_FO":"OS（ユーザー共通）へのインストール済みフォント"}}async init(e,t){await T.watchFld("doc/prj/*/*.{sn,json,woff2,woff,otf,ttf,htm,html,css,js}","",(async()=>{}),(async({path:t},n)=>(n&&/\.ss?n$/.test(t)&&await T.sendNeedGo(),e(t))),(async({path:e})=>(/\.ss?n$/.test(e)&&await T.sendNeedGo(),t(e))),!0)}async enable(){await this.#We(!0),T.lasyPathJson()}async disable(){await this.#We(!1),T.lasyPathJson()}async#We(e){T.watchFile=!1;const t={cmd:"notice.Component",id:"cnv.font.subset",mode:"wait"};if(T.ps.cmd2Vue(t),(0,a.ad)(T.PATH_PRJ+"script/",(async(e,t)=>{this.#Oe.test(t)&&await(0,f.remove)(e)}),(()=>{})),!e)return await T.exeBatch("subset_font",`"${T.FLD_SRC}"`),await this.disp(),t.mode="comp",T.ps.cmd2Vue(t),void(T.watchFile=!0);const n={};n[o]={inp:"",txt:""};const s=e=>n[e]??={inp:this.#Be(e).replace(new RegExp(`^.+/${T.FLD_SRC}/font`),"::PATH_PRJ_FONTS::").replace(a.Ex?/C:\/Users\/[^/]+\/AppData\/Local\/Microsoft\/Windows\/Fonts/:/\/Users\/[^/]+\/Library\/Fonts/,"::PATH_USER_FONTS::").replace(a.Ex?"C:/Windows/Fonts":"/Library/Fonts","::PATH_OS_FONTS::"),txt:""},i=this.#Me;for(const e of Object.values(i.hSn2Font2Str))for(const[t,a]of Object.entries(e))s(t),n[t].txt+=a;s(i.defaultFontName),(n[i.defaultFontName]??={inp:"",txt:""}).txt+=n[o].txt,delete n[o];for(const e of Object.values(n)){const t=new Set(Array.from(e.txt));e.txt=[...t].sort().join("")}const r=`${T.PATH_WS}/${T.FLD_SRC}/font/`;await(0,f.outputJson)(`${r}font.json`,n),await T.exeBatch("subset_font",`"${T.FLD_SRC}" --minify`),await this.disp(),t.mode="comp",T.ps.cmd2Vue(t),T.watchFile=!0}#Oe=/\.(woff2?|otf|ttf)$/i;#Me={defaultFontName:"",hSn2Font2Str:{},hFp2FontErr:{}};updDiag(e){this.#Me=e;const t={};for(const[e,n]of Object.entries(this.#Me.hFp2FontErr)){const a=[];for(const{err:e,nm:t}of n)this.#Be(t)||a.push({mes:e,sev:"E"});a.length>0&&(t[e]=a)}return t}#Be(e){for(const t of this.#je)for(const n of["woff2","otf","ttf","WOFF2","OTF","TTF"]){const a=`${t}/${e}.${n}`;if((0,f.existsSync)(a))return a}return""}#je;#Le;async disp(){if(!T.ps.isOpenPnlWV)return;const e=`${T.PATH_WS}/${T.FLD_SRC}/font/subset_font.json`;if(!(0,f.existsSync)(e))return void T.ps.cmd2Vue({cmd:"update.cnvFont",aCnvFont:[]});const t=await(0,f.readJson)(e),n=Object.entries(t).map((([e,t])=>({nm:e,mes:this.#Le[t.inp.slice(0,12)],iSize:t.iSize,oSize:t.oSize,err:t.err})));n.sort(),T.ps.cmd2Vue({cmd:"update.cnvFont",aCnvFont:n})}}var he=n(52566);class ue{PATH_DIFF;FLD_SRC;PATH_CRYPT;encry;#Je=Object.create(null);constructor(e,t,n,a){this.PATH_DIFF=e,this.FLD_SRC=t,this.PATH_CRYPT=n,this.encry=a;const s=`\\/(doc\\/prj|${t}\\/${ke})\\/`;this.#Ye=new RegExp(s+".+$"),this.#Ke=new RegExp("^.+"+s)}async init(){(0,K.existsSync)(this.PATH_DIFF)&&(this.#Je=await(0,w.Vh)(this.PATH_DIFF));for(const[e,{cn:t}]of Object.entries(this.#Je)){const n=`${this.PATH_CRYPT}${t}`;(0,K.existsSync)(n)||delete this.#Je[e]}}clear(){this.#Je=Object.create(null)}del(e){delete this.#Je[e]}get(e){return this.#Je[e]}get keysPP(){return Object.keys(this.#Je)}path2cn(e){e=(0,a.DH)(u.Uri.file(e).path);const t=this.fp2pp(e),n=this.#Je[t];return{pathCn:n?e.replace(this.#Ye,`/${xe}/prj/${n.cn}`):void 0,diff:n,pp:t}}#Ye;#Ke;fp2pp(e){return e.replace(this.#Ke,"")}filter(e){return Promise.allSettled(Object.entries(this.#Je).filter((([t])=>e.test(t))).map((([,{cn:e}])=>(0,w.TF)(`${this.PATH_CRYPT}${e}`))))}save=()=>(0,w.GF)(this.PATH_DIFF,this.#Je);isDiff({path:e}){const t=(0,a.DH)(e),{pathCn:n,diff:s,pp:i}=this.path2cn(t);if(n&&!(0,K.existsSync)(n))return!0;let r=0;if(Te.test(t))r=he.buf(Buffer.from((0,K.readFileSync)(t,{encoding:"utf8"}),"binary"),0);else{this.#Ie.fill(0,0,this.#Ge);const e=(0,K.openSync)(t,"r");(0,K.readSync)(e,this.#Ie,0,this.#Ge,0),(0,K.closeSync)(e),r=he.buf(this.#Ie,0)}return s?.hash!==r&&(this.#Je[i]={hash:r,cn:$e.test(i)?i.replace(this.#Ue,`$1/${this.encry.uuidv5(i)}$2`).replace(this.#ze,".bin"):i},!0)}#Ge=20480;#Ue=/([^/]+)\/[^/]+(\.\w+)/;#Ie=new Uint8Array(this.#Ge);#ze=/\.(jpe?g|png|svg|webp|mp3|m4a|ogg|aac|flac|wav|mp4|webm|ogv)/g}var fe=n(99133),ge=n(35317),ye=n(85059),be=n.n(ye),_e=n(29485),Se=n.n(_e),ve=n(38969),we=n.n(ve);const{subtle:Pe}=A.webcrypto,xe="doc_crypto",ke="prj_base",$e=/\.(ss?n|json|html?|jpe?g|png|svg|webp|mp3|m4a|ogg|aac|flac|wav|mp4|webm|ogv|html?)$/,Te=/\.(ss?n|json|html?)$/;class qe{ctx;actBar;wsFld;aTiRoot;emPrjTD;hOnEndTask;reqPrj2LSP;#W;#O;#Ve;#Xe;#Se;#Qe;#Ze;#_=!1;#et;#tt;#y;#nt;#z=[];#at;#st=[];enableBtn(e){if(e)for(const e of this.#st)e.contextValue=e.contextValue?.trimEnd(),this.emPrjTD.fire(e);else for(const e of this.#st)e.contextValue+=" ",this.emPrjTD.fire(e)}#it={};#rt={};#ot;static#ct={};static#lt=new Map([[d.SP_GSM,["bg","image"]],[d.SOUND,["music","sound"]],[d.FONT,["script"]],[d.SCRIPT,["script"]]]);#mt;#dt;#pt;constructor(e,t,n,i,r,o,c){this.ctx=e,this.actBar=t,this.wsFld=n,this.aTiRoot=i,this.emPrjTD=r,this.hOnEndTask=o,this.reqPrj2LSP=c;const l=n.uri.path;this.#W=(0,a.DH)(l),this.#O=`${this.#W}/doc/prj/`,this.#Ve=this.#O.length;const m=this.#et=(0,f.existsSync)(`${this.#W}/src/plugin/`);this.#Xe=m?"src":"core",this.#Se=`${this.#W}/${this.#Xe}/${ke}/`,this.#Qe=`${this.#W}/${this.#Xe}/plugin/snsys_pre/`,this.#ht=n.uri.fsPath+"/doc/prj/",this.#Ze=`${this.#W}/${xe}/prj/`;{const e=`${this.#W}/doc/crypto_prj/`;(0,f.existsSync)(e)&&(0,f.moveSync)(e,this.#Ze);const t=`${this.#W}/.gitignore`;(0,f.existsSync)(t)&&(0,a.fR)(t,/\/doc\/crypto_prj\n/,`/${xe}\n`,!1),(0,a.fR)(this.#W+"/package.json",/"doc\/crypto_prj\/",/,`"${xe}/prj/",`,!1)}this.#_=(0,f.existsSync)(this.#Ze);const d=this.#W+"/pass.json",p=(0,f.existsSync)(d);this.#tt=new j(p?(0,f.readJsonSync)(d,{throws:!1}):{pass:(0,A.randomUUID)(),salt:F((0,A.getRandomValues)(new Uint32Array(16)).buffer),iv:F((0,A.getRandomValues)(new Uint32Array(16)).buffer),keySize:16,ite:500+Math.floor((new Date).getTime()%300),stk:F((0,A.getRandomValues)(new Uint32Array(16)).buffer)},Pe),p||(0,f.outputFile)(d,this.#tt.strHPass),this.#ut=m?[`${this.#Xe}/web.ts`,`${this.#Xe}/renderer/renderer.ts`]:[`${this.#Xe}/app4webpack.js`,`${this.#Xe}/web4webpack.js`];const h=new J({cur:this.#O,crypto:this.#_,dip:""});this.#ot=new Y(h,this.#tt),this.#y=new ue(`${this.#W}/${this.#Xe}/diff.json`,this.#Xe,this.#Ze,this.#tt),T.init(e,n,(async()=>{qe.#ct={},await this.#ot.loadEx((e=>this.#ft(e)),qe.#ct);for(const[e,t]of qe.#lt)this.#gt.set(e,t.filter((e=>(0,f.existsSync)(this.#W+`/doc/prj/${e}/`))));await this.reqPrj2LSP({cmd:"need_go"})}),(e=>this.#yt(e)),this.#y,this.#Xe,this.#bt,this.hOnEndTask,m,(()=>this.#_));const g=S.create(e,n,((e,t,n)=>{this.#_t(e,t,n)}),m);i.push(g),this.#z.push(this.#nt=new E(e,n,this.#ot,(e=>{g.label=e,r.fire(g)}),this.reqPrj2LSP,this.#y,this.#mt=new ae,this.#dt=new me,this.#pt=new pe,this.#Xe,m)),T.init2th(this.#nt);const y=g.children,b=y.at(-1).children;this.#st=[...y.slice(0,-1),...b];const v=y[_.SnUpd];this.getLocalSNVer=()=>{const e=this.#nt.getLocalSNVer();return v.description=e.verSN?e.verSN.startsWith("ile:")||e.verSN.startsWith("./")?"（相対パス参照中）":`-- ${e.verSN}${e.verTemp?` - ${e.verTemp}`:""}`:"取得できません",r.fire(v),e};const w=y[_.Crypto];this.#at=()=>{w.description="-- "+(this.#_?"する":"しない"),r.fire(w)},this.#tt.init().then((()=>Promise.allSettled([async()=>{await this.#St(),this.#at(),(0,a.ad)(this.#O,(()=>{}),(e=>{e in this.#ot.oCfg.code||(this.#ot.oCfg.code[e]=!1)}))},async()=>{if(!m){for await(const e of(0,M.glob)(this.#W+"/doc/{app/app,web}.vendors-node_modules_*.js"))await(0,f.unlink)(e);(0,a.fR)(this.#W+"/package.json",/github.com:famibee\/SKYNovel_/,"github.com:famibee/tmp_cjs_",!1),(0,a.fR)(this.#W+"/package.json",/ && npm i && npm run webpack:dev/,' && npm i",\n\t\t"postinstall": "npm run webpack:dev',!1)}for await(const e of(0,M.glob)(this.#W+"/build/{cnv_*,cut_round,subset_font}.{js,json}")){const t=e.replace("/build/",`/${this.#Xe}/batch/`);await(0,f.move)(e,t)}const t=`${this.#W}/doc/${ke}/`;(0,f.existsSync)(t)&&await(0,f.move)(t,this.#Se);const n=this.#W+"/.vscode/settings.json";if((0,f.existsSync)(n)){const e=await(0,f.readJson)(n,{encoding:"utf8"});"terminal.integrated.env.windows"in e||(e["terminal.integrated.env.windows"]={PATH:"${workspaceRoot}\\node_modules\\.bin;${env:PATH}"},e["terminal.integrated.env.osx"]={PATH:"${workspaceRoot}/node_modules/.bin:${env:PATH}"},await(0,f.writeFile)(n,JSON.stringify(e,null,"\t")))}else await(0,f.copyFile)(e.extensionPath+"/res/settings.json",n)},async()=>{const e=!(0,f.existsSync)(this.#W+"/node_modules");await this.#vt(e),e?s.fj.aReady[s.JJ.NPM]&&u.window.showInformationMessage("初期化中です。ターミナルの処理が終わって止まるまでしばらくお待ち下さい。",{modal:!0}):await t.chkLastSNVer([this.getLocalSNVer()])},()=>this.#mt.init(),()=>this.#dt.init(),()=>this.#pt.init((async e=>{await this.#yt(u.Uri.file(e)),/\.(ss?n|json)$/.test(e)&&(this.#wt(e),await this.reqPrj2LSP({cmd:"upd_diag",haDiag:this.#Pt}))}),(async e=>!!/\.(ss?n|json)$/.test(e)&&(delete this.#rt[e],await this.reqPrj2LSP({cmd:"upd_diag",haDiag:this.#Pt}),!0))),()=>this.#y.init(),()=>Promise.try((()=>this.#z.push(u.workspace.createFileSystemWatcher(new u.RelativePattern(n,"doc/prj/prj.json")).onDidChange((e=>this.#yt(e))),u.debug.onDidTerminateDebugSession((e=>this.#xt())),u.debug.onDidStartDebugSession((e=>this.#kt.push(e))),u.languages.registerEvaluatableExpressionProvider(a.hF,{provideEvaluatableExpression(e,t){const n=e.getWordRangeAtPosition(t,qe.#$t);if(!n)throw new Error("No word here.");const a=e.getText(n),s=a.at(0);if("["===s||"*"===s||";"===s||a.endsWith("="))throw new Error("No word here.");return new u.EvaluatableExpression(n,a)}}))))].map((e=>e()))))).then((async()=>{await T.init3th((()=>this.reqPrj2LSP({cmd:"need_go"}))),await this.reqPrj2LSP({cmd:"ready"})}))}static#$t=/;.+|[[*]?[\d\w.]+=?/;getLocalSNVer;#kt=[];#xt=()=>{};dispose(){for(const e of this.#z)e.dispose();this.#Tt(),this.#bt.forEach((e=>e.terminate())),this.#bt.clear()}#Tt(){this.#bt.get("TaskWeb")?.terminate(),this.#bt.delete("TaskWeb"),this.#bt.get("TaskApp")?.terminate(),this.#bt.delete("TaskApp");const e=this.#kt.map((e=>u.debug.stopDebugging(e)));return this.#kt=[],Promise.allSettled(e)}onRequest(e){switch(e.cmd){case"go":{this.#it=this.#pt.updDiag(e.InfFont);const t={};this.#rt={},(0,a.fv)(this.#O,(e=>{/\.(ss?n|json)$/.test(e)&&this.#wt(e,t)})),this.reqPrj2LSP({cmd:"go.res",pp2s:t,hDefPlg:this.#qt,haDiag:this.#Pt})}break;case"analyze_inf":this.#Rt=[...Oe,{kind:u.QuickPickItemKind.Separator,label:""},...e.aQuickPickMac.map((({label:e,description:t,uri:n})=>({label:e,description:t,uri:u.Uri.parse(n)}))),{kind:u.QuickPickItemKind.Separator,label:""},...e.aQuickPickPlg.map((({label:e,description:t,uri:n})=>({label:e,description:t,uri:u.Uri.parse(n)})))],this.#At=new Map(e.aExt2Snip);break;case"hover.res":this.#Ct[e.fp]?.shift()?.(e)}}#wt(e,t){const n=u.workspace.textDocuments.find((t=>(0,a.DH)(t.uri.path)===e)),s=this.#Et(e),i=a.FC.test(e)?n?.getText():void 0;let r;if(i)t&&(t[s]=i),r=n?.encoding??"";else{const n=(0,K.readFileSync)(e);t&&(t[s]=n.toString("utf-8")),r=we().detect(n)}if(/(UTF8|ASCII)$/i.test(r))return void delete this.#rt[e];const{mes:o,sev:c}=a.Fv.文字コード異常;this.#rt[e]=[{mes:o.replace("$",r),sev:c}]}get#Pt(){return{...qe.#ct,...this.#it,...this.#rt}}#Et(e){return e.slice(this.#Ve)}#Ct={};provideHover(e,t){const n=(0,a.DH)(e.uri.path);return new Promise((e=>{(this.#Ct[n]??=[]).push((({value:t})=>{const n=t.split(/(?=\n---\n)/);if(3!==n.length){const n=new u.MarkdownString(t);return n.isTrusted=!0,void e(new u.Hover(n))}const[a="",...s]=n;new(Se())(s.join("")).replaceAll(/<!-- ({.+?}) -->/g,(async e=>{const{name:t,val:n}=JSON.parse(e.slice(5,-4)),a=this.#ot.searchPath(n,d.SP_GSM),s=this.#ht+a,i=`${s}|width=${this.#Dt}|height=${this.#Dt}`,{width:r,height:o}=await(0,v.F)(this.#O+a),c=encodeURIComponent(JSON.stringify([u.Uri.file(s)]));return`- ${t} = ${n} (${r}x${o}) [ファイルを見る](${s} "ファイルを見る") [サイドバーに表示](${String(u.Uri.parse(`command:revealInExplorer?${c}`))} "サイドバーに表示")\n\t[フォルダを開く](${String(u.Uri.parse(`command:revealFileInOS?${c}`))} "フォルダを開く")  \n![${n}](${i} "${n}")`})).then((t=>{const n=new u.MarkdownString(a+t.toString());n.isTrusted=!0,e(new u.Hover(n))})).catch((e=>console.error(e)))})),this.reqPrj2LSP({cmd:"hover",fp:n,pos:t})}))}#ht;#Dt=200;#Rt=[];openReferencePallet(){u.window.showQuickPick(this.#Rt,{placeHolder:"どのリファレンスを開きますか?",matchOnDescription:!0}).then((e=>{e?.uri&&Be(e.uri,this.#W)}))}opView(e){this.#nt.pnlWVFolder.open(e)}#Ht=new Map([["Crypto",["","","","","","","","","","","",""]],["TaskWeb",["_off","_off","","_off","Stop","_off","_off","_off","_off","_off","_off","_off"]],["TaskWebDbg",["_off","_off","","_off","Stop","_off","_off","_off","_off","_off","_off","_off"]],["TaskWebStop",["","","","","","","","","","","",""]],["TaskAppDbgStop",["","","","","","","","","","","",""]]]);async#_t(e,t,n){if(!s.fj.aReady[s.JJ.NPM])return;const a=this.#Ht.get(t)??["_off","_off","_off","_off","_off","_off","_off","_off","_off","_off","_off","_off"];this.#st.forEach(((e,t)=>{e.contextValue+=a[t],this.emPrjTD.fire(e)})),"TaskWebStop"!==t&&"TaskAppStop"!==t?await u.window.withProgress({location:u.ProgressLocation.Notification,title:"string"==typeof e.label?e.label:e.label?.label,cancellable:!1},(a=>new Promise((s=>{const i=e.iconPath;e.iconPath=new u.ThemeIcon("sync~spin"),this.#Ft(e,t,n,((t=4e3)=>{e.iconPath=i;for(const e of this.#st){const t=e.contextValue;t&&(t.endsWith("_off")||t.endsWith("Stop"))&&(e.contextValue=t.slice(0,-4)),this.emPrjTD.fire(e)}a.report({message:"完了",increment:100}),setTimeout((()=>s(0)),t)}))})))):await this.#Ft(e,t,n,(()=>{}))}async#Ft(e,t,n,s){let i=`cd "${this.#W}" ${y} `;switch((0,f.existsSync)(this.#W+"/node_modules")||(i+=`npm i ${y} `,await(0,f.remove)(this.#W+"/package-lock.json")),n.npm&&(i+=n.npm),t){case"SnUpd":try{await this.#Tt(),await this.actBar.updPrjFromTmp(this.#W),await be()({packageFile:this.#W+"/package.json",upgrade:!0,target:"minor"}),this.getLocalSNVer(),await this.#Ft(e,"SnUpd_waited",n,s)}catch(e){console.error("fn:Project.ts onBtn_sub SnUpd e:%o",e),s(0)}return;case"SnUpd_waited":case"Crypto_waited":break;case"PrjSet":return this.#nt.open(),void s(0);case"Crypto":try{if("はい"!==await u.window.showInformationMessage("暗号化（する / しない）を切り替えますか？",{modal:!0},"はい"))return void s(0);await this.#Tt(),await this.#Nt(),await this.#Ft(e,"Crypto_waited",n,s)}catch(e){console.error("fn:Project.ts onBtn_sub Crypto e:%o",e)}return;case"TaskWebDbg":case"TaskAppDbg":return await this.#Tt(),this.#xt=()=>{this.#xt=()=>{},s(0)},void await u.debug.startDebugging(this.wsFld,("TaskWebDbg"===t?"web":"app")+"デバッグ");case"TaskWebStop":case"TaskAppStop":return await this.#Tt(),void s(0);case"PackWin":case"PackWin32":case"PackMac":case"PackMacArm64":case"PackLinux":await this.#Tt();break;case"PackFreem":{await this.#Tt();let e=!1;if((0,a.fv)(this.#O,(t=>{!e&&t.endsWith(".svg")&&(e=!0,u.window.showErrorMessage("ふりーむ！では svg ファイル使用禁止です。png などに置き換えて下さい","フォルダを開く","Online Converter").then((async e=>{switch(e){case"フォルダを開く":await u.env.openExternal(u.Uri.file((0,B.dirname)(t)));break;case"Online Converter":await u.env.openExternal(u.Uri.parse("https://cancerberosgx.github.io/demos/svg-png-converter/playground/"))}})))})),e)return void s()}}switch(t){case"PackWin":case"PackWin32":if(!a.Ex)break;if(!/(Restricted|AllSigned)/.test((0,ge.execSync)("PowerShell Get-ExecutionPolicy").toString()))break;return s(),void await u.window.showErrorMessage("管理者として開いたPowerShell で実行ポリシーを RemoteSigned などに変更して下さい。\n例）Set-ExecutionPolicy RemoteSigned",{modal:!0},"参考サイトを開く").then((async e=>{e&&await u.env.openExternal(u.Uri.parse("https://qiita.com/Targityen/items/3d2e0b5b0b7b04963750"))}))}const r=n.task_type??"Pkg",o=new u.Task({type:Me+r},this.wsFld,n.label,"SKYNovel",new u.ShellExecution(i));switch(this.hOnEndTask.set(r,(()=>s())),t){case"SnUpd_waited":this.hOnEndTask.set(r,(()=>{this.getLocalSNVer(),s()}));break;case"Crypto_waited":this.hOnEndTask.set(r,(()=>{this.#at(),s()}));break;case"PackWin":case"PackWin32":case"PackMac":case"PackMacArm64":case"PackLinux":this.hOnEndTask.set(r,(()=>{Promise.resolve((async()=>{const e=await(0,f.readJson)(this.#W+"/package.json",{encoding:"utf8"}),s=this.#W+"/build/package",i=s+"/update",r=i+"/_index.json";let o=(0,f.existsSync)(r)?await(0,f.readJson)(r,{encoding:"utf8"}):{};const c="Mac"===t.slice(4,7),l="Lin"===t.slice(4,7),m=s+`/latest${c?"-mac":l?"-linux":""}.yml`;if(!(0,f.existsSync)(m))throw"必要なファイルが生成されませんでした";const d=await(0,M.readFile)(m,{encoding:"utf8"}),p=/version: (.+)/.exec(d);if(!p)throw"[Pack...] .yml に version が見つかりません";const h=p[1];o.version==h&&o.name==e.name||(o={},await(0,f.remove)(i),await(0,f.mkdirs)(i)),o.version=e.version,o.name=e.name;const g=/path: (.+)/.exec(d);if(!g)throw"[Pack...] .yml に path が見つかりません";const y=g[1],b=/size: (.+)/.exec(d);if(!b)throw"[Pack...] .yml に size が見つかりません";const _=Number(b[1]??NaN),S=/sha512: (.+)/.exec(d);if(!S)throw"[Pack...] .yml に sha512 が見つかりません";const v=S[1]??"",w=(P=this.#tt.uuidv5(v),N((new TextEncoder).encode(P).buffer));var P;const x=/-(\w+)\.\D/.exec(y);if(!x)throw"path に arch が見つかりません";const k=(c?"darwin":l?"linux":"win32")+"_"+x[1];o[k]={path:y,size:_,sha512:v,cn:w},await(0,f.outputJson)(r,o,{spaces:"\t"});const $=new RegExp("^"+k+"-");(0,a.ad)(i,((e,t)=>{$.test(t)&&(0,f.remove)(e)}),(()=>{})),await(0,f.copy)(s+"/"+y,i+"/"+k+"-"+w),await u.window.showInformationMessage(`${n.label} パッケージを生成しました`,"出力フォルダを開く")&&await u.env.openExternal(u.Uri.file(s))})).catch((e=>{u.window.showErrorMessage(`${n.label} パッケージ生成に失敗しました…${e}`)})).finally((()=>s()))}));break;case"PackFreem":this.hOnEndTask.set(r,(()=>{const e=`${this.#W}/${this.#_?xe:"doc"}/`,t=fe.create("zip",{zlib:{level:9}}).append((0,f.createReadStream)(e+"web.htm"),{name:"index.html"}).append((0,f.createReadStream)(this.#W+"/build/include/readme.txt"),{name:"readme.txt"}).glob("web.js",{cwd:e}).glob("web.*.js",{cwd:e}).glob("prj/**/*",{cwd:e}).glob("favicon.ico",{cwd:e}),n=`${(0,B.basename)(this.#W)}_1.0freem.zip`,a=(0,f.createWriteStream)(`${this.#W}/build/package/${n}`).on("close",(()=>{s(),u.window.showInformationMessage(`ふりーむ！形式で出力（${n}）しました`,"出力フォルダを開く").then((e=>{e&&u.env.openExternal(u.Uri.file(this.#W+"/build/package/"))}))}));t.pipe(a),t.finalize()}))}await u.tasks.executeTask(o).then((e=>this.#bt.set(t,e)),(e=>console.error(`fn:Project onBtn_sub() rj:${e}`)))}#bt=new Map;async#St(){const e=this.#_?e=>{const t=u.Uri.file(e);this.#y.isDiff(t)&&this.#ft(t)}:e=>{const t=u.Uri.file(e);this.#y.isDiff(t)};(0,a.fv)(this.#O,e),await this.#y.save()}async#yt(e){this.#y.isDiff(e)&&this.#_&&await this.#ft(e),await this.#y.save()}#ut;async#Nt(){if(this.#_=!this.#_,this.#ot.setCryptoMode(this.#_),!this.#_){await(0,f.remove)(`${this.#W}/${xe}/`),await(0,f.remove)(this.#Qe);for(const e of this.#ut)(0,a.fR)(this.#W+"/"+e,/\(hPlg, {.+?}\);/,"(hPlg);");return this.#et?((0,a.fR)(this.#W+"/electron.vite.config.ts",new RegExp(`publicDir: '../../${xe}/'`),"publicDir: '../../doc/'"),(0,a.fR)(this.#W+"/vite.config.ts",new RegExp(`publicDir: '${xe}'`),"publicDir: 'doc'")):((0,a.fR)(this.#W+"/package.json",new RegExp(`${xe}\\/`,"g"),"doc/"),(0,a.fR)(this.#W+"/core/wds.config.js",new RegExp(`\\/${xe}'`,"g"),"/doc'"),(0,a.fR)(this.#W+"/core/webpack.config.js",new RegExp(`'\\/${xe}`,"g"),"'/doc")),void await this.#vt()}await(0,f.mkdirs)(this.#Ze);for(const e of this.#ut)(0,a.fR)(this.#W+"/"+e,/\(hPlg\);/,"(hPlg, {cur: 'prj/', crypto: true});");this.#et?((0,a.fR)(this.#W+"/electron.vite.config.ts",/publicDir: '..\/..\/doc\/'/,`publicDir: '../../${xe}/'`),(0,a.fR)(this.#W+"/vite.config.ts",/publicDir: 'doc'/,`publicDir: '${xe}'`)):((0,a.fR)(this.#W+"/package.json",/doc\//g,`${xe}/`),(0,a.fR)(this.#W+"/core/wds.config.js",/\/doc'/g,`/${xe}'`),(0,a.fR)(this.#W+"/core/webpack.config.js",/'\/doc/g,`'/${xe}`),await(0,f.copy)(this.#W+"/doc/web.htm",this.#W+`/${xe}/web.htm`)),(0,a.fR)(this.ctx.extensionPath+"/dist/snsys_pre.js",/[^\s=]+\.tstDecryptInfo\(\)/,this.#tt.strHPass,!0,this.#Qe+"index."+(this.#et?"ts":"js")),await this.#vt(),this.#y.clear(),await this.#St()}async#ft({path:e}){const t=(0,a.DH)(e),n=this.#y.fp2pp(t);try{const e=this.#Ze+this.#y.get(n).cn;if(!$e.test(n))return void await(0,f.copy)(t,e,{overwrite:!0});if(Te.test(n)){if("path.json"===n)return void await this.#jt(t,e);const a=await(0,M.readFile)(t,{encoding:"utf8"});return void await(0,f.outputFile)(e,await this.#tt.enc(a))}const a=this.#Lt.exec(n);if(a&&this.#ot.oCfg.code[a[1]])return void await(0,f.copy)(t,e,{overwrite:!0});const s=e.replace(/\.[^.]+$/,".bin");await(0,f.ensureFile)(s);const i=(0,f.createWriteStream)(s).on("error",(e=>{i.destroy(),console.error("enc ws=%o",e)})),r=(0,f.createReadStream)(t).on("error",(e=>console.error("enc rs=%o",e))),o=new O(this.#tt,t);r.pipe(o).pipe(i)}catch(e){console.error(`enc other ${e instanceof Error?e.message:""} src:${t}`)}}async#jt(e,t){const n=await(0,f.readJson)(e,{encoding:"utf8"});for(const e of Object.values(n))for(const[t,n]of Object.entries(e)){if(":cnt"===t)continue;if(t.endsWith(":id"))continue;const a=this.#Lt.exec(n),s=this.#y.get(n);a&&this.#ot.oCfg.code[a[1]]||!s||(e[t]=s.cn)}const a=JSON.stringify(n);await(0,f.outputFile)(t,await this.#tt.enc(a))}#Lt=/(^.+)\//;#Wt=/(?<=\.\s*addTag\s*\(\s*)(["'])(.+?)\1/g;#qt={};async#vt(e=!0){const t=`${this.#W}/${this.#Xe}/plugin/`;if(!(0,f.existsSync)(t))return await(0,f.mkdirs)(t),void this.#Ot();const n={};this.#qt={};const s=[];(0,a.ad)(t,(()=>{}),(e=>{n[e]=0;let a=`${t}${e}/index.`;if((0,f.existsSync)(a+"js"))a+="js";else{if(!(0,f.existsSync)(a+"ts"))return;a+="ts"}s.push((async()=>{const e=await(0,M.readFile)(a,"utf8");let t;for(;t=this.#Wt.exec(e);){const n=t[2],s=n.length,i=this.#Wt.lastIndex-s-1;let r=0,o=i;for(;(o=e.lastIndexOf("\n",o-1))>=0;)++r;const c=i-e.lastIndexOf("\n",i)-1;this.#qt[n]={uri:a,sl:r,sc:c,el:r,ec:c+s}}})())})),await Promise.allSettled(s),await this.reqPrj2LSP({cmd:"def_plg.upd",hDefPlugin:this.#qt});const i=t.slice(0,-1);if(await(0,f.outputJson)(i+".json",n),e)try{this.#Ot()}catch(e){console.error(`Project updPlugin ${e}`)}if((0,f.existsSync)(i+".js")){await(0,f.remove)(i+".js");for(const e of this.#ut)(0,a.fR)(this.#W+"/"+e,/'\.\/plugin\.js';/,"'./plugin.json';")}}#Ot=()=>{if(!s.fj.aReady[s.JJ.NPM])return;this.#Ot=()=>{};let e=`cd "${this.#W}"`;(0,f.existsSync)(this.#W+"/node_modules")||(e+=` ${y} npm i`,(0,f.removeSync)(this.#W+"/package-lock.json"));const t=Me+"Sys",n="自動ビルド",a=new u.Task({type:t},this.wsFld,n,"SKYNovel",new u.ShellExecution(e));this.enableBtn(!1),u.window.withProgress({location:u.ProgressLocation.Notification,title:n,cancellable:!1},(e=>new Promise((e=>{let n=a=>{a.execution.task.definition.type===t&&(n=()=>{},this.enableBtn(!0),e())};u.tasks.onDidEndTaskProcess((e=>n(e)));try{u.tasks.executeTask(a)}catch(e){console.error("Project build() e:%o",e)}}))))};#gt=new Map;#Bt(e){let t=[];for(const[n,a]of this.#gt.entries())if(new RegExp(n).test(e)){t=a;break}return t}async drop(e,t,n){const s=[];for(const t of n){const{path:n,scheme:i}=t,r=(0,B.extname)(n).slice(1),o=(0,a.DH)(n);let c=o;const l="/"+(0,B.basename)(o),m=this.#Bt(r);switch(i){case"file":if((0,f.statSync)(n).isDirectory()){if(!o.startsWith(this.#O))return null;o===this.#O+"prj.json"?this.#nt.open():this.#nt.pnlWVFolder.open(t)}if(!r)continue;if(o.startsWith(this.#O))break;switch(m.length){case 0:{const t=e.uri.path;c=(0,a.DH)(t.slice(0,-(0,B.basename)(t).length)+(0,B.basename)(o))}break;case 1:c=this.#O+m[0]+l;break;default:{m.push("キャンセル");const e=await u.window.showInformationMessage((0,B.basename)(o)+" のコピー先を選んでください",...m);if(!e||"キャンセル"===e)return null;c=this.#O+e+l}}await(0,f.copyFile)(o,c);break;case"http":case"https":{if(!r)continue;if(this.#nt.pnlWVFolder.isOpend(n))break;const e=t.toString(),a=await fetch(e);if(!a.ok)return u.window.showErrorMessage(`ダウンロードに失敗しました。手動でローカルにコピーして下さい uri=${e}`),null;let s="";if(0===m.length)return null;s=m[0]+l,c=this.#O+s,await(0,f.writeFile)(c,new Uint8Array(await a.arrayBuffer())),u.window.showInformationMessage(`素材をダウンロードしました。 path=${s}`),await u.commands.executeCommand("revealInExplorer",u.Uri.parse(this.#ht+s))}break;default:return null}s.push(c)}if(0===s.length)return null;const i=s[0],r=(0,B.extname)(i).slice(1),o=(0,a.dd)(i);for(const[n,a]of this.#At.entries()){if(!new RegExp(n).test(r))continue;const{range:s,nm:i}=this.#Mt(e,t,this.#Jt);if(i)return{insertText:"",additionalEdit:this.#Yt(e.uri,s,i,o)};const c=a.replace("...",o).replaceAll(/\${\d\|([^,]+)\|}/g,"$1");return{insertText:new u.SnippetString(c)}}return null}#At=new Map;#Jt=/(?<=\s)[^\s=[\]]+(?:=(?:[^"'#\s;\]]+|(["'#]).*?\1)?)?/g;#Yt(e,t,n,a){const s=new u.WorkspaceEdit,i=/[\s=]/.test(a)?/['#]/.test(a)?`"${a}"`:`'${a}'`:a;return s.replace(e,t,n+"="+i),s}#Mt(e,{line:t,character:n},a){const s=e.getText(new u.Range(t,0,t,9999));let i;for(a.lastIndex=0;i=a.exec(s);){const[e]=i,s=a.lastIndex-e.length,[r="",...o]=e.split("="),c=o.join("=");if(s<=n&&n<=a.lastIndex)return{hit:e,range:new u.Range(t,s,t,a.lastIndex),nm:r,val:c}}return{hit:"",range:new u.Range(0,0,0,0),nm:"",val:""}}}var Re=n(28675),Ae=n(57213),Ce=n(24434);class Ee extends Ce.EventEmitter{wsFld;hookTag;#Kt="";constructor(e,t){super(),this.wsFld=e,this.hookTag=t,this.#Kt=e.uri.path,Ee.#It[this.#Kt+"/doc/prj/"]=this}static#It={};static send2SN(e,t={}){const n=u.debug.activeDebugSession?.workspaceFolder?.uri.fsPath;n&&Ee.#It[n+"/doc/prj/"].send2SN(e,t)}attach(e){this.#Gt.hi=()=>(this.send2SN("auth",{t:E.getDebugertoken(this.wsFld),hBreakpoint:{hFn2hLineBP:this.#Ut,aData:this.#zt,aFunc:this.#Vt},...e}),this.hookTag({タグ名:":connect"}),!1),new Ae.gq(e.port,{cors:{origin:e.weburi}}).on("connection",(e=>{e.on("data",((e,t)=>{this.#Gt[e](e,t)&&(this.#Gt[e]=()=>!1)})),this.send2SN=(t,n={})=>{e.emit("data",t,n)};const t=this.end;this.end=()=>{this.end=t,this.end(),this.send2SN("disconnect",{}),this.send2SN=()=>{},e.disconnect()}}))}send2SN(e,t={}){}end(){delete Ee.#It[this.#Kt],this.hookTag({タグ名:":disconnect"})}#Gt={stopOnEntry:e=>(this.#Xt(e),!1),stopOnStep:e=>(this.#Xt(e),!1),stopOnBreakpoint:e=>(this.#Xt(e),!1),stopOnDataBreakpoint:e=>(this.#Xt(e),!1),_recodeDesign:(e,t)=>{const n=(0,a._A)(t[":ln"])-1,s=(0,a._A)(t[":col_s"]),i=(0,a._A)(t[":col_e"]);return this.#Qt[t[":id_tag"]]={...t,uri:u.Uri.file(t[":path"].replace("${pathbase}",this.#Kt+"/doc")),rng:new u.Range(n,s,n,i)},this.hookTag(t),!1},_enterDesign:e=>!1,_changeCast:(e,t)=>{const{":id_tag":n,ri:a,...s}=t,i=this.#Qt[n];if(!i)return!1;let r=i[":token"];for(const[e,t]of Object.entries(s))r=r.replace(new RegExp(`(\\s${e}=)(['"#]*)(?:\\S+)\\2([\\s\\]])`),`$1${t}$3`);i[":token"]=r;const o=new u.WorkspaceEdit;return o.replace(i.uri,i.rng,r),u.workspace.applyEdit(o),!1},_focusScript:(e,t)=>{t[":path"]=t[":path"].replace("${pathbase}",this.#Kt+"/doc");const n=t[":ln"]-1;return u.window.showTextDocument(u.Uri.file(t[":path"]),{selection:new u.Range(new u.Position(n,t[":col_s"]),new u.Position(n,t[":col_e"]))}),!1},_dropFile:(e,t)=>{const{":id_tag":n,fn:a,ext:s,url:i,buf:r,old_fn:o,old_url:c}=t,l=this.#Qt[n];if(!l)return!1;let m="";if(i){if(m=i.replace("${pathbase}",this.#Kt+"/doc"),a===o){let e=!0;const t=(0,f.readFileSync)(m),n=t.length;if(n!==r.length)e=!1;else for(let a=0;a<n;++a)if(t[a]!==r[a]){e=!1;break}if(e)return!1}}else{const e=(0,B.basename)((0,B.dirname)(c));m=this.#Kt+`/doc/prj/${e}/${a}.${s}`;const t={":cnt":1};t[s]=`${e}/${a}.${s}`,this.send2SN("_addPath",{fn:a,o:t})}const d=u.workspace.createFileSystemWatcher(new u.RelativePattern(this.wsFld,"doc/prj/path.json"));return d.onDidChange((()=>{d.dispose();let e=l[":token"];const t={fn:a,b_pic:a,pic:a},n=()=>{for(const[n,a]of Object.entries(t))e=e.replace(new RegExp(`(\\s${n}=)(['"#]*)(?:\\S+)\\2([\\s\\]])`),`$1${a}$3`);l[":token"]=e;const n=new u.WorkspaceEdit;n.replace(l.uri,l.rng,e),u.workspace.applyEdit(n)};(0,v.F)(m).then((({width:e,height:a})=>{t.width=String(e),t.height=String(a),n()})).catch((()=>n()))})),(0,f.writeFileSync)(m,r),!1}};#Qt={};static noticeChgDoc(e,t){const n=Ee.#It[e];if(!n)return;const a={};for(const e of t.contentChanges){const s=e.text.length-e.rangeLength;for(const[i,r]of Object.entries(n.#Qt)){if(!r.rng.contains(e.range))continue;r[":col_e"]+=s,r.rng=r.rng.with(r.rng.start,r.rng.end.translate(0,s));const n=t.document.getText(r.rng);r[":token"]=n,"["===n.at(0)&&"]"===n.at(-1)&&(a[i]={...r,":id_tag":i})}}for(const e of Object.values(a))n.send2SN("_replaceToken",e)}restart=e=>new Promise((t=>{this.send2SN("restart",{ri:e}),this.#Gt[e]=()=>(t(),!0)}));continue=(e=!1)=>this.send2SN("continue",{reverse:e});step=(e=!1)=>this.send2SN("stepover",{reverse:e});stepin=()=>this.send2SN("stepin");stepout=()=>this.send2SN("stepout");pause=()=>this.send2SN("pause");var=(e,t)=>new Promise((n=>{this.send2SN("var",{ri:e,scope:t}),this.#Gt[e]=(e,t)=>(n(t.v),!0)}));stack=(e,t,n)=>new Promise((a=>{this.send2SN("stack",{ri:e}),this.#Gt[e]=(e,s)=>Array.isArray(s.a)?(a(s.a.slice(t,n).filter((e=>!e.ma||"true"===(JSON.parse(e.ma??"{}").stepin??"true"))).map((e=>(e.fn=e.fn.replace("${pathbase}",this.#Kt+"/doc"),e)))),!0):(a([]),!0)}));eval=(e,t)=>new Promise((n=>{this.send2SN("eval",{ri:e,txt:t}),this.#Gt[e]=(e,t)=>(n(t.v),!0)}));#Zt=0;#Ut={};setBreakPoints(e,t){const n=t.map((e=>({id:++this.#Zt,ln:e.line,col:e.column,verified:!0,condition:e.condition,hitCondition:e.hitCondition}))),a={};this.#en(e);const s=this.#tn[e],i=s.length;for(const e of n){for(;""===s[e.ln-1].replace(/;.*$/,"").trim();)if(e.ln++===i){e.verified=!1;break}a[e.ln]=e,this.#Xt("breakpointValidated",e)}return this.send2SN("add_break",{fn:e,o:a}),this.#Ut[e]=a,n}#tn={};#en(e){e in this.#tn||(this.#tn[e]=(0,f.readFileSync)(e).toString().split("\n"))}#zt=[];setDataBreakpoint=(e,t)=>new Promise((n=>{this.#zt=t,this.send2SN("set_data_break",{ri:e,a:t}),this.#Gt[e]=(e,t)=>(n(t.v),!0)}));#Vt=[];setFuncBreakpoint=(e,t)=>new Promise((n=>{this.#Vt=t,this.send2SN("set_func_break",{ri:e,a:t}),this.#Gt[e]=(e,t)=>(n(t.v),!0)}));setVariable=(e,t,n)=>new Promise((a=>{this.send2SN("set_var",{ri:e,nm:t,val:n}),this.#Gt[e]=(e,t)=>(a(t.v),!0)}));#Xt(e,...t){setImmediate((()=>this.emit(e,...t)))}}let De=null;class He extends Re.dn{wsFld;static#nn=1;#an;constructor(e,t){super("sn_debug.txt"),this.wsFld=e,this.setDebuggerLinesStartAt1(!0),this.setDebuggerColumnsStartAt1(!0),this.#an=new Ee(e,t),this.#an.on("stopOnEntry",(()=>{this.sendEvent(new Re.YI("entry",He.#nn))})),this.#an.on("stopOnStep",(()=>{this.sendEvent(new Re.YI("step",He.#nn))})),this.#an.on("stopOnBreakpoint",(()=>{this.sendEvent(new Re.YI("breakpoint",He.#nn))})),this.#an.on("stopOnDataBreakpoint",(()=>{this.sendEvent(new Re.YI("data breakpoint",He.#nn))})),this.#an.on("stopOnException",(()=>{this.sendEvent(new Re.YI("exception",He.#nn))})),this.#an.on("breakpointValidated",(e=>{this.sendEvent(new Re.Q_("changed",e))})),this.#an.on("output",((e,t,n,a)=>{const s=new Re.iQ(`${e}\n`);"start"!==e&&"startCollapsed"!==e&&"end"!==e||(s.body.group=e,s.body.output=`group-${e}\n`),s.body.source=this.#sn(t),s.body.line=this.convertDebuggerLineToClient(n),s.body.column=this.convertDebuggerColumnToClient(a),this.sendEvent(s)})),this.#an.on("end",(()=>this.sendEvent(new Re.cz)))}initializeRequest(e,t){e.body??={},e.body.supportsConfigurationDoneRequest=!0,e.body.supportsFunctionBreakpoints=!0,e.body.supportsConditionalBreakpoints=!0,e.body.supportsHitConditionalBreakpoints=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!0,e.body.supportsCompletionsRequest=!0,e.body.supportsRestartRequest=!0,e.body.supportsDataBreakpoints=!0,e.body.supportsCancelRequest=!1,this.sendResponse(e),this.sendEvent(new Re.R3)}disconnectRequest(e,t,n){this.#an.end()}configurationDoneRequest(e,t){this.#in()}#in=Promise.withResolvers().resolve;attachRequest(e,t){Re.vF.setup(Re.Vy.LogLevel.Stop,!1),this.#an.attach(t),this.sendResponse(e)}restartRequest(e,t){this.#an.restart(e.request_seq),this.sendResponse(e)}setBreakPointsRequest(e,t){const n=t.breakpoints??[];e.body={breakpoints:this.#an.setBreakPoints(t.source.path,n.map((e=>({...e,line:this.convertClientLineToDebugger(e.line)})))).map(((e,t)=>new Re.EA(e.verified,n[t].line,e.col)))},this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,n){const a=[];e.body={breakpoints:[]};for(const n of t.breakpoints)a.push(n),e.body.breakpoints.push({verified:!0});this.#an.setFuncBreakpoint(e.request_seq,a),this.sendResponse(e)}restartFrameRequest(e,t,n){}pauseRequest(e,t){this.#an.pause()}threadsRequest(e){e.body={threads:[new Re.jV(He.#nn,"thread 1")]},this.sendResponse(e)}stackTraceRequest(e,t){const n="number"==typeof t.startFrame?t.startFrame:0,a=n+("number"==typeof t.levels?t.levels:1e3);this.#an.stack(e.request_seq,n,a).then((t=>{e.body={stackFrames:t.map(((e,t)=>new Re.s$(t,e.nm,this.#sn(e.fn),this.convertDebuggerLineToClient(e.ln),this.convertDebuggerColumnToClient(e.col)))),totalFrames:t.length},this.sendResponse(e)}))}#rn=new Re.ot;#on={};scopesRequest(e,t){this.#cn={tmp:{},sys:{},save:{},mp:{}},e.body={scopes:[new Re.HG("雑用変数 tmp:",this.#rn.create("tmp"),!1),new Re.HG("雑用変数 tmp:（SKYNovel組み込み）",this.#rn.create("tmp:sn"),!1),new Re.HG("マクロ変数 mp:",this.#rn.create("mp"),!1),new Re.HG("マクロ変数 mp:（SKYNovel組み込み）",this.#rn.create("mp:sn"),!1),new Re.HG("システム変数 sys:",this.#rn.create("sys"),!1),new Re.HG("システム変数 sys:（SKYNovel組み込み）",this.#rn.create("sys:sn"),!1),new Re.HG("セーブ変数 save:",this.#rn.create("save"),!1),new Re.HG("セーブ変数 save:（SKYNovel組み込み）",this.#rn.create("save:sn"),!1)]},this.sendResponse(e)}#ln=new Map;#mn=new Map;static#dn=/^(?:const\.)?sn\./;#cn={tmp:{},sys:{},save:{},mp:{}};variablesRequest(e,t,n){const a=[];if(this.#mn.get(t.variablesReference)){n&&this.#ln.set(n.seq,!1);for(let e=0;e<100&&(a.push({name:`i_${e}`,type:"integer",value:`${e}`,variablesReference:0}),!n||!this.#ln.get(n.seq));++e);n&&this.#ln.delete(n.seq)}else{let n=this.#rn.get(t.variablesReference);if(n){let t=!0;n.endsWith(":sn")&&(t=!1,n=n.slice(0,-3)),(n in this.#cn?this.#an.var(e.request_seq,n):Promise.try((()=>{let e={};const t=`${n}:`.split(":",2),a=this.#cn[t[0]];if(a){const n=a[t[1]];n&&(e=JSON.parse(String(n)))}return e}))).then((e=>{for(const[s,i]of Object.entries(e)){if(He.#dn.test(s)===t)continue;const e=String(i),r={name:s,type:this.#pn(e),value:e,presentationHint:{kind:"property",visibility:"public"},variablesReference:0};s.startsWith("const.")&&(r.presentationHint.attributes=["constant"]),"[object Object]"===e?r.value=JSON.stringify(i):"object"!==r.type&&"array"!==r.type||(this.#on[`${n}:${s}`]=r.variablesReference=this.#rn.create(`${n}:${s}`)),a.push(r)}}))}}e.body={variables:a.sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0))},this.sendResponse(e)}#pn(e){let t="string";if("true"===e||"false"===e)t="boolean";else if("[object Object]"===e)t="object";else if(/^[+-]?[0-9]+([0-9]*)?$/.test(e))t="integer";else if(/^[+-]?[0-9]+(\.[0-9]*)?([eE][+-]?[0-9]+)?$/.test(e))t="float";else if(e){const n=e.at(0);"{"!==n&&"["!==n||(t="{"===n?"object":"array")}return t}setVariableRequest(e,t,n){this.#an.setVariable(e.request_seq,t.name,t.value),e.body={value:t.value},this.sendResponse(e)}continueRequest(e,t){this.#an.continue(),this.sendResponse(e)}reverseContinueRequest(e,t){this.#an.continue(!0),this.sendResponse(e)}nextRequest(e,t){this.#an.step(),this.sendResponse(e)}stepInRequest(e,t,n){this.#an.stepin(),this.sendResponse(e)}stepOutRequest(e,t,n){this.#an.stepout(),this.sendResponse(e)}stepBackRequest(e,t){this.#an.step(!0),this.sendResponse(e)}evaluateRequest(e,t){switch(t.context){case"hover":{const n=this.#hn(t.expression);if(!n.exist){e.body={result:`変数 ${n.fullnm??"?"} はありません`,variablesReference:0};break}const a=this.#on[n.fullnm??""];e.body={result:`変数（${n.fullnm??"?"}）の値${a?"":`【${String(n.ret)}】`}`,presentationHint:{kind:"property",visibility:"public",attributes:n.const?["readOnly"]:void 0},variablesReference:a??0}}break;case"watch":this.#an.eval(e.request_seq,t.expression).then((t=>{e.body=t?{result:t,presentationHint:{kind:"formula",visibility:"public"},variablesReference:0}:{result:"【null】",variablesReference:0}}));break;case"repl":this.#an.eval(e.request_seq,t.expression).then((t=>e.body={result:t?`=${t}`:"【null】",variablesReference:0}))}this.sendResponse(e)}#hn(e){const t=`${e}:`.split(":",2),n=""===t[1]?"tmp":t[0],a=""===t[1]?t[0]:t[1];switch(n){case"tmp":case"sys":case"save":case"mp":break;default:return{exist:!1}}const s=this.#cn[n];return a in s?{exist:!0,fullnm:`${n}:${a}`,ret:s[a],const:a.startsWith("const.")}:{exist:!1,fullnm:`${n}:${a}`}}dataBreakpointInfoRequest(e,t){if(t.variablesReference&&t.name){const n=this.#hn(t.name);n.exist&&(e.body={dataId:n.fullnm,description:`変数値変更：${n.fullnm}`,accessTypes:["write"],canPersist:!0})}else e.body={dataId:null,description:"cannot break on data access"};this.sendResponse(e)}setDataBreakpointsRequest(e,t){const n=[];e.body={breakpoints:[]};for(const a of t.breakpoints)n.push(a),e.body.breakpoints.push({verified:!0});this.#an.setDataBreakpoint(e.request_seq,n),this.sendResponse(e)}completionsRequest(e,t){e.body={targets:[{label:"item 10",sortText:"10"},{label:"item 1",sortText:"01"},{label:"item 2",sortText:"02"},{label:"array[]",selectionStart:6,sortText:"03"},{label:"func(arg)",selectionStart:5,selectionLength:3,sortText:"04"}]},this.sendResponse(e)}loadedSourcesRequest(e,t,n){e.body.sources=[{name:"main.sn とか?",path:"doc/prj/script/main.sn",sourceReference:0}],this.sendResponse(e)}cancelRequest(e,t){t.requestId&&this.#ln.set(t.requestId,!0)}#sn(e){return new Re.kL((0,R.basename)(e),this.convertDebuggerPathToClient(e),void 0,void 0,"mock-adapter-data")}}function Fe(e,t,n=0,a=0,s=0){const i=e.slice(0,t).split("\n"),r=i.length;return{ln:a+r-1,ch:r<2?s+1+n+t:i.at(-1)?.length??0}}class Ne{#un=/;[^\n]*|(?<key>[^\s="'#|;]+)(?:\s|;[^\n]*\n)*=(?:\s|;[^\n]*\n)*(?:(?<val>[^\s"'#|;]+)|(["'#])(?<val2>.*?)\3)(?:\|(?:(?<def>[^\s"'#;]+)|(["'#])(?<def2>.*?)\6))?|(?<literal>[^\s;]+)/g;parse(e){this.#fn={},this.#gn=!1;for(const{groups:t}of e.matchAll(this.#un)){const{key:e,val:n,val2:a,def:s,def2:i,literal:r}=t;e?this.#fn[e]={val:n??a??"",def:s??i}:r&&("*"===r?this.#gn=!0:this.#fn[r]={val:"1"})}}parseinDetail(e,t,n,a){const s={},i=e.slice(1+t,-1);for(const{groups:e,index:r,0:o}of i.matchAll(this.#un)){if(!r)continue;const{key:c,val:l,val2:m="",literal:d}=e;if(d){if(d.endsWith("=")){const e=d.length-1,{ch:o}=Fe(i,r+e,t,n,a);s[d.slice(0,-1)]={k_ln:n,k_ch:o-e,v_ln:n,v_ch:o+1,v_len:0}}continue}if(!c)continue;const{ln:p,ch:h}=Fe(i,r,t,n,a),{ln:u,ch:f}=Fe(i,r+o.lastIndexOf(l??m)-(l?0:1),t,n,a);s[c]={k_ln:p,k_ch:h,v_ln:u,v_ch:f,v_len:l?l.length:m.length+2}}return s}#fn={};get hPrm(){return this.#fn}#gn=!1;get isKomeParam(){return this.#gn}}class je{curPrj;static#r;static#yn="";static init(e){u.window.registerCustomEditorProvider("SKYNovel.score",{resolveCustomTextEditor(e,t,n){const a=e.fileName;for(const[n,s]of Object.entries(je.#bn))if(a.startsWith(n)){s.#_n(e,t);break}}});const t=e.extensionPath+"/views/";je.#r=u.Uri.file(t),je.#yn=(0,f.readFileSync)(t+"score.htm",{encoding:"utf8"}).replace("<meta_autooff ","<meta ").replace(/\$\{nonce}/g,(0,s.m9)()).replace(/<tbody>[\s\S]+<\/tbody>/,"<tbody/>").replace(/(<div class="card-group">)[\s\S]+(<\/div><!-- card-group -->)/,"$1 $2")}static#bn={};constructor(e){this.curPrj=e,je.#bn[e]=this}#Sn={};updScore(e,t,n){const s={line:1};this.#Sn[e]={uriPrj:u.Uri.parse(t),htm:je.#yn.replace("<tbody/>",`<tbody>${n.map(((e,t)=>this.#vn(s,e,t))).join("")}</tbody>`),skipupd:!1};const i=this.#wn[e];i&&(i.html=(0,a.J4)(this.#Sn[e].htm,i,je.#r))}add_lay(e){}isSkipUpd(e){const t=this.#Sn[e];return!!t?.skipupd&&(t.skipupd=!1,!0)}separation(e){this.#wn[e]?.postMessage({cmd:"separation"})}combining(e){this.#wn[e]?.postMessage({cmd:"combining"})}updLine(e,t,n,s){const i=this.#wn[e.fileName];if(!i)return!1;const r=t.start.line,o=t.end.line;return(t.start.character>0||t.end.character>0)&&r!==o||(""===n?(i.postMessage({cmd:"del",ln:r}),!1):(i.postMessage({cmd:r===o&&"\n"===n.at(-1)?"ins":"rep",ln:r,htm:("\n"===n?this.#vn({line:r+1},"\n\n",-1):(0,a.J4)(s.map((e=>e.charCodeAt(0)<11?"":this.#vn({line:r+1},e,0))).join(""),i,je.#r)).replace(/<tr .+>|<\/tr>/g,"")}),!1))}#wn={};static analyzTagArg=e=>je.REG_TAG.exec(e);static REG_TAG=/\[(?<name>[^\s;\]]+)\s*(?<args>(?:[^"'#\]]+|(["'#]).*?\3)*?)]/;#_n(e,t){const n=e.fileName,s=this.#Sn[n];if(!s)throw`resolveCustomTextEditor err path=${n}`;const i=this.#wn[n]=t.webview;if(i.options={enableScripts:!0,localResourceRoots:[je.#r,s.uriPrj]},i.onDidReceiveMessage((t=>{switch(t.cmd){case"info":u.window.showInformationMessage(t.text);break;case"warn":u.window.showWarningMessage(t.text);break;case"err":u.window.showErrorMessage(t.text);break;case"loaded":this.#Pn(n),this.combining(n);break;case"save_tbody":s.htm=i.html.replace(/<tbody>[\s\S]+<\/tbody>/,`<tbody>${t.tbody}</tbody>`);break;case"move":{const{from:n,to:a}=t;if(n===a)break;s.skipupd=!0;const i=new u.WorkspaceEdit,r=new u.Range(n,0,n+1,0),o=e.getText(r);n>a?(i.delete(e.uri,r),i.insert(e.uri,new u.Position(a,0),o)):(i.insert(e.uri,new u.Position(a+1,0),o),i.delete(e.uri,r)),u.workspace.applyEdit(i)}break;case"tool_put":{const n=t.scr.replace(/\$\{(.+)\}/g,((e,t)=>{let n="";for(const e of this.#xn[t]){n=`#${e}#`;break}return n}));console.log(`fn:CteScore.ts line:176 tool_put row:${t.row} to:${t.to} scr=${n}=`),i.postMessage({cmd:"tool_res",row:t.row,htm:(0,a.J4)(this.#vn({line:t.row},n,t.row),i,je.#r)}),s.skipupd=!0;const r=new u.WorkspaceEdit;r.insert(e.uri,new u.Position(t.to,0),"\n\n"===n?"\n":n+"\n"),u.workspace.applyEdit(r)}break;case"del":{s.skipupd=!0;const n=new u.WorkspaceEdit;n.delete(e.uri,new u.Range(t.lnum,0,t.lnum+1,0)),u.workspace.applyEdit(n)}break;case"input":{console.log(`fn:CteScore.ts line:184 input ln:${t.ln} nm=${t.nm}= val=${t.val}=`),s.skipupd=!0;const n=new u.WorkspaceEdit,a=new u.Range(t.ln,0,t.ln+1,0),r=t.nm.charCodeAt(0)<60?t.nm+t.val+"\n":e.getText(a);let o=r.replace(new RegExp(`(${t.nm}=)([#"']).*\\2`),`$1$2${t.val}$2`).replace(new RegExp(`(${t.nm}=)[^\\] #"']+`),`$1${t.val}`);r===o&&(o=o.replace(/(])/,` ${t.nm}=#${t.val}#$1`)),n.replace(e.uri,a,o),u.workspace.applyEdit(n);const c=je.analyzTagArg(o),l=c?.groups;if(!l)break;const m=this.#kn[l.name];if(!m)break;je.#$n.parse(l.args);const d=m(je.#$n.hPrm);i.postMessage({cmd:"upd_btn_face",ln:t.ln,htm:`\n<i class="fas ${d.icon}" aria-hidden="true"></i>\n${d.btn_face}`,td:`<td class="p-0 ${d.td_style??""}">`,nm:t.nm,val:t.val})}break;case"req_wds":i.postMessage({cmd:"res_wds",key:t.key,aWd:[...this.#xn[t.key].values()]})}}),!1),i.html=(0,a.J4)(this.#Sn[e.uri.path].htm,i,je.#r),""===e.getText(new u.Range(0,0,1,1))){const t=new u.WorkspaceEdit;t.insert(e.uri,new u.Position(0,0),"\n\n\n[return]\n"),u.workspace.applyEdit(t)}}static#Tn=/\w+/;#Pn(e){const t={},n=this.#Sn[e],a=this.#qn;for(const[e,n]of Object.entries(a))for(const[a,s]of Object.entries(n)){if(":cnt"===a)continue;const n=String(s),i=String(n.match(je.#Tn));t[i]??=[],t[i].push({ext:a,path:n,fn:e})}const s=this.#wn[e];s.postMessage({cmd:"upd_db",pathPrj:String(s.asWebviewUri(n.uriPrj)),hFld2url:t,hPath:a})}#xn={};updWords(e,t){this.#xn[e]=t;for(const t of Object.values(this.#wn))t.postMessage({cmd:"del_wds",key:e})}#qn={};updPath(e){this.#qn=e;for(const e of Object.keys(this.#Sn))e in this.#wn&&this.#Pn(e)}#vn(e,t,n){let a="";switch(t.charCodeAt(0)){case 9:return"";case 10:{const a=0===n&&1===e.line?1:0,s=t.length+a;if(e.line+=s-a,1===s)return"";let i="";for(let t=e.line-s+1;t<e.line;++t)i+=this.#Rn(t,this.#An(0,t,"btn-rounded","fa-expand","（空行）"));return i}case 38:{const s=t.endsWith("&");a=this.#An(0,e.line,'btn-secondary dropdown-toggle" data-face="true" data-mdb-toggle="dropdown" aria-expanded="false',"fa-calculator",s?"変数表示":`変数操作 ${t.slice(1,t.indexOf("=")+2)}…`,s?t.slice(1,-1):t.slice(1),`\n\t<div class="form-outline col-12">\n\t\t<input type="text" data-nm="&" id="${String(n)}txf" class="form-control" value="${t.slice(1)}"/>\n\t\t<label class="form-label" for="${String(n)}txf">${s?"変数表示":"変数操作"}</label>\n\t</div>`)}break;case 59:a=this.#An(0,e.line,'btn-outline-light btn-rounded dropdown-toggle" data-face="true" data-mdb-toggle="dropdown" aria-expanded="false',"fa-comment-dots",t.slice(1,11)+"…",t.slice(1),`\n\t<div class="form-outline col-12">\n\t\t<input type="text" data-nm=";" id="${String(n)}txf" class="form-control" value="${t.slice(1)}"/>\n\t\t<label class="form-label" for="${String(n)}txf">コメント</label>\n\t</div>`);break;case 42:a=this.#An(0,e.line,'btn-outline-light dropdown-toggle" data-mdb-toggle="dropdown" aria-expanded="false" data-face="true',"fa-tag",t.slice(1),t.slice(1),`\n\t<div class="form-outline col-12">\n\t\t<input type="text" data-nm="*" id="${String(n)}txf" class="form-control" value="${t.slice(1)}"/>\n\t\t<label class="form-label" for="${String(n)}txf">ラベル</label>\n\t</div>`);break;case 91:{let s=0,i=-1;for(;(i=t.indexOf("\n",i+1))>=0;)++s;if(s>0&&(e.line+=s),a=this.#Cn(t,e.line,n))break}return"";default:a=this.#An(5,e.line,'btn-outline-primary text-white dropdown-toggle sn-ext_txt" data-face="true" data-mdb-toggle="dropdown" aria-expanded="false',"fa-align-left","","",`\n\t<div class="form-outline col-12">\n\t\t<textarea class="form-control" placeholder="本文テキストを入力" cols="40" rows="2" data-nm="text" id="${String(n)}ta">${t}</textarea>\n\t\t<label class="form-label" for="${String(n)}ta">本文テキスト</label>\n\t</div>`)}return this.#Rn(e.line,a)}#Rn(e,t){return`\n<tr data-row="${String(e)}">\n\t${t}\n\t<td class="p-0"><div class="d-flex justify-content-center">\n\t\t<button type="button" class="btn btn-danger btn-sm btn-floating tglEdit d-none">\n\t\t\t<i class="fas fa-times"></i>\n\t\t</button>\n\t</div></td>\n</tr>`}#Cn(e,t,n){const s=je.analyzTagArg(e),i=s?.groups;if(!i)return"";const r=this.#kn[i.name];if(!r)return this.#An(0,t,"btn-light","fa-code",i.name,i.args);je.#$n.parse(i.args);const o=r(je.#$n.hPrm),c=o.args?o.args.length:0,l=1===c?"col-12 col-sm-3 col-md-2":2===c?"col-2":"";return this.#An(o.col?this.#En[o.col]:0,t,(o.btn_style??"btn-secondary")+(o.args?' dropdown-toggle" data-mdb-toggle="dropdown" aria-expanded="false':""),o.icon,o.btn_face,o.tooltip??i.args,o.args?o.args.map(((e,t)=>{let s="",i="form-outline px-2";const r=`sn-${n}:${t}`;switch(e.type){case"bool":i="p-0",s=`\n<div class="form-control ${l}">\n<div class="form-check">\n\t<input type="checkbox" id="${r}chk" class="form-check-input" data-nm="${e.name}" value="${e.val??""}"${(0,a.Ni)(e.val)?" checked":""}/>\n\t<label class="form-check-label" for="${r}chk">${e.hint??e.name}</label>\n</div>\n</div>`;break;case"textarea":s=`\n<textarea id="${r}ta" class="form-control" placeholder="${e.hint??e.name}を入力" cols="40" rows="2" data-nm="${e.name}">${e.val??""}</textarea>\n<label class="form-label" for="${r}ta">${e.hint??e.name}</label>`;break;case"select":i="p-0",s=`\n<div class="form-control">\n<label class="form-label select-label" for="${r}sel">${e.hint??e.name}</label>\n<select class="select" id="${r}sel" data-nm="${e.name}" data-key="${e.key??""}"${e.exts?`data-exts="${e.exts}"`:""}${e.filter?`data-filter="${e.filter}"`:""}>\n\t<option selected>${e.val??""}</option>\n\t<option>...</option>\n\t<option>...</option>\n</select>\n</div>`;break;case"range":i="p-0",s=`\n<div class="range form-control">\n\t<label class="form-label" for="${r}rng">${e.hint??e.name}（${e.min??""} - ${e.max??""}）</label>\n\t<input type="range" id="${r}rng" data-nm="${e.name}" class="form-range" min=${e.min??""} max=${e.max??""} step=${e.step??""} value="${e.val??""}"/>\n</div>`;break;default:s=`\n<input type="${"num"===e.type?"number":"text"}" id="${r}txf" class="form-control ${l}" data-nm="${e.name}" value="${e.val??""}"/>\n<label class="form-label" for="${r}txf">${e.hint??e.name}</label>`}return`\n<div class="${i} col-12 ${1===c?"":2===c?"col-md-6":"col-md-6 col-lg-4"} my-1${"bool"===e.type?" pt-2":""}">${s}</div>`})).join(""):"",o.td_style??"",o.detail??"")}undefMacro(e){delete this.#kn[e]}defMacro(e,t){this.#kn[e]=()=>({icon:"icon未指定",btn_face:"btn_face未指定",...t})}static#$n=new Ne;static#Dn="jpg|jpeg|png";#kn={ch:e=>({col:"mes",btn_style:'btn-outline-primary text-white dropdown-toggle sn-ext_txt" data-face="true" data-mdb-toggle="dropdown" aria-expanded="false',icon:"fa-align-left",btn_face:"",tooltip:"",args:[{name:"text",type:"textarea",val:e.text?.val??"",hint:"本文テキスト"}],detail:`<form><textarea class="form-control bg-light" placeholder="本文テキストを入力" data-nm="text">${e.text?.val??""}</textarea></form>`}),jump:e=>({icon:"fa-external-link-alt",btn_face:"ジャンプ"+(e.fn?.val?` ${e.fn.val}`:"")+(e.label?.val?` ${e.label.val}`:"")}),call:e=>({icon:"fa-exchange-alt",btn_face:"コール"+(e.fn?.val?` ${e.fn.val}`:"")+(e.label?.val?` ${e.label.val}`:"")}),return:e=>({icon:"fa-long-arrow-alt-left",btn_face:"戻る"}),add_lay:e=>{const t="grp"===e.class?.val;return{col:e.layer?.val??"base",btn_style:"btn-"+(t?"success":"primary text-white"),icon:t?"fa-image":"fa-align-left",btn_face:(t?"画像":"文字")+"レイヤ追加 "+(e.layer?.val??"")}},clear_lay:e=>({col:e.layer?.val??"base",btn_style:"btn-outline-primary text-white",icon:"fa-ban",btn_face:"レイヤ設定消去"}),lay:e=>({col:e.layer?.val??"base",btn_style:"btn-outline-primary text-white",icon:"fa-cog",btn_face:"レイヤ設定"}),img:e=>{const t=e.layer?.val??"base";return{col:t,btn_style:`btn${e.fn?.val?"":"-outline"}-${"mes"!==t?"success":"secondary text-white"}`,icon:"base"===t?"fa-image":"fa-user",btn_face:e.fn?.val??("base"===t?"(消去)":"(退場)"),args:[{name:"fn",type:"select",val:e.fn?.val??"(消去)",hint:"画像名",key:"画像ファイル名"}]}},scene_change:e=>({col:"base",td_style:"sn-cmb-"+(e.bg?.val?`start" data-fn="${e.bg.val}`:"end"),btn_style:"btn-success text-black",icon:"fa-door-open",btn_face:"場面転換"+(e.rule?.val?` ${e.rule.val}ルールで`:"")+(e.time?.val?` ${e.time.val}msで`:"")+(e.bg?` ${e.bg.val}へ変更`:"(消去)"),args:[{name:"bg",type:"select",val:e.bg?.val??"(消去)",hint:"背景の画像名",key:"画像ファイル名",exts:je.#Dn,filter:"bg/"},{name:"time",type:"num",val:e.time?.val??"1000",hint:"かける時間"},{name:"rule",type:"select",val:e.rule?.val??"",hint:"ルール画像名",key:"画像ファイル名",exts:je.#Dn,filter:"rule/"}]}),scene_reserve:e=>({col:e.layer?.val??"0",td_style:"sn-cmb-"+(e.fn?.val?`start" data-fn="${e.fn.val}`:"end"),btn_style:"btn-success btn-rounded text-black",icon:"fa-user-ninja",btn_face:`場面準備 ${e.fn?.val??""}`,args:[{name:"layer",type:"select",val:e.layer?.val??"0",hint:"画像レイヤ",key:"画像レイヤ名"},{name:"fn",type:"select",val:e.fn?.val??"(消去)",hint:"画像名",key:"画像ファイル名"},{name:"face",type:"str",val:e.face?.val??"",hint:"差分"},{name:"pos",type:"str",val:e.pos?.val??"",hint:"表示位置"},{name:"alpha",type:"range",val:e.alpha?.val??"",hint:"不透明度",min:"0.0",max:"1.0",step:"0.1"}]}),grp:e=>({col:"base",td_style:"sn-cmb-"+(e.bg?.val?`start" data-fn="${e.bg.val}`:"end"),btn_style:"btn-success",icon:"fa-images",btn_face:(e.bg?.val??"(消去)")+(e.rule?.val?` ${e.rule.val}ルールで`:"")+(e.time?.val?` へ変更 ${e.time.val}msで`:""),args:[{name:"bg",type:"select",val:e.bg?.val??"(消去)",hint:"背景の画像名",key:"画像ファイル名",exts:je.#Dn,filter:"bg/"},{name:"time",type:"num",val:e.time?.val??"1000",hint:"かける時間"},{name:"rule",type:"select",val:e.rule?.val??"",hint:"ルール画像名",key:"画像ファイル名",exts:je.#Dn,filter:"rule/"},{name:"l0",type:"select",val:e.l0?.val??"(消去)",hint:"レイヤ0の画像名",key:"画像ファイル名"},{name:"f0",type:"str",val:e.f0?.val??"",hint:"レイヤ0のface属性"},{name:"pos0",type:"str",val:e.pos0?.val??"",hint:"レイヤ0のpos位置"},{name:"o0",type:"num",val:e.o0?.val??"",hint:"レイヤ0の不透明度"},{name:"l1",type:"select",val:e.l1?.val??"(消去)",hint:"レイヤ1の画像名",key:"画像ファイル名"},{name:"f1",type:"str",val:e.f1?.val??"",hint:"レイヤ1のface属性"},{name:"pos1",type:"str",val:e.pos1?.val??"",hint:"レイヤ1のpos位置"},{name:"o1",type:"num",val:e.o1?.val??"",hint:"レイヤ1の不透明度"},{name:"l2",type:"select",val:e.l2?.val??"(消去)",hint:"レイヤ2の画像名",key:"画像ファイル名"},{name:"f2",type:"str",val:e.f2?.val??"",hint:"レイヤ2のface属性"},{name:"pos2",type:"str",val:e.pos2?.val??"",hint:"レイヤ2のpos位置"},{name:"o2",type:"num",val:e.o2?.val??"",hint:"レイヤ2の不透明度"},{name:"se",type:"str",val:e.se?.val??"",hint:"効果音名"}]}),fg:e=>({col:e.layer?.val??"命令",btn_style:"btn-success",icon:"fa-image",btn_face:e.fn?.val??""}),button:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-sign-out-alt",btn_face:(e.text?.val?`文字ボタン「${e.text.val}」`:"")+(e.pic?.val?`画像ボタン ${e.pic.val}`:"")}),enable_event:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-check-square",btn_face:"イベント発生 "+("true"===e.enabled?.val?"させる":"させない")}),event:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-bolt",btn_face:"イベント予約"+("true"===e.global?.val?"（毎回）":"（一回だけ）")+("true"===e.del?.val?"の削除 ":"")+(e.key?.val??"")}),waitclick:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-hourglass-start",btn_face:"クリック待ち"}),r:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-align-left",btn_face:"文字改行"}),l:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-leaf",btn_face:"改行待ち"}),plc:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-book-open",btn_face:"改ページ待ち"+("false"===e.visible?.val?"（マーク非表示）":""),args:[{name:"visible",type:"bool",val:e.visible?.val??"true",hint:"マーク表示する"},{name:"time",type:"num",val:e.time?.val??"500",hint:"再開時の効果音FO時間"},{name:"buf",type:"str",val:e.buf?.val??"音声",hint:"再開時の再生停止"}]}),let:e=>({btn_style:"btn-secondary",icon:"fa-calculator",btn_face:`変数操作 ${e.name?.val??""}=…`}),bgm:e=>({col:"BGM",td_style:"sn-cmb-"+(e.fn?.val?`start" data-fn="${e.fn.val}`:"end"),btn_style:"btn-info",icon:"fa-play",btn_face:e.fn?.val??"",tooltip:`fn=${e.fn?.val??""}`}),stopbgm:e=>({col:"BGM",td_style:"sn-cmb-end",btn_style:"btn-outline-info",icon:"fa-stop",btn_face:"再生停止"}),fadeoutbgm:e=>({col:"BGM",td_style:"sn-cmb-end",btn_style:"btn-outline-info",icon:"fa-volume-down",btn_face:`フェードアウト ${e.time?.val??""}ms かけて`}),wait:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-hourglass-start",btn_face:`${e.time?.val??"0"}ms`,tooltip:"待機"+(e.time?.val?` time=${e.time.val}ms`:"")+(e.canskip?.val?` スキップできるか=${e.canskip.val}`:"")}),s:e=>({col:"mes",btn_style:"btn-primary",icon:"fa-stop",btn_face:"停止する"}),close:e=>({icon:"fa-window-close",btn_face:"アプリの終了"}),macro:e=>(this.#Hn=e.name?.val??"",{btn_style:"btn-outline-secondary text-white",icon:"fa-box-open",btn_face:`マクロ定義の開始 ${this.#Hn}`,args:[{name:"name",type:"str",val:this.#Hn,hint:"マクロ名"}]}),endmacro:e=>{const t=this.#Hn;return this.#Hn="",{btn_style:"btn-outline-secondary text-white",icon:"fa-box",btn_face:`マクロ定義の終了 ${t}`}},アルバム解放:e=>({icon:"fa-th",btn_face:"アルバム解放 "+(e.name?.val??""),args:[{name:"name",type:"str",val:e.name?.val??"",hint:"素材識別名"}]})};#Hn="";#Fn=7;#En={命令:0,base:1,0:2,1:3,2:4,mes:5,BGM:6,SE:7,詳細:8};#An(e,t,n,a,s,i="",r="",o="",c=""){return"<td></td>".repeat(e)+`\n\t<td class="p-0 ${o}">\n\t\t<button type="button" class="btn btn-block btn-sm ${n}" data-faceicon="${a}" data-ripple-color="dark" id="${String(t)}btn" draggable="true"${i?` data-mdb-toggle="tooltip" data-placement="right" title="${i}"`:""}>\n\t\t\t<i class="fas ${a}" aria-hidden="true"></i>\n\t\t</button>\n\t\t${r?`<div class="dropdown-menu col-xxl-4 col-sm-6 col-12"><form class="p-1 d-flex flex-wrap">${r}</form></div>`:""}\n\t</td>`.replace(" dropdown-toggle","")+"<td></td>".repeat(this.#Fn-e)+`\n\t<td class="p-0">${c||`\n\t\t<button type="button" class="btn btn-block btn-sm px-2 text-start text-lowercase ${n}" data-faceicon="${a}" data-ripple-color="dark" id="${String(t)}detail" draggable="true"${i?` data-mdb-toggle="tooltip" data-placement="right" title="${i}"`:""}>\n\t\t\t<i class="fas ${a}" aria-hidden="true"></i>\n\t\t\t${s}\n\t\t</button>`}\t${r?`<div class="dropdown-menu col-xxl-4 col-sm-6 col-12"><form class="p-1 d-flex flex-wrap">${r}</form></div>`:""}\n\t</td>`}}const Le=JSON.parse('{"frame":{"sum":"フレームに設定  \\nフレームそのものの属性を設定する","param":[{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"[[add_fram]](https://famibee.github.io/SKYNovel/tag.html#add_fram)で定義したフレーム名"},{"name":"alpha","required":"","def":"1.0","rangetype":"0.0〜1.0；透過度","comment":"0（完全透明）〜0.5（半透明）〜1（不透明）"},{"name":"scale_x","required":"","def":"1.0","rangetype":"実数","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転"},{"name":"scale_y","required":"","def":"1.0","rangetype":"実数","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転"},{"name":"rotate","required":"","def":"0","rangetype":"-360〜360；回転角度","comment":"正の値は時計回り"},{"name":"visible","required":"","def":"true","rangetype":"true、false","comment":"trueで行末クリック待ち記号を表示、falseで非表示"},{"name":"disabled","required":"","def":"false","rangetype":"true、false","comment":"trueでスライダーなど操作不可・[[event]](https://famibee.github.io/SKYNovel/tag.html#event)の【dom=系】イベント無効、falseで可能"},{"name":"b_color","required":"","def":"透過","rangetype":"色指定。0x000000など","comment":"背後の矩形色。初期値は 透過（htmlで画像を表示すれば表示）"},{"name":"x","required":"","def":"0","rangetype":"実数；横座標","comment":"画面左上を原点とする画面内におけるフレームの横位置を指定"},{"name":"y","required":"","def":"0","rangetype":"実数；縦座標","comment":"画面左上を原点とする画面内におけるフレームの縦位置を指定"},{"name":"width","required":"","def":"フレームの横サイズ","rangetype":"1〜；横幅","comment":"表示するフレームの横ドットサイズ。元のサイズと異なる場合は拡大・縮小される"},{"name":"height","required":"","def":"フレームの縦サイズ","rangetype":"1〜；縦幅","comment":"保存するフレームの縦ドットサイズ。元のサイズと異なる場合は拡大・縮小される"}],"snippet":[{"nm":"frame","txt":"frame id=${1{{フレーム名}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[HTMLフレーム](https://famibee.github.io/SKYNovel_gallery/?cur=frame)"},"stop_allse":{"sum":"全効果音再生の停止  \\n全てのサウンドを停止する。ぴたっと止める。","param":[],"snippet":[{"nm":"stop_allse","txt":"stop_allse"}],"detail":""},"stop_tsy":{"sum":"トゥイーン中断  \\nレイヤーやフレームのトゥイーンアニメを中断、終了する","param":[{"name":"layer","required":"y","def":"","rangetype":"レイヤ名","comment":"処理対象のレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"処理対象のフレーム"}],"snippet":[{"nm":"stop_tsy","txt":"stop_tsy layer=${1{{レイヤ名}}}"}],"detail":"「layer（とpage）」を指定した場合はレイヤーの操作、  \\n「id」を指定した場合はフレームの操作を行なう\\n\\n機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=tag_tsy)"},"wv":{"sum":"動画再生終了待ち  \\n[lay]で開始したムービー再生の終了を待つ","param":[{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"クリックなど（→詳細は[[waitclick]](https://famibee.github.io/SKYNovel/tag.html#waitclick)）でウエイトをキャンセルできるか"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"},{"name":"stop","required":"","def":"true","rangetype":"true、false","comment":"trueで「クリックキャンセル時の再生停止」、falseなら行なわない"}],"snippet":[{"nm":"wv","txt":"wv canskip=${1|true,false|}"}],"detail":"何かしらの画像レイヤで再生している動画の終了を待つ"},"clear_lay":{"sum":"レイヤ設定の消去  \\n画像や文字などレイヤ状態をクリアする","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）"},{"name":"page","required":"","def":"fore","rangetype":"fore、back、both","comment":"ページの裏表（both指定で両面）"},{"name":"clear_filter","required":"","def":"false","rangetype":"true、false","comment":"true：フィルタもクリア"}],"snippet":[{"nm":"clear_lay","txt":"clear_lay layer=${1{{レイヤ名}}} page=${2|fore,back,both|}"}],"detail":"alpha、blendMode、rotation、scaleX、scaleYを初期値にする\\n※背景や背景画像はクリアしません（b_color、b_alpha） 　クリアしたい場合は、[lay back_clear=true]"},"add_face":{"sum":"差分名称の定義  \\n差分名称を定義する","param":[{"name":"name","required":"y","def":"","rangetype":"差分名称","comment":"[[lay]](https://famibee.github.io/SKYNovel/tag.html#lay)タグface属性で指定する差分名称"},{"name":"fn","required":"","def":"属性nameの値","rangetype":"画像ファイル名","comment":"表示する画像、アニメpng"},{"name":"dx","required":"","def":"0","rangetype":"実数；横座標","comment":"基本画像左上を原点とする差分画像の表示横位置"},{"name":"dy","required":"","def":"0","rangetype":"実数；縦座標","comment":"基本画像左上を原点とする差分画像の表示縦位置"},{"name":"blendmode","required":"","def":"なにもしない","rangetype":"ブレンドモード名","comment":"このレイヤと下のレイヤとの重なりにおいて、ドット単位で色のブレンド演算を行なう"}],"snippet":[{"nm":"add_face","txt":"add_face name=${1{{画像ファイル名}}}"}],"detail":"本タグだけでは差分画像を表示しない。画像レイヤの[[lay]](https://famibee.github.io/SKYNovel/tag.html#lay)タグface属性で指定する差分名称を登録するのみ。\\n\\n例えば同じ画像で差分表示位置やブレンドモードが違う登録をしたい場合、\\n### コード例\\n~~~skynovel\\n[add_face name=a_normal fn=画像 dx=0 dy=0]\\n[add_face name=a_10_10 fn=画像 dx=10 dy=10]\\n[add_face name=a_screen fn=画像 dx=0 dy=0 blendmode=screen]\\n~~~\\nとnameを変えることで登録できます。\\n\\n\\n機能ギャラリーにサンプルがあります。$(play)[画像も動画も表情差分](https://famibee.github.io/SKYNovel_gallery/?cur=tag_lay_face)"},"pop_stack":{"sum":"コールスタック破棄  \\nコールスタックを一つ破棄する\\n極力使用しないコーディングを推奨します","param":[{"name":"clear","required":"","def":"false","rangetype":"true、false","comment":"true：全て破棄する。空でもエラーを出さない  \\nfalse：スタックを一つ破棄する。空の場合はエラーメッセージ＆アプリ停止"}],"snippet":[{"nm":"pop_stack","txt":"pop_stack clear=${1|false,true|}"}],"detail":""},"set_focus":{"sum":"フォーカス移動  \\n[button][link]などのフォーカスを移動する","param":[{"name":"to","required":"y","def":"","rangetype":"prev、next、null","comment":"prev……追加順で前に移動  \\nnext……追加順で次に移動  \\nnull……どの[[button]](https://famibee.github.io/SKYNovel/tag.html#button)[[link]](https://famibee.github.io/SKYNovel/tag.html#link)にもフォーカスがない状態にする"},{"name":"add","required":"y","def":"","rangetype":"（querySelectorAll()引数なセレクタ指定）","comment":"[event key=\'dom=（略）\']指定していないフレーム内HTML要素にフォーカス移動対象に加えられる。  \\n【例】[set_focus add=\'dom=archive:.card-image,.btn_delete\']"},{"name":"del","required":"y","def":"","rangetype":"（querySelectorAll()引数なセレクタ指定）","comment":"フォーカス移動対象から外す。  \\n【例】[set_focus del=\'dom=archive:.card-image,.btn_delete\']"},{"name":"need_err","required":"","def":"true","rangetype":"true、false","comment":"HTML内にセレクタ（add・del属性）に対応する要素が見つからない場合にエラーを出すか"}],"snippet":[{"nm":"set_focus","txt":"set_focus to=${1|prev,next,null|}"}],"detail":"[[button]](https://famibee.github.io/SKYNovel/tag.html#button)[[link]](https://famibee.github.io/SKYNovel/tag.html#link)が文字レイヤに追加された順番、あるいは逆順に「マウスオーバー」表示を移動し、選択する。Enter(Return)キーでボタンクリックと同じ動作をする。\\nフレーム内HTML要素も[event key=\'dom=（略）\']で自動的にフォーカス移動対象に加えられる。\\nキーボードやゲームパッド、スイッチコントロールなどの操作を補助する。"},"else":{"sum":"その他ifブロック開始  \\nプログラム言語における、条件分岐のelse文。\\n詳細は【開発者向け情報：式の評価と条件分岐】をご覧下さい","param":[],"snippet":[{"nm":"else","txt":"else"}],"detail":""},"trans":{"sum":"ページ裏表を交換  \\n裏ページを表ページとクロスフェードする","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）","comment":"クロスフェードするレイヤ。指定以外のレイヤは変化させない"},{"name":"time","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"変化にかける時間"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"変化する前に待機する遅延時間"},{"name":"rule","required":"","def":"","rangetype":"画像ファイル名","comment":"指定した場合はルール画像として、ピクセル単位でクロスフェードするタイミングをずらす。ルール画像の黒いピクセル（と同じ位置にあるピクセル）が先に処理され、白が最後になる。  \\n省略時は画面全体ピクセルで同時にクロスフェードする"},{"name":"vague","required":"","def":"0.04","rangetype":"0.0〜1.0","comment":"トランジション期間全体を1とした値。表レイヤと裏レイヤの境界を曖昧にぼかす度合い"},{"name":"ease","required":"","def":"Linear.None","rangetype":"イージング名","comment":"揺れのイージング（値の変化の仕方）を指定する。  \\n[イージングの変化はこちらの図](https://createjs.com/demos/tweenjs/tween_sparktable)（または[こちら](https://sole.github.io/tween.js/examples/03_graphs.html)）が分かりやすい。  \\n- [tween.js/README.md at master · tweenjs/tween.js](https://github.com/tweenjs/tween.js/blob/master/README.md)  \\n- [CreateJS でのトゥイーンの作成方法 - ICS MEDIA](https://ics.media/tutorial-createjs/tween/)"},{"name":"glsl","required":"","def":"","rangetype":"シェーダー記述言語GLSL","comment":"機能ギャラリーに[フラグメントシェーダの動作サンプル](https://famibee.github.io/SKYNovel_gallery/?cur=glsl_slide)がありますので、詳細はそちらで。  \\nざっくり説明すると、  \\n【vTextureCoord】がピクセルの位置、  \\n【uSampler】が一ピクセル単位の画像データ、  \\n【tick】が時間経過、です"}],"snippet":[{"nm":"trans","txt":"trans layer=${1{{レイヤ名}}} time=${2:500} rule=${3{{画像ファイル名}}}][wt"}],"detail":"クロスフェードを開始すると、終了を待たずに次のタグへと処理を進める。\\n終了を待ちたい場合は[[wt]](https://famibee.github.io/SKYNovel/tag.html#wt)を使用する。\\n\\nクロスフェード終了後は元・裏ページから元・表ページに内容をコピーし、同じ内容になる。\\n\\nルール画像は白黒かグレースケールを推奨。（見た目と動きが一致する）\\n\\n$(warning)また[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)～[[wt]](https://famibee.github.io/SKYNovel/tag.html#wt)間で文字表示や[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)は動作未定義、非推奨。\\n[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)終了を待たず何かをするのは避けた方がよいでしょう。"},"ws":{"sum":"効果音再生の終了待ち  \\n効果音再生の終了を待つ  \\nloop=trueなら待たない。 利用時は【音声再生[playse]がjoin=true(ちなみにデフォルト)であること】を必須条件とします","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"},{"name":"canskip","required":"","def":"false","rangetype":"true、false","comment":"trueでクリックキャンセル可能にする"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"},{"name":"stop","required":"","def":"true","rangetype":"true、false","comment":"trueで「クリックキャンセル時の再生停止」、falseなら行なわない。"}],"snippet":[{"nm":"ws","txt":"ws buf=${1{{サウンドバッファ}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"er":{"sum":"ページ両面の文字消去  \\nデフォルト文字レイヤの裏と表の両方に対して[clear_lay]を行う","param":[{"name":"rec_page_break","required":"","def":"true","rangetype":"true、false","comment":"履歴を改ページするか"},{"name":"clear_filter","required":"","def":"false","rangetype":"true、false","comment":"true：フィルタもクリア"}],"snippet":[{"nm":"er","txt":"er"}],"detail":""},"volume":{"sum":"BGMや効果音の音量を指定  \\nBGMや効果音を指定した音量にする","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"},{"name":"volume","required":"","def":"1.0","rangetype":"0.0〜1.0","comment":"再生音量。ただし音量を示すシステム変数（sys:const.an.sound.BGM.volume）は変更しない"}],"snippet":[{"nm":"volume","txt":"volume buf=${1{{サウンドバッファ}}} volume=${2:1.0}"}],"detail":""},"reload_script":{"sum":"スクリプト再読込  \\n現在処理中のスクリプトをリロードする。実行位置は[record_place]によるセーブポイントまで戻って再開する。  \\n※スクリプトを大幅に変えた後だと、正常に再開できない場合があります。","param":[],"snippet":[{"nm":"reload_script","txt":"reload_script"}],"detail":""},"let":{"sum":"変数代入・演算  \\n変数に値を代入する","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"セットする値"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。  \\nnum……数値（実数）。「01」は数値の1となる。  \\nint……数値（符合付き整数）  \\nuint……数値（符合なし整数）  \\nbool……true、false  \\nstr……文字列。「01」は「01」のまま"},{"name":"val2font","required":"","def":"現在値","rangetype":"true、false","comment":"これ以降（〜スクリプト終端）での変数代入文字列をフォント生成対象とする／しない切り替え"},{"name":"val2fontNm","required":"","def":"現在値","rangetype":"フォント名","comment":"これ以降フォント生成対象とする際のフォント名"}],"snippet":[{"nm":"let","txt":"let name=${1{{代入変数名}}} text=${2:セットする値}"}],"detail":"### コード例\\n~~~skynovel\\n[let name=a text=\'てんぐ👺🌈𩸽🌕\']\\n[trace text=&a] ; -> \'てんぐ👺🌈𩸽🌕\'\\n&a=\'abcde\'\\n[trace text=&a] ; -> \'abcde\'\\n\\n\\n[let_substr name=a text=&a pos=2 len=3]\\n[trace text=&a] ; -> \'cde\'\\n[let_substr name=a text=&a pos=1 len=all]\\n[trace text=&a] ; -> \'de\'\\n~~~"},"let_char_at":{"sum":"文字列から一字取りだし  \\n文字列中の一文字を取り出す。結果を変数に代入する","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"元になる文字列"},{"name":"pos","required":"","def":"0","rangetype":"0〜","comment":"何番目の文字を取り出すか。0（先頭）"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_char_at","txt":"let_char_at name=${1{{代入変数名}}} text=${2:元になる文字列} pos=${3:取り出す位置}"}],"detail":"### コード例\\n~~~skynovel\\n&a=\'abcde\'\\n[let_char_at name=a text=&a pos=1]\\n[trace text=&a] ; -> \'b\'\\n~~~"},"rec_r":{"sum":"履歴改行  \\n履歴に改行を出力する","param":[],"snippet":[{"nm":"rec_r","txt":"rec_r"}],"detail":""},"button":{"sum":"ボタンを表示  \\n文字レイヤにボタンを配置する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"ボタンを配置する文字レイヤ"},{"name":"page","required":"","def":"back","rangetype":"fore、back","comment":"ページの裏表"},{"name":"pic","required":"y","def":"","rangetype":"画像ファイル名","comment":"画像ボタンとして配置する画像を指定する。  \\nただし画像は縦に三等分し、左から「通常時」「クリック押下時」「マウスカーソルを載せた時」の画像として表示する"},{"name":"text","required":"...","def":"","rangetype":"ボタンにする文字列","comment":"文字ボタンとして配置する文字列を指定する。  \\npicかtextのどちらかの指定を必須とする"},{"name":"b_pic","required":"","def":"","rangetype":"画像ファイル名","comment":"文字ボタンの背景画像が指定できる。画像の大きさにかかわらず、文字ボタンのちょうど真ん中に来るよう配置される"},{"name":"width","required":"","def":"100","rangetype":"1〜；横幅","comment":"文字ボタンの横幅を指定する。画像ボタンの場合はこの指定を無視し、画像横幅の1/3にする"},{"name":"height","required":"","def":"30","rangetype":"1〜；縦幅","comment":"文字ボタンの縦幅を指定する。画像ボタンの場合はこの指定を無視し、画像横幅の1/3にする。  \\nまた、文字は必ず横一列になるため、この設定値はフォントサイズと兼用になる"},{"name":"style","required":"","def":"","rangetype":"PIXI TextStyleのJSON文字列（一部）","comment":"文字ボタン上にマウスカーソルが乗っていない状態の文字スタイル"},{"name":"style_hover","required":"","def":"","rangetype":"PIXI TextStyleのJSON文字列（一部）","comment":"文字ボタン上にマウスカーソルが乗っている状態（クリックしていない）の文字スタイル。  \\n設定できる値はstyleと同様"},{"name":"style_clicked","required":"","def":"","rangetype":"PIXI TextStyleのJSON文字列（一部）","comment":"文字ボタン上にマウスカーソルが乗っている状態（クリックしている）の文字スタイル。  \\n設定できる値はstyleと同様"},{"name":"alpha","required":"","def":"1.0","rangetype":"0.0〜1.0；透過度","comment":"0（完全透明）〜0.5（半透明）〜1（不透明）"},{"name":"left","required":"","def":"0","rangetype":"実数","comment":""},{"name":"top","required":"","def":"0","rangetype":"実数","comment":"詳細は[[lay]](https://famibee.github.io/SKYNovel/tag.html#lay)を参照"},{"name":"rotation","required":"","def":"0","rangetype":"-180〜180；回転角度","comment":"時計回りは0～180、反時計回りは0～-180を指定。 左上を中心に回る"},{"name":"scale_x","required":"","def":"1.0","rangetype":"実数","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転"},{"name":"scale_y","required":"","def":"1.0","rangetype":"実数","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転"},{"name":"pivot_x","required":"","def":"0.0","rangetype":"実数","comment":"左上を基準として、回転や移動時の基準を指定"},{"name":"pivot_y","required":"","def":"0.0","rangetype":"実数","comment":"左上を基準として、回転や移動時の基準を指定"},{"name":"enabled","required":"","def":"true","rangetype":"true、false","comment":"falseだと押せないボタンとなり、クリックイベントが発生しない。  \\nこれにより文字レイヤの任意の位置に画像表示できる機能を提供する。  \\n画像は三等分しない。イベントや効果音指定は無効だが、ヒント機能は有効"},{"name":"call","required":"","def":"false","rangetype":"true、false","comment":"trueの場合は[[call]](https://famibee.github.io/SKYNovel/tag.html#call)、falseは[[jump]](https://famibee.github.io/SKYNovel/tag.html#jump)。  \\nただしcall=trueによりサブルーチンコールした場合、[[return]](https://famibee.github.io/SKYNovel/tag.html#return)によって「コールする前のイベント予約状態＆待ち状態」に戻る"},{"name":"fn","required":"","def":"処理中のスクリプト","rangetype":"スクリプトファイル名","comment":"クリック時にジャンプする先"},{"name":"label","required":"","def":"スクリプトの先頭","rangetype":"ラベル名","comment":"コール先のスクリプトにあるラベル","":"クリック時ジャンプ先で「&sn.eventLabel」にて値を受け取れる"},{"name":"url","required":"y","def":"fn・label によるスクリプトジャンプ","rangetype":"ブラウザで開けるURL","comment":"クリック時にURLを開く。指定時は fn・label を無視する"},{"name":"global","required":"","def":"false","rangetype":"true、false","comment":"詳細は[[event]](https://famibee.github.io/SKYNovel/tag.html#event)と同様。  \\nボタンを[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)する場合はtrueにしておく"},{"name":"arg","required":"","def":"","rangetype":"ジャンプ先に渡したい値","comment":"指定した場合、クリック時ジャンプ先で「&sn.eventArg」にて値を受け取れる"},{"name":"onenter","required":"","def":"なにもしない","rangetype":"ラベル名","comment":"マウス重なり（フォーカス取得）時、指定したラベルをコールする。 必ず[[return]](https://famibee.github.io/SKYNovel/tag.html#return)で戻ること"},{"name":"onleave","required":"","def":"なにもしない","rangetype":"ラベル名","comment":"マウス重なり外れ（フォーカス外れ）時、指定したラベルをコールする。 必ず[[return]](https://famibee.github.io/SKYNovel/tag.html#return)で戻ること"},{"name":"clickse","required":"","def":"省略時は無音","rangetype":"音声ファイル名","comment":"指定すると、クリック時に効果音を再生する"},{"name":"enterse","required":"","def":"省略時は無音","rangetype":"音声ファイル名","comment":"指定すると、ボタン上にマウスカーソルが載った時に効果音を再生する"},{"name":"leavese","required":"","def":"省略時は無音","rangetype":"音声ファイル名","comment":"指定すると、ボタン上からマウスカーソルが外れた時に効果音を再生する"},{"name":"clicksebuf","required":"","def":"SYS","rangetype":"サウンドバッファ名","comment":"クリック時効果音を再生するサウンドバッファを指定する"},{"name":"entersebuf","required":"","def":"SYS","rangetype":"サウンドバッファ名","comment":"マウスオン時効果音を再生するサウンドバッファを指定する"},{"name":"leavesebuf","required":"","def":"SYS","rangetype":"サウンドバッファ名","comment":"マウスアウト時効果音を再生するサウンドバッファを指定する"},{"name":"blendmode","required":"","def":"なにもしない","rangetype":"ブレンドモード名","comment":"このレイヤと下のレイヤとの重なりにおいて、ドット単位で色のブレンド演算を行なう"},{"name":"hint","required":"","def":"表示しない","rangetype":"ヒント文字列","comment":"指定した場合のみ、マウスカーソルを載せるとツールチップス表示する"},{"name":"hint_style","required":"","def":"","rangetype":"CSS style","comment":"hintの CSSを指定できる"},{"name":"hint_opt","required":"","def":"","rangetype":"文字列","comment":"@popperjs/coreの動作を指定"}],"snippet":[{"nm":"button","txt":"button text=${1:ボタンにする文字列} left=${2:0} top=${3:0} ${4{{ジャンプ先}}}"}],"detail":"選択肢として使用する場合、ジャンプ先のラベル直後には必ず[[record_place]](https://famibee.github.io/SKYNovel/tag.html#record_place)を記述して、ジャンプ直後でセーブしても正しくセーブされるようにして下さい\\n\\n機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=ch_button)"},"let_search":{"sum":"正規表現で検索  \\n文字列内を正規表現で検索し、最初に val が見つかった位置を返す","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"検索対象の文字列"},{"name":"reg","required":"y","def":"","rangetype":"文字列","comment":"正規表現"},{"name":"flags","required":"","def":"（なし）","rangetype":"文字列","comment":"正規表現のフラグ"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_search","txt":"let_search name=${1{{代入変数名}}} text=${2:検索対象の文字列} reg=${3:正規表現}"}],"detail":"### コード例\\n~~~skynovel\\n&a=\'abcde\'\\n[let_search name=a text=&a reg=\'cd\']\\n[trace text=&a] ; -> 2。a(=0),b(=1),c(=2)の2\\n~~~"},"clearvar":{"sum":"ゲーム変数の全消去   \\nsave:変数を全消去。削除すると言うより、初期化する","param":[],"snippet":[{"nm":"clearvar","txt":"clearvar"}],"detail":""},"toggle_full_screen":{"sum":"全画面状態切替  \\n呼び出す度にアプリの全画面／ウインドウモードを切り替える","param":[{"name":"key","required":"","def":"イベント登録せずモード切替","rangetype":"イベントのキー名","comment":"イベントを発生させるトリガーイベントを予約する。key属性の値は[[event]](https://famibee.github.io/SKYNovel/tag.html#event)を参照"}],"snippet":[{"nm":"toggle_full_screen","txt":"toggle_full_screen key=${1{{イベント名}}}"}],"detail":"現在の状態は文字列変数「tmp:const.sn.displayState」で分かる。trueならフルスクリーン"},"set_frame":{"sum":"フレーム変数に設定  \\nフレーム内の変数に、値を設定する","param":[{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"[[add_fram]](https://famibee.github.io/SKYNovel/tag.html#add_fram)で定義したフレーム名"},{"name":"var_name","required":"y","def":"","rangetype":"文字列","comment":"フレーム内の変数名"},{"name":"text","required":"y","def":"セットする値","rangetype":"文字列","comment":"フレーム内の変数にセットする値"}],"snippet":[{"nm":"set_frame","txt":"set_frame id=${1{{フレーム名}}} var_name=${2:フレーム内の変数名} text=${3:セットする値}"}],"detail":"### コード例\\n~~~skynovel\\n[add_frame id=config src=_config visible=false]\\n[event key=\'dom=config:#close\' label=*exit global=true]\\n\\n[let_frame id=config var_name=val_sldBackAlpha]\\n&sys:TextLayer.Back.Alpha = const.sn.frm.config.val_sldBackAlpha/100\\n[return]\\n\\n*val2ctrl\\n[set_frame id=config var_name=val_sldBackAlpha text=&sys:TextLayer.Back.Alpha*100]\\n[let_frame id=config var_name=val2ctrl function=true]\\n[return]\\n~~~\\n\\n機能ギャラリーにサンプルがあります。$(play)[HTMLフレーム](https://famibee.github.io/SKYNovel_gallery/?cur=frame)"},"macro":{"sum":"マクロ定義の開始  \\n[macro]と[endmacro]に囲まれた部分をマクロとして定義する。定義したマクロは既存のタグと同様に使用できる。渡した属性は、マクロ側で「mp:」スコープにより参照できる","param":[{"name":"name","required":"y","def":"","rangetype":"未定義のマクロ名","comment":"既存のタグやマクロと重複しないマクロ名"},{"name":"nowarn_unused","required":"","def":"false","rangetype":"true、false","comment":"true：未使用警告を止める"},{"name":"sum","required":"","def":"概要説明","rangetype":"文字列","comment":"拡張機能で表示する概要説明"},{"name":"detail","required":"","def":"詳細説明","rangetype":"文字列","comment":"拡張機能で表示する詳細説明"},{"name":"%(属性名)","required":"","def":"属性の詳細説明","rangetype":"型名|省略値|概要","comment":"属性名末尾に「?」を書くと【省略可能な属性】であると示す"},{"name":"design_unit","required":"","def":"false","rangetype":"true、false","comment":"true：デバッグモード時、マクロの引数変更とする（マクロの内部をサーチさせない）"},{"name":"stepin","required":"","def":"true","rangetype":"true、false","comment":"false：デバッグモード時、ステップインしない（マクロ内で停止させない）"},{"name":"snippet_ext","required":"","def":"詳細説明","rangetype":"SP_GSM、SOUND、FONT、SCRIPT","comment":"指定するとスニペット候補に追加できる"}],"snippet":[{"nm":"macro","txt":"macro name=${1:マクロ名}\\n\\tsum=\'概要説明\'\\n\\t%aaa=\'型|省略値|引数説明\'\\n]\\n\\t; ここにマクロの処理内容を\\n[endmacro"}],"detail":""},"add_frame":{"sum":"フレーム追加  \\nHTMLファイルをベースとする「フレーム」を追加する","param":[{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"他のタグなどで操作・参照する歳の名前となる"},{"name":"src","required":"y","def":"","rangetype":"HTMLファイル名","comment":"フレームとして読み込むhtmlファイルのファイル名（画像や音声などのfn属性と同じように）"},{"name":"alpha","required":"","def":"1.0","rangetype":"0.0〜1.0；透過度","comment":"0（完全透明）〜0.5（半透明）〜1（不透明）"},{"name":"scale_x","required":"","def":"1.0","rangetype":"実数","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転"},{"name":"scale_y","required":"","def":"1.0","rangetype":"実数","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転"},{"name":"rotate","required":"","def":"0","rangetype":"-360〜360；回転角度","comment":"正の値は時計回り"},{"name":"visible","required":"","def":"true","rangetype":"true、false","comment":"trueで行末クリック待ち記号を表示、falseで非表示"},{"name":"b_color","required":"","def":"透過","rangetype":"色指定。0x000000など","comment":"背後の矩形色。初期値は 透過（htmlで画像を表示すれば表示）"},{"name":"x","required":"","def":"0","rangetype":"実数；横座標","comment":"画面左上を原点とする画面内におけるフレームの横位置を指定"},{"name":"y","required":"","def":"0","rangetype":"実数；縦座標","comment":"画面左上を原点とする画面内におけるフレームの縦位置を指定"},{"name":"width","required":"","def":"フレームの横サイズ","rangetype":"1〜；横幅","comment":"表示するフレームの横ドットサイズ。元のサイズと異なる場合は拡大・縮小される"},{"name":"height","required":"","def":"フレームの縦サイズ","rangetype":"1〜；縦幅","comment":"保存するフレームの縦ドットサイズ。元のサイズと異なる場合は拡大・縮小される"}],"snippet":[{"nm":"add_frame","txt":"add_frame id=${1{{フレーム名}}} src=${2{{HTMLファイル名}}} visible=${3|true,false|}"}],"detail":"$(warning)注：これは HTML要素の iframe（インラインフレーム要素）で、フレームは全てのレイヤの手前に表示され、互い違いに重ねられない。   \\nconst.sn.frm.（フレーム名）系の値もセットする。\\n\\n### コード例\\n~~~skynovel\\n[add_frame id=config src=_config visible=false]\\n[event key=\'dom=config:#close\' label=*exit global=true]\\n\\n[let_frame id=config var_name=val_sldBackAlpha]\\n&sys:TextLayer.Back.Alpha = const.sn.frm.config.val_sldBackAlpha/100\\n[return]\\n\\n*val2ctrl\\n[set_frame id=config var_name=val_sldBackAlpha text=&sys:TextLayer.Back.Alpha*100]\\n[let_frame id=config var_name=val2ctrl function=true]\\n[return]\\n~~~\\n\\n機能ギャラリーにサンプルがあります。$(play)[HTMLフレーム](https://famibee.github.io/SKYNovel_gallery/?cur=frame)"},"let_index_of":{"sum":"文字列で検索  \\n文字列内を検索し、文字列内の start 以降で、最初に val が見つかった位置を返す","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数。-1の場合は見つからなかった"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"元になる文字列"},{"name":"val","required":"y","def":"","rangetype":"文字列","comment":"探す文字列"},{"name":"start","required":"","def":"0","rangetype":"0〜","comment":"検索を開始する位置。0（先頭）"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_index_of","txt":"let_index_of name=${1{{代入変数名}}} text=${2:元になる文字列} val=${3:探す文字列}"}],"detail":"### コード例\\n~~~skynovel\\n&a=\'abcdeFGHIabcde\'\\n[let_index_of name=a text=&a val=cd start=5]\\n[trace text=&a] ; -> 11\\n[let_index_of name=a text=&a val=GG]\\n[trace text=&a] ; -> -1\\n~~~"},"wait_tsy":{"sum":"トゥイーン終了待ち  \\nレイヤーやフレームの終了を待ち、再開する","param":[{"name":"layer","required":"y","def":"","rangetype":"レイヤ名","comment":"処理対象のレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"処理対象のフレーム"},{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"クリックなどでウエイトをキャンセルできるか"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"wait_tsy","txt":"wait_tsy layer=${1{{レイヤ名}}} canskip=${2|true,false|}"}],"detail":"[[event]](https://famibee.github.io/SKYNovel/tag.html#event)などでイベントが登録されていても、イベント発生待ちを行わない。 繰返し回数が0（無限ループ）の場合、何もせず終了する。  \\n「layer（とpage）」を指定した場合はレイヤーの操作、  \\n「id」を指定した場合はフレームの操作を行なう\\n\\n機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=tag_tsy)"},"return":{"sum":"サブルーチンから戻る  \\nコールスタックに積まれているジャンプ先に戻るようなジャンプをする。\\n最後に積んだスタックを一つ破棄する。\\nマクロ内で実行した場合はマクロを脱出する\\nfn・label属性で戻り先を上書き指定できる。（マクロ内からジャンプしたいときなど）","param":[{"name":"fn","required":"","def":"処理中のスクリプト","rangetype":"スクリプトファイル名","comment":"戻り先のスクリプト"},{"name":"label","required":"","def":"スクリプトの先頭","rangetype":"ラベル名","comment":"戻り先のスクリプトにあるラベル"}],"snippet":[{"nm":"return","txt":"return ${1{{ジャンプ先}}}"}],"detail":""},"endmacro":{"sum":"マクロ定義の終了  \\n[macro]と[endmacro]に囲まれた部分をマクロとして定義する","param":[],"snippet":[{"nm":"endmacro","txt":"endmacro"}],"detail":""},"span":{"sum":"インラインスタイル設定  \\nこの指定以降の文字のレイアウト（フォントや文字色など）を指定する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグ以降のルビ表示に適用される"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\nこのタグ以降のルビ表示に適用される"},{"name":"ch_in_style","required":"","def":"なにもしない","rangetype":"文字出現演出名","comment":"[[ch_in_style]](https://famibee.github.io/SKYNovel/tag.html#ch_in_style)で定義した文字出現演出名"},{"name":"ch_out_style","required":"","def":"なにもしない","rangetype":"文字消去演出名","comment":"[[ch_out_style]](https://famibee.github.io/SKYNovel/tag.html#ch_out_style)で定義した文字消去演出名"},{"name":"r_align","required":"","def":"現在値","rangetype":"left、center、right、justify、121、even、1ruby","comment":"ルビ揃えを指定する。  \\n> left ……（肩付き）先頭親文字から、ルビ間は密着  \\n> center ……（中付き）センター合わせ、〃  \\n> right ……（右／下揃え）末尾親文字から、〃  \\n> justify ……（両端揃え）先頭から末尾親文字間に、ルビ間は均等にあける  \\n> 121 ……（1-2-1(JIS)）ルビの前後を比率1、ルビ間を比率2であける  \\n> even ……（均等アキ）ルビの前後、ルビ間も均等にあける  \\n> 1ruby ……（1ルビ文字アキ）ルビの前後をルビ一文字空け、ルビ間は均等にあける  \\n  \\n初期値は center。  \\n  \\n※親文字よりルビの方が長い場合は、親文字に対する「中付き」表示になる  \\n→参考（[機能ギャラリー・直感的なルビ文法](https://famibee.github.io/SKYNovel_gallery/index.html?cur=built_in_ruby)）"}],"snippet":[{"nm":"span","txt":"span style=${1:CSSstyle}"}],"detail":"一時的に文字レイヤのlayout属性への指定を上書きするイメージ。 文字レイヤをクリア（[[clear_text]](https://famibee.github.io/SKYNovel/tag.html#clear_text)、[[clear_lay]](https://famibee.github.io/SKYNovel/tag.html#clear_lay)）するとリセット、以降は元通り文字レイヤのlayout属性に従う"},"fadese":{"sum":"効果音のフェード  \\n効果音を指定した音量に、段階的に変化させる","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"},{"name":"volume","required":"y","def":"","rangetype":"0.0〜1.0","comment":"音量"},{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"フェード時間"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"変化する前に待機する遅延時"}],"snippet":[{"nm":"fadese","txt":"fadese buf=${1{{サウンドバッファ}}} volume=${2:0.0} time=${3:1000}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"p":{"sum":"改ページクリック待ち  \\nシナリオファイルの順次処理を停止し、クリックやキー押下（→詳細は[waitclick]）を待つ","param":[{"name":"visible","required":"","def":"true","rangetype":"true、false","comment":"trueで改ページ記号を表示、falseで非表示"},{"name":"er","required":"","def":"なにもしない","rangetype":"true、false","comment":"trueで改ページ待ち後に[[er]](https://famibee.github.io/SKYNovel/tag.html#er)処理を行なう"},{"name":"x","required":"","def":"0","rangetype":"実数；横座標","comment":"文字表示位置左上を原点とする横座標"},{"name":"y","required":"","def":"0","rangetype":"実数；縦座標","comment":"文字表示位置左上を原点とする縦座標"},{"name":"width","required":"","def":"画像の横サイズ","rangetype":"1〜；横幅","comment":"表示する画像の横ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"height","required":"","def":"画像の縦サイズ","rangetype":"1〜；縦幅","comment":"保存する画像の縦ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"p","txt":"p visible=${1|true,false|}"}],"detail":"「breakpage」という画像やアニメpngファイルが用意されていれば、改ページクリック待ちマークとして表示する。\\nクリックやキー押下が発生した場合、処理を再開する。\\n[[event]](https://famibee.github.io/SKYNovel/tag.html#event)などでイベントが登録されていれば、イベント発生待ちを行う。"},"endlet_ml":{"sum":"インラインテキスト代入の終端  \\n[let_ml]〜[endlet_ml]で囲んだ複数行テキストを代入する","param":[],"snippet":[{"nm":"endlet_ml","txt":"endlet_ml"}],"detail":""},"if":{"sum":"ifブロックの開始  \\nプログラム言語における、条件分岐のif文","param":[{"name":"exp","required":"y","def":"","rangetype":"条件式","comment":"trueの場合処理は直後にうつる。  \\nfalseなら次の[[elsif]](https://famibee.github.io/SKYNovel/tag.html#elsif)や[[else]](https://famibee.github.io/SKYNovel/tag.html#else)の評価を行なう"}],"snippet":[{"nm":"if","txt":"if exp=${1:Boolean式}][endif"}],"detail":"詳細は【[開発者向け情報：式の評価と条件分岐](https://famibee.github.io/SKYNovel/dev.html#cond)】をご覧下さい。\\n\\n機能ギャラリーにサンプルがあります。$(play)[直感的なルビ文法](https://famibee.github.io/SKYNovel_gallery/?cur=ruby)"},"l":{"sum":"行末クリック待ち  \\nシナリオファイルの順次処理を停止し、クリックやキー押下（→詳細は[waitclick]）を待つ","param":[{"name":"visible","required":"","def":"true","rangetype":"true、false","comment":"trueで行末クリック待ち記号を表示、falseで非表示"},{"name":"x","required":"","def":"0","rangetype":"実数；横座標","comment":"文字表示位置左上を原点とする横座標"},{"name":"y","required":"","def":"0","rangetype":"実数；縦座標","comment":"文字表示位置左上を原点とする縦座標"},{"name":"width","required":"","def":"画像の横サイズ","rangetype":"1〜；横幅","comment":"表示する画像の横ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"height","required":"","def":"画像の縦サイズ","rangetype":"1〜；縦幅","comment":"保存する画像の縦ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"l","txt":"l visible=${1|true,false|}"}],"detail":"「breakline」という画像やアニメpngファイルが用意されていれば、行末クリック待ちマークとして表示する。\\nクリックやキー押下が発生した場合、処理を再開する。\\n[[event]](https://famibee.github.io/SKYNovel/tag.html#event)などでイベントが登録されていれば、イベント発生待ちを行う"},"title":{"sum":"タイトル指定  \\nアプリウインドウのタイトル文字列を設定する","param":[{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"タイトル文字列"}],"snippet":[{"nm":"title","txt":"title text=${1:タイトル文字列}"}],"detail":""},"playse":{"sum":"効果音の再生  \\n効果音を再生する","param":[{"name":"fn","required":"y","def":"","rangetype":"音声ファイル名","comment":"再生する音声ファイル名"},{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"},{"name":"loop","required":"","def":"false","rangetype":"true、false","comment":"trueでBGMのようにループ再生する"},{"name":"volume","required":"","def":"1.0","rangetype":"0.0〜1.0","comment":"再生音量。ただし音量を示すシステム変数（sys:const.an.sound.BGM.volume）は変更しない"},{"name":"speed","required":"","def":"1.0","rangetype":"0.0〜1.0","comment":"再生速度（0:遅い、1.0:元のまま）"},{"name":"pan","required":"0.0","def":"-1.0〜1.0","rangetype":"音を出す左右位置（-1.0=左端、0.0=中央(省略値)、1.0=右端）"},{"name":"join","required":"","def":"true","rangetype":"true、false","comment":"trueで読み込みを待って次のタグへ進む"},{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"trueでキー押下Skip中なら再生をしない"},{"name":"start_ms","required":"","def":"0（冒頭）","rangetype":"0〜；ミリ秒","comment":"再生の開始位置を指定する。0は冒頭"},{"name":"end_ms","required":"","def":"末端","rangetype":"0〜；ミリ秒","comment":"再生の終了位置を指定する。省略時は末端。  \\n正の値は「冒頭から何ms目を終端とするか」  \\n負の値は「末尾から何ms手前を終端とするか」の指定"},{"name":"ret_ms","required":"","def":"0（冒頭）","rangetype":"0〜；ミリ秒","comment":"ループ戻り位置を指定する。0は冒頭。  \\nループ再生中にend_ms指定位置（省略時は末尾）に到達した場合、この指定位置に戻る。 ループ再生しない（loop=false）際は無視される。"}],"snippet":[{"nm":"playse","txt":"playse fn=${1{{音声ファイル名}}} buf=${2{{サウンドバッファ}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"snapshot":{"sum":"スナップショット  \\nアプリ表示部分全体を画像として保存する","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）","comment":"スナップショットに含むレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"fn","required":"","def":"snapshot","rangetype":"保存するファイル名","comment":"省略時はデスクトップに保存  \\n保存する画像フォーマット（png、jpg）は拡張子で指定"},{"name":"width","required":"","def":"アプリ表示部分の横サイズ","rangetype":"1〜；横幅","comment":"保存する画像の横ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"height","required":"","def":"アプリ表示部分の縦サイズ","rangetype":"1〜；縦幅","comment":"保存する画像の縦ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"smoothing","required":"","def":"false","rangetype":"true、false","comment":"拡大・縮小保存される場合、スムージングするか"},{"name":"b_color","required":"","def":"config.anprjで指定した背景色","rangetype":"透過つき色指定。0xFF000000（黒）など  \\n16進数では透過2桁＋赤2桁＋緑2桁＋青2桁で指定","comment":"テキスト背後の矩形色。pngで 0x0 にすると透過する。  \\n透過しない黒は 0xFF000000"}],"snippet":[{"nm":"snapshot","txt":"snapshot layer=${1:レイヤ名}"}],"detail":"画面スナップショットをダウンロードフォルダに保存する。\\nファイル名にはプロジェクト名と日時どが追加される。\\n\\n※文字の表示とスナップショットは、厳密には同じではないので注意。"},"navigate_to":{"sum":"ＵＲＬを開く  \\nWebページを開く","param":[{"name":"url","required":"y","def":"","rangetype":"ブラウザで開けるURL","comment":"開くURL"}],"snippet":[{"nm":"navigate_to","txt":"navigate_to url=${1:WebページURL}"}],"detail":""},"stopse":{"sum":"効果音再生の停止  \\n効果音再生を停止する","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"}],"snippet":[{"nm":"stopse","txt":"stopse buf=${1{{サウンドバッファ}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"stopfadese":{"sum":"音声フェードの停止  \\n音声フェードを停止する","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"}],"snippet":[{"nm":"stopfadese","txt":"stopfadese buf=${1{{サウンドバッファ}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"resume_tsy":{"sum":"一時停止再開  \\nレイヤーやフレームのトゥイーンアニメ一時停止を再開させる","param":[{"name":"layer","required":"y","def":"","rangetype":"レイヤ名","comment":"処理対象のレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"処理対象のフレーム"}],"snippet":[{"nm":"resume_tsy","txt":"resume_tsy layer=${1{{レイヤ名}}}"}],"detail":"「layer（とpage）」を指定した場合はレイヤーの操作、  \\n「id」を指定した場合はフレームの操作を行なう\\n\\n機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=tag_tsy)"},"erasebookmark":{"sum":"しおりの消去  \\nしおりデータを削除する","param":[{"name":"place","required":"y","def":"","rangetype":"0〜","comment":"処理対象のしおり番号"}],"snippet":[{"nm":"erasebookmark","txt":"erasebookmark place=${1:処理対象のしおり番号}"}],"detail":""},"fadebgm":{"sum":"BGMのフェード  \\nBGMを指定した音量に、段階的に変化させる","param":[{"name":"volume","required":"y","def":"","rangetype":"0.0〜1.0","comment":"音量"},{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"フェード時間"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"変化する前に待機する遅延時"}],"snippet":[{"nm":"fadebgm","txt":"fadebgm volume=${1:0.0} time=${2:1000}"}],"detail":""},"reset_rec":{"sum":"履歴リセット  \\n履歴をクリアする。応用として、履歴に加工した文字列を設定し、履歴画面に機能を追加する事も","param":[{"name":"text","required":"","def":"全てクリア","rangetype":"文字列","comment":"履歴に設定したい文字列"}],"snippet":[{"nm":"reset_rec","txt":"reset_rec"}],"detail":""},"xchgbuf":{"sum":"サウンドバッファの交換  \\n二つのバッファを交換する。未再生でも再生中でも良いが、フェード中は避けること","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"サウンドバッファ"},{"name":"buf2","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"もう一つのサウンドバッファ"}],"snippet":[{"nm":"xchgbuf","txt":"xchgbuf buf=${1{{サウンドバッファ}}} buf2=${2{{サウンドバッファ}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"call":{"sum":"サブルーチンコール  \\nスクリプト処理の現在位置をコールスタックに積み、ジャンプする","param":[{"name":"fn","required":"","def":"処理中のスクリプト","rangetype":"スクリプトファイル名","comment":"コール先のスクリプトファイル[call fn=ext_*]のようにワイルドカードをサポート。マッチするスクリプトを順不同にコールする。（ワイルドカードは後方のみ）"},{"name":"label","required":"","def":"スクリプトの先頭","rangetype":"ラベル名","comment":"コール先のスクリプトファイルにあるラベル","":"クリック時ジャンプ先で「&sn.eventLabel」にて値を受け取れる"},{"name":"count","required":"","def":"false","rangetype":"true、false","comment":"タグ位置を既読とするか"},{"name":"clear_local_event","required":"","def":"なにもしない","rangetype":"true、false","comment":"trueの場合は[[clear_event]](https://famibee.github.io/SKYNovel/tag.html#clear_event)を行なってからコールする"}],"snippet":[{"nm":"call","txt":"call ${1{{ジャンプ先}}}"}],"detail":"ジャンプ先での[[return]](https://famibee.github.io/SKYNovel/tag.html#return)により本タグの次の位置に戻る事が出来る。\\n\\n$(info)マニアックな話ですが、あらゆるタグの中で唯一「通常、既読としない」タグです。"},"stopbgm":{"sum":"BGM 演奏の停止  \\nBGM 演奏を停止する。ぴたっと止める。","param":[],"snippet":[{"nm":"stopbgm","txt":"stopbgm"}],"detail":""},"elsif":{"sum":"別条件のifブロック開始  \\nプログラム言語における、条件分岐のelsif文。\\n詳細は【開発者向け情報：式の評価と条件分岐】をご覧下さい","param":[{"name":"exp","required":"y","def":"","rangetype":"条件式","comment":"trueの場合処理は直後にうつる。  \\nfalseなら次の[[elsif]](https://famibee.github.io/SKYNovel/tag.html#elsif)や[[else]](https://famibee.github.io/SKYNovel/tag.html#else)の評価を行なう"}],"snippet":[{"nm":"elsif","txt":"elsif exp=${1:Boolean式}"}],"detail":""},"load":{"sum":"しおりの読込  \\nしおりデータを読み込み、スクリプト処理を再開する","param":[{"name":"place","required":"y","def":"","rangetype":"0〜","comment":"処理対象のしおり番号"},{"name":"fn","required":"","def":"処理中のスクリプト","rangetype":"スクリプトファイル名","comment":"ロード後最初にしたい共通処理をコールする（処理は[[return]](https://famibee.github.io/SKYNovel/tag.html#return)で終わらせる）。指定方法は[[jump]](https://famibee.github.io/SKYNovel/tag.html#jump)と同様。ただし指定する際、fnとlabelは両方指定しなければならない"},{"name":"label","required":"","def":"スクリプトの先頭","rangetype":"ラベル名","comment":"コール先のスクリプトにあるラベル"}],"snippet":[{"nm":"load","txt":"load place=${1:処理対象のしおり番号} ${2{{ジャンプ先}}}"}],"detail":""},"clear_text":{"sum":"文字消去  \\n文字のみをクリアする","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"}],"snippet":[{"nm":"clear_text","txt":"clear_text layer=${1{{文字レイヤ名}}} page=${2|fore,back|}"}],"detail":""},"wb":{"sum":"BGM フェードの終了待ち  \\nBGM フェードの終了を待つ","param":[{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"trueでクリックキャンセル可能にする"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"wb","txt":"wb canskip=${1|false,true|}"}],"detail":""},"close":{"sum":"アプリの終了  \\nアプリケーションを終了する","param":[],"snippet":[{"nm":"close","txt":"close"}],"detail":""},"dump_script":{"sum":"スクリプトのダンプ  \\n内部API","param":[{"name":"set_fnc","required":"y","def":"","rangetype":"GlobalThis要素名","comment":"...（内部APIにつき説明省略）"},{"name":"need_err","required":"","def":"true","rangetype":"true、false","comment":"HTML内にセレクタ（set_fnc属性）に対応する要素が見つからない場合にエラーを出すか"}],"snippet":[{"nm":"dump_script","txt":"dump_script"}],"detail":""},"let_ml":{"sum":"インラインテキスト代入  \\n[let_ml]〜[endlet_ml]で囲んだ複数行テキストを代入する","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"}],"snippet":[{"nm":"let_ml","txt":"let_ml name=${1{{代入変数名}}}]\\n\\tここに自由な複数行テキストを\\n[endlet_ml"}],"detail":"【JSON文字列を「.」表記で取り出せる書式】との組み合わせで、以下のようなことができます。\\n\\n### コード例\\n~~~skynovel\\n[let_ml name=a]\\n\\t{\\n\\t\\t\\"b\\": 3,\\n\\t\\t\\"c\\": 5\\n\\t}\\n[endlet_ml]\\n[trace text=&a] ; -> {\\"b\\": 3, \\"c\\": 5}\\n[trace text=&a.b] ; -> 3\\n[trace text=&a.c] ; -> 5\\n~~~\\n\\n機能ギャラリー【[フラグメントシェーダで[trans ]](https://famibee.github.io/SKYNovel_gallery/?cur=glsl_slide)】では、GLSLというシェーダー記述言語を扱うのに使用しています。\\n\\n### コード例\\n~~~skynovel\\n[let_ml name=ml]\\n\\tprecision mediump float;\\n\\tvarying vec2 vTextureCoord;\\n\\tuniform sampler2D uSampler;\\n\\tuniform float tick;\\n\\n\\tvoid main(void) {\\n\\t\\tvec2 pos = vTextureCoord;\\n\\t\\tpos.x = pos.x + tick;\\n\\t\\tif (pos.x > 1.0) gl_FragColor = vec4(0);\\n\\t\\telse gl_FragColor = texture2D(uSampler, pos);\\n\\t}\\n[endlet_ml]\\n~~~"},"let_abs":{"sum":"絶対値  \\n絶対値を求める。結果を変数に代入する","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"実数","comment":"絶対値を求める数"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_abs","txt":"let_abs name=${1{{代入変数名}}} text=${2:絶対値を求める数}"}],"detail":"### コード例\\n~~~skynovel\\n[let_abs name=a text=-3.56]\\n[trace text=&a] ; -> 3.56\\n~~~"},"tcy":{"sum":"縦中横を表示する  \\n縦中横文字を追加する。ルビは同時に設定する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"t","required":"y","def":"","rangetype":"縦中横文字列","comment":"通常半角文字を指定する"},{"name":"r","required":"","def":"ルビ無し","rangetype":"ルビ文字列","comment":"ルビ文字列"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時。"}],"snippet":[{"nm":"tcy","txt":"tcy t=${1:縦中横文字列}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[トップページの「451」](https://famibee.github.io/SKYNovel_gallery/)"},"tsy_frame":{"sum":"フレームをトゥイーン開始  \\nフレームのトゥイーンアニメを行なう","param":[{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"[[add_fram]](https://famibee.github.io/SKYNovel/tag.html#add_fram)で定義したフレーム名"},{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"トゥイーンにかける時間"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"トゥイーンを始める前の、何もしない待ち時間"},{"name":"repeat","required":"","def":"1","rangetype":"0〜；繰返し回数","comment":"0か負の値 で無限ループ。1を設定すると「繰り返しなし」、2を設定すると「二回同じ動き」を行なう"},{"name":"ease","required":"","def":"Linear.None","rangetype":"イージング名","comment":"揺れのイージング（値の変化の仕方）を指定する。[イージングの変化はこちらの図](https://createjs.com/demos/tweenjs/tween_sparktable)（または[こちら](https://sole.github.io/tween.js/examples/03_graphs.html)）が分かりやすい。指定できる値は[[tsy]](https://famibee.github.io/SKYNovel/tag.html#tsy)を参照"},{"name":"yoyo","required":"","def":"false","rangetype":"true、false","comment":"（暫定）ヨーヨーのように逆方向に戻って繰り返す"},{"name":"chain","required":"","def":"なにもしない","rangetype":"レイヤ名","comment":"指定したレイヤのトゥイーンアニメが終了してから、このトゥイーンを続けて開始する"},{"name":"alpha","required":"","def":"1.0","rangetype":"相対値か絶対値","comment":"レイヤの透過度。0（完全透明）〜0.5（半透明）〜1（不透明）  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"width","required":"","def":"なにもしない","rangetype":"相対値か絶対値","comment":"横幅  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"height","required":"","def":"なにもしない","rangetype":"相対値か絶対値","comment":"縦幅  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"rotation","required":"","def":"0","rangetype":"相対値か絶対値","comment":"時計回りは0～180、反時計回りは0～-180を指定。左上を中心に回る  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"scale_x","required":"","def":"1.0","rangetype":"相対値か絶対値","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"scale_y","required":"","def":"1.0","rangetype":"相対値か絶対値","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"x","required":"","def":"0","rangetype":"相対値か絶対値","comment":"leftの変化目標値  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"y","required":"","def":"0","rangetype":"相対値か絶対値","comment":"topの変化目標値  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"path","required":"","def":"なにもしない","rangetype":"※コメントで解説","comment":"指定すると複数のポイントを連続してトゥイーンアニメする。  \\nポイントは半角丸括弧()【吉里吉里拡張】や{}【JSON形式】が連続する文字列。  \\n"}],"snippet":[{"nm":"tsy_frame","txt":"tsy_frame id=${1{{フレーム名}}} time=${2:トゥイーンにかける時間}"}],"detail":"「目標値」を設定する時、相対値あるいは絶対値を指定できる\\n\\n| 指定\\t\\t\\t | 説明\\t|\\n--|--\\n| x=500\\t\\t\\t| X位置を500に |\\n| x=\'=500\'\\t\\t| 現在のX位置に+500加算した位置 |\\n| x=\'=-500\'\\t\\t| 現在のX位置に-500加算した位置 |\\n| x=\'250,500\'\\t| +250から＋500までの間でランダムな位置 |\\n| x=\'=250,500\'\\t| +250から＋500までの間でランダムな値を現在のX位置に加算した位置 |"},"wf":{"sum":"効果音フェードの終了待ち  \\n効果音 フェードの終了を待つ","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"},{"name":"canskip","required":"","def":"false","rangetype":"true、false","comment":"trueでクリックキャンセル可能にする"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"wf","txt":"wf buf=${1{{サウンドバッファ}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"log":{"sum":"ログ出力  \\nダウンロードフォルダにテキスト出力する（追記ではなく上書き。追記する。出力日時・分・スクリプト名や行番号やプロジェクト名も出力","param":[{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"ログ出力する値"}],"snippet":[{"nm":"log","txt":"log text=&${1{{代入変数名}}}"}],"detail":"### コード例\\n~~~skynovel\\n[log text=\'てんぐ👺🌈𩸽🌕\']\\n~~~"},"endlink":{"sum":"ハイパーリンクの終了  \\n[link]（ハイパーリンク）で開始したリンク区間を終了する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"}],"snippet":[{"nm":"endlink","txt":"endlink layer=${1{{文字レイヤ名}}} page=${2|fore,back|}"}],"detail":""},"update_check":{"sum":"更新チェック機能  \\nネットにアプリの更新を確認し、ダウンロードもサポートする","param":[{"name":"url","required":"y","def":"","rangetype":"URL文字列","comment":"latest(-mac).ymlや、dmg(exe)を置いたWebサーバーのフォルダURLを指定する。終端は「/」をつけること"}],"snippet":[{"nm":"update_check","txt":"update_check url=${1:WebページURL}"}],"detail":"アプリの最新バージョンをネットで確認する。（アプリ版でのみ動作）\\n処理は非同期に行われ、更新があった時のみ更新確認ウインドウが表示される。\\nダウンロードフォルダにアプリパッケージの dmg（インストーラー exe）をダウンロードする"},"ruby2":{"sum":"文字列と複数ルビの追加  \\n親文字列とルビ文字列のセットで文字を追加する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"t","required":"y","def":"","rangetype":"文字列","comment":"親文字列"},{"name":"r","required":"y","def":"","rangetype":"文字列","comment":"ルビ文字列"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"}],"snippet":[{"nm":"ruby2","txt":"ruby2 t=${1:親文字列} r=${2:ルビ文字列}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[直感的なルビ文法](https://famibee.github.io/SKYNovel_gallery/?cur=ruby)"},"r":{"sum":"改行  \\n指定した文字レイヤの表ページに、改行を出力する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"record","required":"","def":"true","rangetype":"true、false","comment":"履歴に保存するか"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"}],"snippet":[{"nm":"r","txt":"r"}],"detail":""},"window":{"sum":"アプリウインドウ設定  \\nゲームアプリのウインドウサイズや位置などを変更する","param":[{"name":"width","required":"","def":"現在値","rangetype":"1〜；横幅","comment":"アプリウインドウの横幅を指定"},{"name":"height","required":"","def":"現在値","rangetype":"1〜；縦幅","comment":"アプリウインドウの高さを指定"},{"name":"framerate","required":"","def":"現在値","rangetype":"1〜","comment":"アプリ全体のフレームレートを変更"},{"name":"centering","required":"","def":"なにもしない","rangetype":"true、false","comment":"trueを指定すると、アプリウインドウをデスクトップの中央に移動する"},{"name":"x","required":"","def":"なにもしない","rangetype":"実数；横座標","comment":"デスクトップにおけるアプリウインドウの横位置を指定"},{"name":"y","required":"","def":"なにもしない","rangetype":"実数；縦座標","comment":"デスクトップにおけるアプリウインドウの縦位置を指定"}],"snippet":[{"nm":"window","txt":"window"}],"detail":""},"enable_event":{"sum":"イベント有無の切替  \\n文字レイヤごとのイベント発生有効無効を設定する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"イベント有効無効を設定するレイヤ"},{"name":"enabled","required":"","def":"true","rangetype":"true、false","comment":"イベントを有効にするか"}],"snippet":[{"nm":"enable_event","txt":"enable_event global=${1|false,true|}"}],"detail":"無効にするとマウスイベントが無効になり、[[s]](https://famibee.github.io/SKYNovel/tag.html#s)待ちなどでイベントが発生しなくなるが、イベント予約は別の話であり、削除などされない。 有効にすればマウスイベントが発生するようになり、再びイベント待ちされるようになる"},"tsy":{"sum":"トゥイーン開始  \\nレイヤーにトゥイーンアニメ（変形・移動・回転アニメーション）を加える","param":[{"name":"layer","required":"y","def":"","rangetype":"レイヤ名","comment":"処理対象のレイヤ"},{"name":"name","required":"y","def":"layerの値","rangetype":"文字列","comment":"トゥイーン名"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"トゥイーンにかける時間"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"トゥイーンを始める前の、何もしない待ち時間- "},{"name":"repeat","required":"","def":"1","rangetype":"0〜；繰返し回数","comment":"0か負の値 で無限ループ。1を設定すると「繰り返しなし」、2を設定すると「二回同じ動き」を行なう"},{"name":"arrive","required":"","def":"false","rangetype":"true、false","comment":"trueならクリックキャンセルでアニメ終端までSkip。falseならその場で停止"},{"name":"backlay","required":"","def":"false","rangetype":"true、false","comment":"trueならトゥイーン終了時、fore→backへ属性をコピーする。  \\nコピーする属性はalpha, height, rotation, scale_x, scale_y, width, left, top"},{"name":"ease","required":"","def":"Linear.None","rangetype":"イージング名","comment":"揺れのイージング（値の変化の仕方）を指定する。[イージングの変化はこちらの図](https://createjs.com/demos/tweenjs/tween_sparktable)（または[こちら](https://sole.github.io/tween.js/examples/03_graphs.html)）が分かりやすい。指定できる値は[[tsy]](https://famibee.github.io/SKYNovel/tag.html#tsy)を参照"},{"name":"yoyo","required":"","def":"false","rangetype":"true、false","comment":"（暫定）ヨーヨーのように逆方向に戻って繰り返す"},{"name":"chain","required":"","def":"なにもしない","rangetype":"レイヤ名","comment":"指定したレイヤのトゥイーンアニメが終了してから、このトゥイーンを続けて開始する"},{"name":"alpha","required":"","def":"1.0","rangetype":"相対値か絶対値","comment":"レイヤの透過度。0（完全透明）〜0.5（半透明）〜1（不透明）  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"width","required":"","def":"なにもしない","rangetype":"相対値か絶対値","comment":"横幅  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"height","required":"","def":"なにもしない","rangetype":"相対値か絶対値","comment":"縦幅  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"rotation","required":"","def":"0","rangetype":"相対値か絶対値","comment":"時計回りは0～180、反時計回りは0～-180を指定。左上を中心に回る  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"scale_x","required":"","def":"1.0","rangetype":"相対値か絶対値","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"scale_y","required":"","def":"1.0","rangetype":"相対値か絶対値","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"x","required":"","def":"0","rangetype":"相対値か絶対値","comment":"leftの変化目標値  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"y","required":"","def":"0","rangetype":"相対値か絶対値","comment":"topの変化目標値  \\n> **相対値あるいは絶対値を指定できる**  \\n> x=500 .......... 500  \\n> x=\'=500\' ....... 現在のxに+500加算した値  \\n> x=\'=-500\' ...... 現在のxに-500加算した値  \\n> x=\'250,500\' .... +250から＋500までの間でランダムな値  \\n> x=\'=250,500\' ... +250から＋500までの間でランダムな値を現在のxに加算した値"},{"name":"path","required":"","def":"なにもしない","rangetype":"※コメントで解説","comment":"指定すると複数のポイントを連続してトゥイーンアニメする。  \\nポイントは半角丸括弧()【吉里吉里拡張】や{}【JSON形式】が連続する文字列。  \\n"},{"name":"render","required":"","def":"false","rangetype":"true、false","comment":"trueを指定すると[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)のように絵を合成してから不透明度を適用するように（半透明時に差分境界が見えなくなる）"},{"name":"filter","required":"","def":"blur","rangetype":"フィルター名","comment":"レイヤに指定するフィルター名。その他必要な属性は適宜指定する。詳細は[[add_filter]](https://famibee.github.io/SKYNovel/tag.html#add_filter)参照。ただし[[add_filter]](https://famibee.github.io/SKYNovel/tag.html#add_filter)のような追加ではなく上書き"},{"name":"enable_filter","required":"true","def":"true、false","rangetype":"フィルターを有効にするか"}],"snippet":[{"nm":"tsy","txt":"tsy layer=${1{{レイヤ名}}} time=${2:トゥイーンにかける時間}"}],"detail":"「目標値」を設定する時、相対値あるいは絶対値を指定できる\\n\\n| 指定\\t\\t\\t | 説明\\t|\\n--|--\\n| x=500\\t\\t\\t| X位置を500に |\\n| x=\'=500\'\\t\\t| 現在のX位置に+500加算した位置 |\\n| x=\'=-500\'\\t\\t| 現在のX位置に-500加算した位置 |\\n| x=\'250,500\'\\t| +250から＋500までの間でランダムな位置 |\\n| x=\'=250,500\'\\t| +250から＋500までの間でランダムな値を現在のX位置に加算した位置 |\\n\\n\\n機能ギャラリーにサンプルがあります。$(play)[トゥイーンアニメを行なう](https://famibee.github.io/SKYNovel_gallery/?cur=tag_tsy)"},"endif":{"sum":"ifブロックの終端  \\nプログラム言語における、条件分岐のendif文。\\n詳細は【開発者向け情報：式の評価と条件分岐】をご覧下さい","param":[],"snippet":[{"nm":"endif","txt":"endif"}],"detail":""},"import":{"sum":"プレイデータをインポート  \\nプレイデータファイルをインポートする\\n\\n読み込みダイアログが表示され、選択したプレイデータファイルをインポートする。\\nプレイデータ拡張子、ウェブ版は.swpd、アプリ版は.spdで互換性はない。\\n\\nタグはダイアログを表示次第すぐ次の処理に移り、ユーザーの選択を待たない。\\nインポート完了時には【sn:imported】というイベントを発火する。\\n【[event key=\'sn:imported\' 〜]】という記述でジャンプできる。\\n\\n機能ギャラリーにサンプルがあります。$(play)[プレイデータ](https://famibee.github.io/SKYNovel_gallery/?cur=import)","param":[],"snippet":[{"nm":"import","txt":"import"}],"detail":""},"let_replace":{"sum":"正規表現で置換  \\n文字列を正規表現で検索し、マッチする箇所を文字列で置き換える","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"置換対象の文字列"},{"name":"reg","required":"y","def":"","rangetype":"文字列","comment":"正規表現"},{"name":"flags","required":"","def":"（なし）","rangetype":"文字列","comment":"正規表現のフラグ"},{"name":"val","required":"y","def":"","rangetype":"文字列","comment":"置き換える文字列"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_replace","txt":"let_replace name=${1{{代入変数名}}} text=${2:置換対象の文字列} reg=${3:正規表現} val=${4:置き換える文字列}"}],"detail":"### コード例\\n~~~skynovel\\n&a=\'abcde\'\\n[let_replace name=a text=&a reg=\'cd\' val=GG]\\n[trace text=&a] ; -> abGGe\\n~~~"},"fadeoutbgm":{"sum":"BGMのフェードアウト  \\nBGMを無音に、段階的に変化させる","param":[{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"フェード時間"},{"name":"stop","required":"","def":"true","rangetype":"true、false","comment":"trueで「フェード終了時の再生停止」、falseなら行なわない"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"変化する前に待機する遅延時"}],"snippet":[{"nm":"fadeoutbgm","txt":"fadeoutbgm time=${1:1000}"}],"detail":""},"dump_val":{"sum":"変数のダンプ  \\n変数の内容をデバッグ表示する","param":[],"snippet":[{"nm":"dump_val","txt":"dump_val"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[デバッグ機能](https://famibee.github.io/SKYNovel_gallery/?cur=debug)"},"save":{"sum":"しおりの保存  \\nしおりデータを保存する","param":[{"name":"place","required":"y","def":"","rangetype":"0〜","comment":"処理対象のしおり番号"}],"snippet":[{"nm":"save","txt":"save place=${1:処理対象のしおり番号}"}],"detail":"しおりデータを保存する。  \\n読み込み時に再開するスクリプトの位置は最後に[[record_place]](https://famibee.github.io/SKYNovel/tag.html#record_place)をコールした位置。  \\n\\n[[record_place]](https://famibee.github.io/SKYNovel/tag.html#record_place)がゲーム状態（レイヤ状態など）をバッファに退避し、  \\n[[save]](https://famibee.github.io/SKYNovel/tag.html#save)は指定しおりに書き出す機能。"},"link":{"sum":"ハイパーリンク  \\n指定した文字レイヤの表ページに、ハイパーリンクを作成する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ名"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"style","required":"","def":"\'background-color: rgba(255,0,0,0.5);\'","rangetype":"CSS style","comment":"リンク上にマウスカーソルが乗っていない状態のCSS スタイル"},{"name":"style_hover","required":"","def":"\'background-color: rgba(255,0,0,0.9);\'","rangetype":"CSS style","comment":"文字ボタン上にマウスカーソルが乗っている状態（クリックしていない）のCSS スタイル"},{"name":"style_clicked","required":"","def":"styleの値","rangetype":"CSS style","comment":"文字ボタン上にマウスカーソルが乗っている状態（クリックしている）のCSS スタイル"},{"name":"style_disable","required":"","def":"\'color: gray;\'","rangetype":"CSS style","comment":"enabled=false 状態のCSS スタイル"},{"name":"r_style","required":"","def":"styleの値","rangetype":"CSS style","comment":"リンク上にマウスカーソルが乗っていない状態のルビのCSS スタイル"},{"name":"r_style_hover","required":"","def":"style_hoverの値","rangetype":"CSS style","comment":"文字ボタン上にマウスカーソルが乗っている状態（クリックしていない）のルビのCSS スタイル"},{"name":"r_style_clicked","required":"","def":"r_styleの値","rangetype":"CSS style","comment":"文字ボタン上にマウスカーソルが乗っている状態（クリックしている）のルビのCSS スタイル"},{"name":"r_style_disable","required":"","def":"\'color: gray;\'","rangetype":"CSS style","comment":"enabled=false 状態のルビのCSS スタイル"},{"name":"ch_in_style","required":"","def":"なにもしない","rangetype":"文字出現演出名","comment":"[[ch_in_style]](https://famibee.github.io/SKYNovel/tag.html#ch_in_style)で定義した文字出現演出名"},{"name":"ch_out_style","required":"","def":"なにもしない","rangetype":"文字消去演出名","comment":"[[ch_out_style]](https://famibee.github.io/SKYNovel/tag.html#ch_out_style)で定義した文字消去演出名"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"},{"name":"enabled","required":"","def":"true","rangetype":"true、false","comment":"falseだと押せないボタンとなり、クリックイベントが発生しない。  \\nこれにより文字レイヤの任意の位置に画像表示できる機能を提供する。  \\n画像は三等分しない。イベントや効果音指定は無効だが、ヒント機能は有効"},{"name":"call","required":"","def":"false","rangetype":"true、false","comment":"trueの場合は[[call]](https://famibee.github.io/SKYNovel/tag.html#call)、falseは[[jump]](https://famibee.github.io/SKYNovel/tag.html#jump)。  \\nただしcall=trueによりサブルーチンコールした場合、[[return]](https://famibee.github.io/SKYNovel/tag.html#return)によって「コールする前のイベント予約状態＆待ち状態」に戻る"},{"name":"fn","required":"","def":"処理中のスクリプト","rangetype":"スクリプトファイル名","comment":"クリック時にジャンプする先"},{"name":"label","required":"","def":"スクリプトの先頭","rangetype":"ラベル名","comment":"コール先のスクリプトにあるラベル","":"クリック時ジャンプ先で「&sn.eventLabel」にて値を受け取れる"},{"name":"url","required":"y","def":"fn・label によるスクリプトジャンプ","rangetype":"ブラウザで開けるURL","comment":"クリック時にURLを開く。指定時は fn・label を無視する"},{"name":"global","required":"","def":"false","rangetype":"true、false","comment":"詳細は[[event]](https://famibee.github.io/SKYNovel/tag.html#event)と同様。  \\n※ボタンを[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)する場合はtrueにしておく"},{"name":"arg","required":"","def":"","rangetype":"ジャンプ先に渡したい値","comment":"指定した場合、クリック時ジャンプ先で「&sn.eventArg」にて値を受け取れる"},{"name":"onenter","required":"","def":"なにもしない","rangetype":"ラベル名","comment":"マウス重なり（フォーカス取得）時、指定したラベルをコールする。 必ず[[return]](https://famibee.github.io/SKYNovel/tag.html#return)で戻ること"},{"name":"onleave","required":"","def":"なにもしない","rangetype":"ラベル名","comment":"マウス重なり外れ（フォーカス外れ）時、指定したラベルをコールする。 必ず[[return]](https://famibee.github.io/SKYNovel/tag.html#return)で戻ること"},{"name":"clickse","required":"","def":"省略時は無音","rangetype":"音声ファイル名","comment":"指定すると、クリック時に効果音を再生する"},{"name":"enterse","required":"","def":"省略時は無音","rangetype":"音声ファイル名","comment":"指定すると、ボタン上にマウスカーソルが載った時に効果音を再生する"},{"name":"leavese","required":"","def":"省略時は無音","rangetype":"音声ファイル名","comment":"指定すると、ボタン上からマウスカーソルが外れた時に効果音を再生する"},{"name":"clicksebuf","required":"","def":"SYS","rangetype":"サウンドバッファ名","comment":"クリック時効果音を再生するサウンドバッファを指定する"},{"name":"entersebuf","required":"","def":"SYS","rangetype":"サウンドバッファ名","comment":"マウスオン時効果音を再生するサウンドバッファを指定する"},{"name":"leavesebuf","required":"","def":"SYS","rangetype":"サウンドバッファ名","comment":"マウスアウト時効果音を再生するサウンドバッファを指定する"},{"name":"hint","required":"","def":"表示しない","rangetype":"ヒント文字列","comment":"指定した場合のみ、マウスカーソルを載せるとツールチップス表示する"},{"name":"hint_style","required":"","def":"","rangetype":"CSS style","comment":"hintの CSSを指定できる"},{"name":"hint_opt","required":"","def":"","rangetype":"文字列","comment":"@popperjs/coreの動作を指定"}],"snippet":[{"nm":"link","txt":"link ${1{{ジャンプ先}}}][endlink"}],"detail":"[[link]](https://famibee.github.io/SKYNovel/tag.html#link)から[[endlink]](https://famibee.github.io/SKYNovel/tag.html#endlink)（ハイパーリンクの終了）までで囲った範囲をリンク区間と呼び、\\nその区間の文字や縦中横がハイパーリンクになる。（リンク区間は入れ子に出来ません）\\n※選択肢として使用する場合、ジャンプ先のラベル直後には必ず[[record_place]](https://famibee.github.io/SKYNovel/tag.html#record_place)を記述して、ジャンプ直後でセーブしても正しくセーブされるようにして下さい\\n\\n機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=ch_button)"},"s":{"sum":"停止する  \\nシナリオファイルの順次処理を停止する\\n[event]などでイベントが登録されていれば、イベント発生待ちを行う","param":[{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"s","txt":"s"}],"detail":""},"char2macro":{"sum":"一文字マクロの定義  \\n属性無しのマクロやタグを、半角文字の記述で代用できるよう定義する","param":[{"name":"char","required":"y","def":"","rangetype":"一文字","comment":"マクロにする半角文字。  \\nマクロに出来るのは英文字、空白、;、[、]、、=、&、｜、《、》以外のみ。  \\n正規表現で言えば　/[\\\\w\\\\s;[]=&｜《》]/　以外。  \\n括弧文字や定義済みの一文字マクロは使用できない"},{"name":"name","required":"y","def":"","rangetype":"定義済みのマクロ名","comment":"半角文字に割り当てるマクロ名を指定。  \\n組み込みタグか、[[macro]](https://famibee.github.io/SKYNovel/tag.html#macro)による定義済みマクロ名で無ければならない"}],"snippet":[{"nm":"char2macro","txt":"char2macro char=${1:マクロにする半角文字} name=${2{{マクロ名}}}"}],"detail":"本タグより前にロードされたスクリプトファイルには適用されません。\\nまたスクリプトファイルに本タグが記述された場合、本タグより前に出現した半角文字にも適用されません\\n\\n機能ギャラリーにサンプルがあります。$(play)[メッセージウインドウ](https://famibee.github.io/SKYNovel_gallery/?cur=txt_back)"},"clear_filter":{"sum":"フィルター全削除  \\nレイヤのフィルターを全削除する","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）"},{"name":"page","required":"","def":"fore","rangetype":"fore、back、both","comment":"ページの裏表（both指定で両面）"}],"snippet":[{"nm":"clear_filter","txt":"clear_filter layer=${1{{レイヤ名}}} page=${2|fore,back,both|}"}],"detail":""},"finish_trans":{"sum":"トランス強制終了  \\n[trans]で開始したトランスをすぐ終了させる","param":[],"snippet":[{"nm":"finish_trans","txt":"finish_trans"}],"detail":""},"playbgm":{"sum":"BGM の演奏  \\nBGMを再生する。[playse]とは違い、キー押下Skip中でも必ず再生を行なう。（canskip = false）","param":[{"name":"fn","required":"y","def":"","rangetype":"音声ファイル名","comment":"再生する音声ファイル名"},{"name":"loop","required":"","def":"true","rangetype":"true、false","comment":"trueでBGMのようにループ再生する"},{"name":"volume","required":"","def":"1.0","rangetype":"0.0〜1.0","comment":"再生音量。ただし音量を示すシステム変数（sys:const.an.sound.BGM.volume）は変更しない"},{"name":"speed","required":"","def":"1.0","rangetype":"0.0〜1.0","comment":"再生速度（0:遅い、1.0:元のまま）"},{"name":"pan","required":"0.0","def":"-1.0〜1.0","rangetype":"音を出す左右位置（-1.0=左端、0.0=中央(省略値)、1.0=右端）"},{"name":"join","required":"","def":"true","rangetype":"true、false","comment":"trueで読み込みを待って次のタグへ進む"},{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"trueでキー押下Skip中なら再生をしない"},{"name":"start_ms","required":"","def":"0（冒頭）","rangetype":"0〜；ミリ秒","comment":"再生の開始位置を指定する。0は冒頭"},{"name":"end_ms","required":"","def":"末端","rangetype":"0〜；ミリ秒","comment":"再生の終了位置を指定する。省略時は末端。  \\n正の値は「冒頭から何ms目を終端とするか」  \\n負の値は「末尾から何ms手前を終端とするか」の指定"},{"name":"ret_ms","required":"","def":"0（冒頭）","rangetype":"0〜；ミリ秒","comment":"ループ戻り位置を指定する。0は冒頭。  \\nループ再生中にend_ms指定位置（省略時は末尾）に到達した場合、この指定位置に戻る。 ループ再生しない（loop=false）際は無視される。"}],"snippet":[{"nm":"playbgm","txt":"playbgm fn=${1{{音声ファイル名}}}"}],"detail":""},"lay":{"sum":"レイヤ設定  \\nレイヤに各種設定を行う","param":[{"name":"layer","required":"y","def":"","rangetype":"レイヤ名","comment":"処理対象のレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"visible","required":"","def":"現在値","rangetype":"true、false","comment":"true：表示、false：非表示"},{"name":"alpha","required":"","def":"1.0","rangetype":"0.0〜1.0；透過度","comment":"レイヤの透過度。0（完全透明）〜0.5（半透明）〜1（不透明）"},{"name":"blendmode","required":"","def":"なにもしない","rangetype":"ブレンドモード名","comment":"このレイヤと下のレイヤとの重なりにおいて、ドット単位で色のブレンド演算を行なう"},{"name":"pos","required":"","def":"c","rangetype":"c・l・r・横座標","comment":"主に立ち絵に使う。横と縦座標を同時に設定する。横座標は指定した値（文字cの場合は画面中央、lは左寄り、rは右寄り）に設定し、画像下端を画面下端に接するように自動計算する"},{"name":"left","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン左端の画面左端からの距離"},{"name":"center","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン中央の画面左端からの距離"},{"name":"right","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン右端の画面左端からの距離"},{"name":"s_right","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン右端の画面右端からの距離"},{"name":"top","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン上端の画面上端からの距離"},{"name":"middle","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン中央の画面上端からの距離"},{"name":"bottom","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン下端の画面上端からの距離"},{"name":"s_bottom","required":"","def":"0","rangetype":"実数","comment":"レイヤやボタン下端の画面下端からの距離"},{"name":"rotation","required":"","def":"0","rangetype":"-180〜180；回転角度","comment":"時計回りは0～180、反時計回りは0～-180を指定。左上を中心に回る"},{"name":"scale_x","required":"","def":"1.0","rangetype":"実数","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転"},{"name":"scale_y","required":"","def":"1.0","rangetype":"実数","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転"},{"name":"float","required":"","def":"なにもしない","rangetype":"true、false","comment":"true：レイヤを最前面に移動する"},{"name":"index","required":"","def":"なにもしない","rangetype":"0〜","comment":"レイヤをindexで指定したインデックスに移動する。  \\n0がもっとも背後。レイヤを重ねるたびに1加算したindexになる"},{"name":"dive","required":"","def":"なにもしない","rangetype":"レイヤ名","comment":"レイヤをdiveで指定したレイヤのすぐ後ろに潜り込ませる。  \\n「plg:プラグイン名」と記述する事でプラグインも指定できる"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\n[[span]](https://famibee.github.io/SKYNovel/tag.html#span)[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)などで style を指定しない際のデフォルト値。  \\n「color: red;」「color: blue;」と個別指定時は、過去値を上書きする。  \\n空白文字を指定時は全てクリアする"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\n「color: red;」「color: blue;」と個別指定時は、過去値を上書きする。  \\n空白文字を指定時は全てクリアする"},{"name":"r_align","required":"","def":"現在値","rangetype":"left、center、right、justify、121、even、1ruby","comment":"ルビ揃えを指定する。  \\n> left ……（肩付き）先頭親文字から、ルビ間は密着  \\n> center ……（中付き）センター合わせ、〃  \\n> right ……（右／下揃え）末尾親文字から、〃  \\n> justify ……（両端揃え）先頭から末尾親文字間に、ルビ間は均等にあける  \\n> 121 ……（1-2-1(JIS)）ルビの前後を比率1、ルビ間を比率2であける  \\n> even ……（均等アキ）ルビの前後、ルビ間も均等にあける  \\n> 1ruby ……（1ルビ文字アキ）ルビの前後をルビ一文字空け、ルビ間は均等にあける  \\n  \\n初期値は center。  \\n  \\n※親文字よりルビの方が長い場合は、親文字に対する「中付き」表示になる  \\n→参考（[機能ギャラリー・直感的なルビ文法](https://famibee.github.io/SKYNovel_gallery/index.html?cur=built_in_ruby)）"},{"name":"ch_in_style","required":"","def":"なにもしない","rangetype":"文字出現演出名","comment":"[[ch_in_style]](https://famibee.github.io/SKYNovel/tag.html#ch_in_style)で定義した文字出現演出名"},{"name":"ch_out_style","required":"","def":"なにもしない","rangetype":"文字消去演出名","comment":"[[ch_out_style]](https://famibee.github.io/SKYNovel/tag.html#ch_out_style)で定義した文字消去演出名"},{"name":"fn","required":"y","def":"なにもしない","rangetype":"差分名称（カンマ区切りで複数可）","comment":"基本画像ファイルを指定する。複数指定時はこの属性一つで基本画像（先頭）と差分名称（二つめ以降）を指定できる"},{"name":"face","required":"","def":"なにもしない","rangetype":"差分名称（カンマ区切りで複数可）","comment":"差分名称または画像ファイル名を指定する。[fg fn=\\"a\\" face=\\"b,c,d\\"]なら「基本a」の上に「差分b」を重ね、「差分c」を重ね、「差分d」を重ねる"},{"name":"width","required":"","def":"なにもしない","rangetype":"1〜；横幅","comment":"style設定に上書きできる"},{"name":"height","required":"","def":"なにもしない","rangetype":"1〜；縦幅","comment":"style設定に上書きできる"},{"name":"pl","required":"","def":"なにもしない","rangetype":"実数","comment":"style設定（paddingLeft）に上書きできる"},{"name":"pr","required":"","def":"なにもしない","rangetype":"実数","comment":"style設定（paddingRight）に上書きできる"},{"name":"pt","required":"","def":"なにもしない","rangetype":"実数","comment":"style設定（paddingTop）に上書きできる"},{"name":"pb","required":"","def":"なにもしない","rangetype":"実数","comment":"style設定（paddingBottom）に上書きできる"},{"name":"noffs","required":"","def":"現在値","rangetype":"文字列","comment":"font-feature-settingsの対象としない文字を指定できる。複数指定可能。  \\nデフォルト値は指定なし。（ただしインライン画像やクリック待ち記号表示のため、全角空白は必ず指定に含まれる）"},{"name":"kinsoku_sol","required":"","def":"なにもしない","rangetype":"文字列","comment":"行頭禁則の禁則処理文字を変更できる。対象文字を列挙した文字列を指定。  \\nデフォルト値は以下の通り。  \\n、。，．）］｝〉」』】〕”〟ぁぃぅぇぉっゃゅょゎァィゥェォッャュョヮヵヶ！？!?‼⁉・ーゝゞヽヾ々"},{"name":"kinsoku_eol","required":"","def":"なにもしない","rangetype":"文字列","comment":"行末禁則の禁則処理文字を変更できる。対象文字を列挙した文字列を指定。  \\nデフォルト値は以下の通り。  \\n［（｛〈「『【〔“〝"},{"name":"kinsoku_dns","required":"","def":"なにもしない","rangetype":"文字列","comment":"分割禁止の禁則処理文字を変更できる。対象文字を列挙した文字列を指定。  \\nデフォルト値は以下の通り。  \\n─‥…"},{"name":"filter","required":"","def":"blur","rangetype":"フィルター名","comment":"レイヤに指定するフィルター名。その他必要な属性は適宜指定する。詳細は[[add_filter]](https://famibee.github.io/SKYNovel/tag.html#add_filter)参照。ただし[[add_filter]](https://famibee.github.io/SKYNovel/tag.html#add_filter)のような追加ではなく上書き"},{"name":"enable_filter","required":"true","def":"true、false","rangetype":"フィルターを有効にするか"}],"snippet":[{"nm":"lay","txt":"lay layer=${1{{レイヤ名}}} page=${2|fore,back|}"},{"nm":"lay（文字レイヤ）","txt":"lay layer=${1{{文字レイヤ名}}}"},{"nm":"lay（画像レイヤ）","txt":"lay layer=${1{{画像レイヤ名}}} fn=${2{{画像ファイル名}}} face=${3{{差分名称}}}"}],"detail":""},"stop_quake":{"sum":"画面揺らし中断  \\n画面揺らしを中断する","param":[],"snippet":[{"nm":"stop_quake","txt":"stop_quake"}],"detail":""},"event":{"sum":"イベントを予約  \\n次の[s]などのイベント待ちに向けてイベント処理を予約する","param":[{"name":"key","required":"y","def":"","rangetype":"イベント名","comment":"イベントを発生させるトリガーイベント  \\n修飾キーの同時押し（あるいは修飾キーを押しといて通常キー）を任意に組み合わせられます。「半角プラスで」「ABC順に」「イベントのキー名の前に」繋げて下さい。  \\n（例1）key=alt+enter  \\n（例2）key=alt+ctrl+shift+enter"},{"name":"call","required":"","def":"false","rangetype":"true、false","comment":"trueの場合は[[call]](https://famibee.github.io/SKYNovel/tag.html#call)、falseは[[jump]](https://famibee.github.io/SKYNovel/tag.html#jump)。  \\nただしcall=trueによりサブルーチンコールした場合、[[return]](https://famibee.github.io/SKYNovel/tag.html#return)によって「コールする前のイベント予約状態＆待ち状態」に戻る"},{"name":"fn","required":"y","def":"","rangetype":"ジャンプ先","comment":"イベント発生時にジャンプする先。指定方法は[[jump]](https://famibee.github.io/SKYNovel/tag.html#jump)と同様。  \\ncallの場合、ジャンプ先から[[return]](https://famibee.github.io/SKYNovel/tag.html#return)で戻ると、再度[[s]](https://famibee.github.io/SKYNovel/tag.html#s)などのイベント待ち状態に戻る"},{"name":"label","required":"y","def":"","rangetype":"ラベル名","comment":"イベント発生時にジャンプする先。指定方法は[[jump]](https://famibee.github.io/SKYNovel/tag.html#jump)と同様。  \\nクリック時ジャンプ先で「&sn.eventLabel」にて値を受け取れる"},{"name":"url","required":"y","def":"fn・label によるスクリプトジャンプ","rangetype":"URL","comment":"クリック時にURLを開く。指定時は fn・label を無視する"},{"name":"global","required":"","def":"false","rangetype":"true、false","comment":"trueを指定すると大域的なイベント扱いとなり、イベント発生時にイベント予約が削除されない"},{"name":"arg","required":"","def":"","rangetype":"ジャンプ先に渡したい値","comment":"指定した場合、クリック時ジャンプ先で「&sn.eventArg」にて値を受け取れる"},{"name":"del","required":"","def":"false","rangetype":"true、false","comment":"trueを指定すると予約済みイベントを削除する。  \\nfn/label/callとdelは同時指定できません"},{"name":"need_err","required":"","def":"true","rangetype":"true、false","comment":"HTML内にセレクタ（key属性）に対応する要素が見つからない場合にエラーを出すか"}],"snippet":[{"nm":"event","txt":"event key=${1{{イベント名}}} ${2{{ジャンプ先}}} global=${3|true,false|}"}],"detail":"あるイベントが発生した際、global=falseのイベント予約は全て削除される"},"trace":{"sum":"デバッグ表示へ出力  \\n属性をデバッグ表示する","param":[{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"デバッグ表示する値"}],"snippet":[{"nm":"trace","txt":"trace text=&${1{{代入変数名}}}"}],"detail":""},"clearsysvar":{"sum":"システム変数の全消去  \\nsys:変数を全消去。削除すると言うより、初期化する","param":[],"snippet":[{"nm":"clearsysvar","txt":"clearsysvar"}],"detail":""},"current":{"sum":"デフォルト文字レイヤ設定  \\nデフォルト文字レイヤを設定する","param":[{"name":"layer","required":"y","def":"","rangetype":"文字レイヤ名","comment":"デフォルトとするレイヤ"}],"snippet":[{"nm":"current","txt":"current layer=${1{{文字レイヤ名}}}"}],"detail":""},"ch_in_style":{"sum":"文字出現演出定義  \\n文字出現演出アニメを定義する","param":[{"name":"name","required":"y","def":"","rangetype":"文字出現演出名","comment":"文字出現演出を特定する名前"},{"name":"wait","required":"","def":"500","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"},{"name":"alpha","required":"","def":"0.0","rangetype":"0.0〜1.0；透過度","comment":"0（完全透明）〜0.5（半透明）〜1（不透明）"},{"name":"x","required":"","def":"\'=0\'","rangetype":"実数か相対位置指定","comment":"変化の初期値。以下のような相対位置指定が出来る  \\n500 ──　X位置を500に  \\n\'=500\' ──　文字表示位置を基準に+500加算した位置  \\n\'=-500\' ──　文字表示位置を基準に-500加算した位置"},{"name":"y","required":"","def":"\'=0\'","rangetype":"実数か相対位置指定","comment":""},{"name":"scale_x","required":"","def":"1.0","rangetype":"実数","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転"},{"name":"scale_y","required":"","def":"1.0","rangetype":"実数","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転"},{"name":"rotate","required":"","def":"0","rangetype":"-360〜360；回転角度","comment":"正の値は時計回り"},{"name":"join","required":"","def":"true","rangetype":"true、false","comment":"文字を順番に出すか（true）同時か（false）"},{"name":"ease","required":"","def":"\'ease-out\'","rangetype":"animation-timing-function","comment":"[CSSのanimation-timing-function プロパティ](https://developer.mozilla.org/ja/docs/Web/CSS/animation-timing-function)"}],"snippet":[{"nm":"ch_in_style","txt":"ch_in_style name=${1:文字出現演出名} wait=${2:500}"}],"detail":"[[lay]](https://famibee.github.io/SKYNovel/tag.html#lay)[[span]](https://famibee.github.io/SKYNovel/tag.html#span)などの ch_in_style属性で指定すると、定義どおりの文字出現演出アニメを行なう。\\n参考）[CSSのanimation-timing-function プロパティ](https://developer.mozilla.org/ja/docs/Web/CSS/animation-timing-function)\\n\\n機能ギャラリーにサンプルがあります。$(play)[文字出現演出](https://famibee.github.io/SKYNovel_gallery/?cur=ch_in_out)"},"let_length":{"sum":"文字列の長さ  \\n文字列の長さを求める","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"長さを求める文字列"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_length","txt":"let_length name=${1{{代入変数名}}} text=${2:長さを求める文字列}"}],"detail":"### コード例\\n~~~skynovel\\n&a=\'abcde\'\\n[let_length name=a text=&a]\\n[trace text=&a] ; -> 5\\n~~~"},"dump_stack":{"sum":"スタックのダンプ  \\n[call]等によるコールスタックの内容をデバッグ表示する","param":[],"snippet":[{"nm":"dump_stack","txt":"dump_stack"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[デバッグ機能](https://famibee.github.io/SKYNovel_gallery/?cur=debug)"},"page":{"sum":"ページ移動  \\nページ移動状態に入り、[p]停止位置を一つ移動する","param":[{"name":"clear","required":"いずれかを指定","def":"なにもしない","rangetype":"true、false","comment":"trueでページ状態記録をクリアする"},{"name":"to","required":"いずれかを指定","def":"なにもしない","rangetype":"oldest、prev、next、newest、exit、load","comment":"oldest：最古のページに移動  \\nprev：ひとつ前のページに戻る  \\nnext：ひとつ次のページに進める  \\nnewest：最新のページに移動  \\nexit：ページ移動状態から抜ける  \\nload：ページ移動状態で表示中ページからロードする"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ページ移動中の既読文字に適用する CSS スタイル。初期値は貴文字と黒縁取りCSS"},{"name":"key","required":"","def":"なにもしない","rangetype":"イベント名（カンマ区切りで複数可）","comment":"ページ移動状態中に有効にするグローバルイベントを限定できる。空白時は全て有効。"}],"snippet":[{"nm":"page","txt":"page to=${1|oldest,prev,next,newest,exit,load|}"}],"detail":"[[l]](https://famibee.github.io/SKYNovel/tag.html#l)[[p]](https://famibee.github.io/SKYNovel/tag.html#p)[[s]](https://famibee.github.io/SKYNovel/tag.html#s)などの停止位置を「ページ」とみなし、既読ページを戻ったり進んだりできる。\\nページを進めても一度読んだ位置を再現できる。\\nsave:sn.doRecLog が true の状態で[[l]](https://famibee.github.io/SKYNovel/tag.html#l)[[p]](https://famibee.github.io/SKYNovel/tag.html#p)[[s]](https://famibee.github.io/SKYNovel/tag.html#s)など。（[[wait]](https://famibee.github.io/SKYNovel/tag.html#wait)は対象外）で停止した際にそのページ状態の記録を行う。"},"jump":{"sum":"シナリオジャンプ  \\n指定位置のスクリプトにジャンプする","param":[{"name":"fn","required":"","def":"処理中のスクリプト","rangetype":"スクリプトファイル名","comment":"ジャンプ先のスクリプト"},{"name":"label","required":"","def":"スクリプトの先頭","rangetype":"ラベル名","comment":"ジャンプ先のスクリプトにあるラベル"},{"name":"count","required":"","def":"false","rangetype":"true、false","comment":"タグ位置を既読とするか"}],"snippet":[{"nm":"jump","txt":"jump ${1{{ジャンプ先}}}"}],"detail":"ラベルは例えば以下のように使います。\\n\\n### コード例\\n~~~skynovel\\n*aaa\\n無限ループ\\n[jump label=*aaa]\\n~~~\\n\\nさらにラベル名を考えるのが面倒なとき、「無名ラベル」ともいうべき機能が使えます。  \\n「**after」は「そのタグ以降で最初に見つかった**ラベルに」  \\n「**before」は「そのタグ以前で最初に見つかった**ラベルに」  \\nジャンプ・コールする、という指定です。次のように書きます。\\n\\n### コード例\\n~~~skynovel\\n[jump label=****after]\\n*** ; 最後のbeforeはここに戻る\\n**\\nも\\n[jump label=**after]\\n;**\\nっ\\n**\\n[l]\\nぷ\\n[jump label=**before]\\n**\\n＠[s]\\n**\\n****    ; 最初のafterはここへ\\nす\\n[jump label=***before]\\n~~~\\nこの例では「すもぷぷぷ……」と文字が表示されます。\\n「**」とか「***」とかアスタリスクは二個以上の任意の数が使え、同じ数同士が対応するラベルとなります。\\nが、上記例で見るとおりあんまり複雑に使うと可読性が下がってしまう気がしますので、局所的な用途に限ったほうが良さげです"},"enable_filter":{"sum":"フィルター個別切替  \\n個別にフィルター有効・無効を変更する","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）"},{"name":"page","required":"","def":"fore","rangetype":"fore、back、both","comment":"ページの裏表（both指定で両面）"},{"name":"index","required":"","def":"0","rangetype":"0〜","comment":"追加したフィルターの中で、有効・無効を変更するフィルターの番号。  \\n0が最初のフィルター。フィルターを重ねるたびに1加算したindexになる"},{"name":"enabled","required":"true","def":"true、false","rangetype":"フィルターを有効にするか"}],"snippet":[{"nm":"enable_filter","txt":"enable_filter layer=${1{{レイヤ名}}} page=${2|fore,back,both|} index=${3:フィルターの番号} enabled=${4|true,false|}"}],"detail":""},"copybookmark":{"sum":"しおりの複写  \\nしおりデータを複写する","param":[{"name":"from","required":"y","def":"","rangetype":"0〜","comment":"複写元のしおり番号"},{"name":"to","required":"y","def":"","rangetype":"0〜","comment":"複写先のしおり番号"}],"snippet":[{"nm":"copybookmark","txt":"copybookmark from=${1:複写元のしおり番号} to=${2:複写先のしおり番号}"}],"detail":""},"add_lay":{"sum":"レイヤを追加する  \\nレイヤはページの裏表があり、文字レイヤや画像レイヤなどの種類があります","param":[{"name":"layer","required":"y","def":"","rangetype":"未使用のレイヤ名","comment":"レイヤ名を指定する。未使用のレイヤ名でなければエラー＆アプリ停止"},{"name":"class","required":"y","def":"","rangetype":"grp、txt","comment":"レイヤの種類。grp（画像レイヤ）、txt（文字レイヤ）のレイヤ種別"}],"snippet":[{"nm":"add_lay","txt":"add_lay layer=${1:レイヤ名} class=${2|grp,txt|}"}],"detail":"### コード例\\n~~~skynovel\\n[add_lay layer=base class=grp]\\n[add_lay layer=0 class=grp]\\n[add_lay layer=mes class=txt]\\n~~~"},"ch_out_style":{"sum":"文字消去演出定義  \\n文字消去演出アニメを定義する","param":[{"name":"name","required":"y","def":"","rangetype":"文字消去演出名","comment":"文字消去演出を特定する名前"},{"name":"wait","required":"","def":"500","rangetype":"0〜；ミリ秒","comment":"一時的な文字消去速度。0で瞬時"},{"name":"alpha","required":"","def":"0.0","rangetype":"0.0〜1.0；透過度","comment":"0（完全透明）〜0.5（半透明）〜1（不透明）"},{"name":"x","required":"","def":"\'=0\'","rangetype":"実数か相対位置指定","comment":"変化の目標値。以下のような相対位置指定が出来る  \\n500 ──　X位置を500に  \\n\'=500\' ──　文字位置を基準に+500加算した位置  \\n\'=-500\' ──　文字位置を基準に-500加算した位置"},{"name":"y","required":"","def":"\'=0\'","rangetype":"実数か相対位置指定","comment":""},{"name":"scale_x","required":"","def":"1.0","rangetype":"実数","comment":"横方向を何倍に拡大／縮小するか。負の値ならレイヤを左右反転"},{"name":"scale_y","required":"","def":"1.0","rangetype":"実数","comment":"縦方向を何倍に拡大／縮小するか。負の値ならレイヤを上下反転"},{"name":"rotate","required":"","def":"0","rangetype":"-360〜360；回転角度","comment":"正の値は時計回り"},{"name":"join","required":"","def":"false","rangetype":"true、false","comment":"文字を順番に出すか（true）同時か（false）"},{"name":"ease","required":"","def":"\'ease-out\'","rangetype":"animation-timing-function","comment":"[CSSのanimation-timing-function プロパティ](https://developer.mozilla.org/ja/docs/Web/CSS/animation-timing-function)"}],"snippet":[{"nm":"ch_out_style","txt":"ch_out_style name=${1:文字消去演出名} wait=${2:500}"}],"detail":"[[lay]](https://famibee.github.io/SKYNovel/tag.html#lay)[[span]](https://famibee.github.io/SKYNovel/tag.html#span)などの ch_out_style属性で指定すると、定義どおりの文字消去演出アニメを行なう。  \\n文字消去演出は、次ページの文字出現演出と同時に行なわれる。文字消去演出を待ちたい場合は、[[wait]](https://famibee.github.io/SKYNovel/tag.html#wait)などで待つ。\\n参考）[CSSのanimation-timing-function プロパティ](https://developer.mozilla.org/ja/docs/Web/CSS/animation-timing-function)\\n\\n機能ギャラリーにサンプルがあります。$(play)[文字出現演出](https://famibee.github.io/SKYNovel_gallery/?cur=ch_in_out)"},"pause_tsy":{"sum":"一時停止  \\nレイヤーやフレームのトゥイーンアニメを一時停止させる","param":[{"name":"layer","required":"y","def":"","rangetype":"レイヤ名","comment":"処理対象のレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"処理対象のフレーム"}],"snippet":[{"nm":"pause_tsy","txt":"pause_tsy layer=${1{{レイヤ名}}}"}],"detail":"「layer（とpage）」を指定した場合はレイヤーの操作、  \\n「id」を指定した場合はフレームの操作を行なう\\n\\n機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=tag_tsy)"},"fadeoutse":{"sum":"効果音のフェードアウト  \\n効果音を無音に、段階的に変化させる","param":[{"name":"buf","required":"","def":"SE","rangetype":"サウンドバッファ名","comment":"効果音を識別する名前。サウンドバッファ名を変えれば同時に複数の音を操作することが出来ます"},{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"フェード時間"},{"name":"stop","required":"","def":"true","rangetype":"true、false","comment":"trueで「フェード終了時の再生停止」、falseなら行なわない"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"変化する前に待機する遅延時"}],"snippet":[{"nm":"fadeoutse","txt":"fadeoutse buf=${1{{サウンドバッファ}}} time=${2:1000}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[効果音とBGM](https://famibee.github.io/SKYNovel_gallery/?cur=sound)"},"wl":{"sum":"BGM 再生の終了待ち  \\nBGM 再生の終了を待つ。\\nloop=true（[playbgm]のデフォルト値）なら待たない。\\n利用時は【音声再生[playbgm]がjoin=true(ちなみにデフォルト)であること】を必須条件とします","param":[{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"wl","txt":"wl"}],"detail":""},"ch":{"sum":"文字を追加する  \\n文字レイヤに文字を出力する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"text","required":"y","def":"","rangetype":"表示したい文字列","comment":"ルビ文法（《》）も解析する。改行も [[r]](https://famibee.github.io/SKYNovel/tag.html#r) で出来る"},{"name":"record","required":"","def":"true","rangetype":"true、false","comment":"履歴に保存するか"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る  \\n※[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)でのみ、背景styleなどを一塊とする。【[span style=\'\']文字[[span]](https://famibee.github.io/SKYNovel/tag.html#span)】と動作が異なる"},{"name":"ch_in_style","required":"","def":"なにもしない","rangetype":"文字出現演出名","comment":"[[ch_in_style]](https://famibee.github.io/SKYNovel/tag.html#ch_in_style)で定義した文字出現演出名"},{"name":"ch_out_style","required":"","def":"なにもしない","rangetype":"文字消去演出名","comment":"[[ch_out_style]](https://famibee.github.io/SKYNovel/tag.html#ch_out_style)で定義した文字消去演出名"}],"snippet":[{"nm":"ch","txt":"ch layer=${1{{文字レイヤ名}}} page=${2|fore,back|} text=${3:表示したい文字列} ch_in_style=${4{{文字出現演出名}}} ch_out_style=${5{{文字消去演出名}}}"}],"detail":"[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)を使わない、より簡潔な記述文法があります。\\n以下の記述は、\\n[ch text=&test]\\n[ch text=test]\\n[ch text=\\"&a + b\\"]\\n\\n以下のようにも書けます。&から&までを[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)文と解釈します。\\n&test&\\n&\'test\'&\\n&a + b&\\n\\nでは「&（半角）」を表示するには？（これらの文法のせいで普通に書けない）\\n[ch text=\\"&\'&\'\\"]として下さい。\\n\\nまた、[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)でのみ、背景styleなどを一塊とする。\\n\\n例）以下は表示が異なる\\n[span style=\'background-image: linear-gradient(70deg, tomato 0%, lightskyblue 100%); border-radius: 8px;\']SPAN[[span]](https://famibee.github.io/SKYNovel/tag.html#span)\\n[ch text=\'CH\' style=\'background-image: linear-gradient(70deg, tomato 0%, lightskyblue 100%); border-radius: 8px;\']"},"let_round":{"sum":"四捨五入  \\n四捨五入する","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"実数","comment":"四捨五入する数"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_round","txt":"let_round name=${1{{代入変数名}}} text=${2:四捨五入する数}"}],"detail":"### コード例\\n~~~skynovel\\n[let_round name=a text=3.45]\\n[trace text=&a] ; <- 3\\n~~~"},"clear_event":{"sum":"イベントを全消去  \\nイベント予約を全て削除する","param":[{"name":"global","required":"","def":"false","rangetype":"true、false","comment":"trueを指定すると全ての大域イベントを削除する。  \\nfalseの場合は大域以外の全てのイベントを削除する"}],"snippet":[{"nm":"clear_event","txt":"clear_event global=${1|false,true|}"}],"detail":""},"export":{"sum":"プレイデータをエクスポート  \\nプレイデータをファイルとしてエクスポートする\\n\\n保存ダイアログが表示され、選択したフォルダにプレイデータファイルが保存される。\\nプレイデータ拡張子、ウェブ版は.swpd、アプリ版は.spdで互換性はない。\\n暗号化するプロジェクトの場合、出力するプレイデータファイルも暗号化される。\\nブラウザならファイルをダウンロードする。\\n\\nエクスポート完了時には【sn:exported】というイベントを発火する。\\n【[event key=\'sn:exported\' 〜]】という記述でジャンプできる。\\n\\n機能ギャラリーにサンプルがあります。$(play)[プレイデータ](https://famibee.github.io/SKYNovel_gallery/?cur=import)","param":[],"snippet":[{"nm":"export","txt":"export"}],"detail":""},"wt":{"sum":"トランス終了待ち  \\n[trans]で開始したトランスの終了を待つ","param":[{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"trueでクリックキャンセル可能にする"},{"name":"global","required":"","def":"true","rangetype":"true、false","comment":"グローバルイベント待ちを有効にするか"}],"snippet":[{"nm":"wt","txt":"wt canskip=${1|true,false|}"}],"detail":"終了次第、スクリプト処理を次へ進める。\\n\\n$(warning)また[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)～[[wt]](https://famibee.github.io/SKYNovel/tag.html#wt)間で文字表示や[[ch]](https://famibee.github.io/SKYNovel/tag.html#ch)は動作未定義、非推奨。\\n[[trans]](https://famibee.github.io/SKYNovel/tag.html#trans)終了を待たず何かをするのは避けた方がよいでしょう。"},"record_place":{"sum":"セーブポイント指定  \\n本タグの位置を、スクリプト読み込み時に再開する位置として設定する","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）","comment":"保存対象レイヤ名。しおりに状態を保存するレイヤ。Save/Load画面レイヤや設定画面レイヤなど、保存すべきでないレイヤを除いて指定すべき"},{"name":"reset_sound","required":"","def":"true","rangetype":"true、false","comment":"全てのサウンドを停止・再度再生開始するか"}],"snippet":[{"nm":"record_place","txt":"record_place"}],"detail":""},"waitclick":{"sum":"クリックを待つ  \\nシナリオファイルの順次処理を停止し、クリックやキー押下を待つ","param":[],"snippet":[{"nm":"waitclick","txt":"waitclick"}],"detail":""},"let_frame":{"sum":"フレーム変数を取得  \\nフレーム内の変数から、値を取得する","param":[{"name":"id","required":"y","def":"","rangetype":"フレーム名","comment":"[[add_fram]](https://famibee.github.io/SKYNovel/tag.html#add_fram)で定義したフレーム名"},{"name":"var_name","required":"y","def":"","rangetype":"文字列","comment":"フレーム内の変数/関数名"}],"snippet":[{"nm":"let_frame","txt":"let_frame id=${1{{フレーム名}}} var_name=${2:フレーム内の変数/関数名}"}],"detail":"関数名を指定した場合は関数を実行し、その戻り値を取得する。  \\n【const.sn.frm.（id名）.（var_name名）】に値がセットされる。\\n\\n### コード例\\n~~~skynovel\\n[add_frame id=config src=_config visible=false]\\n[event key=\'dom=config:#close\' label=*exit global=true]\\n\\n[let_frame id=config var_name=val_sldBackAlpha]\\n&sys:TextLayer.Back.Alpha = const.sn.frm.config.val_sldBackAlpha/100\\n[return]\\n\\n*val2ctrl\\n[set_frame id=config var_name=val_sldBackAlpha text=&sys:TextLayer.Back.Alpha*100]\\n[let_frame id=config var_name=val2ctrl function=true]\\n[return]\\n~~~\\n\\n機能ギャラリーにサンプルがあります。$(play)[HTMLフレーム](https://famibee.github.io/SKYNovel_gallery/?cur=frame)"},"add_filter":{"sum":"フィルター追加  \\nレイヤにフィルターを追加する","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）"},{"name":"page","required":"","def":"fore","rangetype":"fore、back、both","comment":"ページの裏表（both指定で両面）"},{"name":"filter","required":"y","def":"","rangetype":"フィルター名","comment":"レイヤに指定するフィルタ。その他必要な属性は適宜指定する"},{"name":"enabled","required":"","def":"true","rangetype":"true、false","comment":"イベントを有効にするか"}],"snippet":[{"nm":"add_filter","txt":"add_filter layer=${1{{レイヤ名}}} page=${2|fore,back,both|} filter=${3{{フィルター名}}}"}],"detail":""},"autowc":{"sum":"文字ごとのウェイト  \\n特定の文字の直後に自動的にウェイトを入れる。\\ntextに指定した文字に対し、timeに指定した数値が対応する。\\n通常の文字表示速度にtimeの数値を掛け算する","param":[{"name":"enabled","required":"","def":"現在値","rangetype":"true、false","comment":"自動ウェイトを有効にするか。初期値false"},{"name":"text","required":"両方同時に指定、或いは省略","def":"現在値","rangetype":"一文字（カンマ区切りで複数可）","comment":"ウェイトを指定する文字の集まり"},{"name":"time","required":"両方同時に指定、或いは省略","def":"現在値","rangetype":"0〜（カンマ区切りで複数可）","comment":"文字表示ウェイト倍数"}],"snippet":[{"nm":"autowc","txt":"autowc enabled=${1|true,false|} text=${2:\'、。\'} time=${3:\'50,100\'}"}],"detail":"以下のように指定する。\\n\\n### コード例\\n~~~skynovel\\n[autowc enabled=true text=\\"４５６\\" time=\\"50,100,150\\"]\\n[autowc enabled=true text=\\"４５６\\" time=\\"100,100,100\\"]\\n[autowc enabled=false]\\n~~~\\n\\n　以下はエラーとなる。\\n### コード例\\n~~~skynovel\\n;x [autowc enabled=true text=\\"４５６\\" time=\\"100,100\\"]\\n;x [autowc enabled=true text=\\"４５６\\" time=\\"100,100,100,100\\"]\\n;x [autowc enabled=true text=\\"４５６\\"]\\n;x [autowc enabled=true time=\\"100,100,100\\"]\\n;x [autowc enabled=true]\\n;x [autowc enabled=true text=\\"\\" time=\\"\\"]\\n;x [autowc text=\\"\\" time=\\"\\"]\\n~~~"},"wait":{"sum":"ウェイトを入れる  \\n指定時間スクリプト処理を待ち、再開する\\n[event]などでイベントが登録されていても、イベント発生待ちを行わない","param":[{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"処理を待つ時間"},{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"クリックなど（→詳細は[[waitclick]](https://famibee.github.io/SKYNovel/tag.html#waitclick)）でウエイトをキャンセルできるか"}],"snippet":[{"nm":"wait","txt":"wait time=${1:処理を待つ時間}"}],"detail":""},"let_substr":{"sum":"文字列から抜きだし  \\n文字列の一部を取り出す","param":[{"name":"name","required":"y","def":"","rangetype":"代入変数名","comment":"代入する変数"},{"name":"text","required":"y","def":"","rangetype":"文字列","comment":"元になる文字列"},{"name":"pos","required":"","def":"0","rangetype":"整数","comment":"何番目の文字から取り出すか。負の値なら「後ろから何個目か」。0（先頭）が先頭、-1が最後の文字。【pos=-3 len=all】とすると、後ろから３文字を取り出す"},{"name":"len","required":"","def":"1","rangetype":"文字数またはall","comment":"何文字取り出すか。all でpos以降の全て"},{"name":"cast","required":"","def":"出来るだけ数値変換","rangetype":"num、int、uint、bool、str","comment":"値をセットする際の型。（詳細は[[let]](https://famibee.github.io/SKYNovel/tag.html#let)を参照）"}],"snippet":[{"nm":"let_substr","txt":"let_substr name=${1{{代入変数名}}} text=${2:元になる文字列} pos=${3:取り出す位置} len=${4:文字数またはall}"}],"detail":"### コード例\\n~~~skynovel\\n&a=\'abcde\'\\n[let_substr name=a text=&a pos=2 len=3]\\n[trace text=&a] ; -> \'cde\'\\n[let_substr name=a text=&a pos=1 len=all]\\n[trace text=&a] ; -> \'de\'\\n~~~"},"quake":{"sum":"画面を揺らす  \\n画面全体を揺らす","param":[{"name":"time","required":"y","def":"","rangetype":"0〜；ミリ秒","comment":"揺らす時間"},{"name":"hmax","required":"","def":"10","rangetype":"0〜","comment":"横方向の最大揺らし幅。幅はランダム値を取る"},{"name":"vmax","required":"","def":"10","rangetype":"0〜","comment":"縦方向の最大揺らし幅。幅はランダム値を取る"},{"name":"delay","required":"","def":"0","rangetype":"0〜；ミリ秒","comment":"トゥイーンを始める前の、何もしない待ち時間- "},{"name":"repeat","required":"","def":"1","rangetype":"0〜；繰返し回数","comment":"0か負の値 で無限ループ。1を設定すると「繰り返しなし」、2を設定すると「二回同じ動き」を行なう"},{"name":"ease","required":"","def":"Linear.None","rangetype":"イージング名","comment":"揺れのイージング（値の変化の仕方）を指定する。[イージングの変化はこちらの図](https://createjs.com/demos/tweenjs/tween_sparktable)（または[こちら](https://sole.github.io/tween.js/examples/03_graphs.html)）が分かりやすい。指定できる値は[[tsy]](https://famibee.github.io/SKYNovel/tag.html#tsy)を参照"},{"name":"yoyo","required":"","def":"false","rangetype":"true、false","comment":"（暫定）ヨーヨーのように逆方向に戻って繰り返す"}],"snippet":[{"nm":"quake","txt":"quake time=${1:500} hmax=${2:10} vmax=${3:10}][wq"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[文字出現演出](https://famibee.github.io/SKYNovel_gallery/?cur=tag_quake)"},"loadplugin":{"sum":"プラグインの読み込み  \\nプラグインとして読み込む","param":[{"name":"fn","required":"y","def":"","rangetype":"CSSファイルURL","comment":"読み込むプラグインのファイル名（拡張子はcssのみ、Webフォント用）"},{"name":"join","required":"","def":"true","rangetype":"true、false","comment":"trueで読み込みを待って次のタグへ進む"}],"snippet":[{"nm":"loadplugin","txt":"loadplugin fn=${1:WebフォントのCSSファイルURL} join=${2|true,false|}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[フォント利用](https://famibee.github.io/SKYNovel_gallery/?cur=font)"},"graph":{"sum":"インライン画像表示  \\n文字レイヤに画像を文字として表示する。ルビは同時に設定する","param":[{"name":"layer","required":"","def":"デフォルト文字レイヤ","rangetype":"文字レイヤ名","comment":"文字を表示するレイヤ"},{"name":"page","required":"","def":"fore","rangetype":"fore、back","comment":"ページの裏表"},{"name":"pic","required":"y","def":"","rangetype":"画像ファイル名","comment":"表示する画像やアニメpng"},{"name":"r","required":"","def":"ルビ無し","rangetype":"ルビ文字列","comment":"ただしあまりに他の文字サイズと大きく異なる場合は正しい位置に表示されない"},{"name":"width","required":"","def":"画像の横サイズ（※）","rangetype":"1〜；横幅","comment":"表示する画像の横ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"height","required":"","def":"画像の縦サイズ（※）","rangetype":"1〜；縦幅","comment":"保存する画像の縦ドットサイズ。  \\n元のサイズと異なる場合は拡大・縮小される"},{"name":"wait","required":"","def":"現在の文字表示速度","rangetype":"0〜；ミリ秒","comment":"一時的な文字表示速度。0で瞬時"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\nこのタグによる表示のみに適用、以降は元に戻る"}],"snippet":[{"nm":"graph","txt":"graph pic=${1{{画像ファイル名}}}"}],"detail":"フォントにない外字やアニメpng画像表示に使える。\\n※省略時は画像サイズになるが、ロード完了直後に文字配置を決めるのでちらつく。それを嫌う際に指定する\\n※特にモバイルなどでゲーム画面が自動で拡大縮小される場合、省略したらその時の本文文字サイズとして扱われる。なるべくサイズ指定を推奨。"},"wq":{"sum":"画面揺らし終了待ち  \\n画面揺らしの終了を待ち、再開する。\\n[event]などでイベントが登録されていても、イベント発生待ちを行わない","param":[{"name":"canskip","required":"","def":"true","rangetype":"true、false","comment":"trueでクリックキャンセル可能にする"}],"snippet":[{"nm":"wq","txt":"wq canskip=${1|true,false|}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[文字出現演出](https://famibee.github.io/SKYNovel_gallery/?cur=tag_quake)"},"bracket2macro":{"sum":"括弧マクロの定義  \\n属性textを持つマクロやタグを、任意の二つの文字を括弧とし、括弧で囲った記述で代用できるよう","param":[{"name":"text","required":"y","def":"","rangetype":"括弧にする始点終点の二文字","comment":"マクロに出来るのは英文字、空白、;、[、]、、=、&、｜、《、》以外のみ。  \\n正規表現で言えば　/[\\\\w\\\\s;[]=&｜《》]/　以外。  \\n一文字マクロや定義済みの括弧文字は使用できない"},{"name":"name","required":"y","def":"","rangetype":"マクロ名","comment":"半角文字に割り当てるマクロ名を指定。  \\n組み込みタグか、[[macro]](https://famibee.github.io/SKYNovel/tag.html#macro)による定義済みマクロ名で無ければならない。  \\n組み込みタグやマクロは属性textだけを指定しても問題なく動作し、 それを処理すること。渡される属性textは空文字の場合もある"}],"snippet":[{"nm":"bracket2macro","txt":"bracket2macro text=${1:【】} name=${2{{マクロ名}}}"}],"detail":"※適用範囲について\\n本タグより前にロードされたスクリプトファイルには適用されません。\\nまたスクリプトファイルに本タグが記述された場合、本タグより前に出現した半角文字にも適用されません\\n\\n機能ギャラリーにサンプルがあります。$(play)[履歴と機能追加](https://famibee.github.io/SKYNovel_gallery/?cur=log_and_play)"},"rec_ch":{"sum":"履歴書き込み  \\n履歴に文字や付加情報を出力する","param":[{"name":"text","required":"","def":"現在値","rangetype":"表示したい文字列","comment":"ルビ文法（《》）も使用可能、[[r]](https://famibee.github.io/SKYNovel/tag.html#r)で改行"},{"name":"style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"文字の CSS Style を指定する。  \\nこのタグによる履歴表示のみに適用、以降は元に戻る"},{"name":"r_style","required":"","def":"なにもしない","rangetype":"CSS style","comment":"ルビの CSS Style を指定する。  \\nこのタグによる履歴表示のみに適用、以降は元に戻る  \\n※背景styleなどを一塊とする。"}],"snippet":[{"nm":"rec_ch","txt":"rec_ch text=${1:表示したい文字列}"}],"detail":"「現在のページ」のテキストに文字を追加する。\\n「現在のページ」に対する、任意の属性も自由に追加できる。その属性はconst.sn.log.jsonにも含まれ、フレームに渡しJavaScriptなどで（JSON.parse()して）利用できる。\\n文字列内では[[r]](https://famibee.github.io/SKYNovel/tag.html#r)で改行できる"},"dump_lay":{"sum":"レイヤのダンプ  \\nレイヤの内容をデバッグ表示する","param":[{"name":"layer","required":"","def":"全てのレイヤ","rangetype":"レイヤ名（カンマ区切りで複数可）","comment":"デバッグ表示するレイヤ名"}],"snippet":[{"nm":"dump_lay","txt":"dump_lay layer=${1{{レイヤ名}}}"}],"detail":"機能ギャラリーにサンプルがあります。$(play)[デバッグ機能](https://famibee.github.io/SKYNovel_gallery/?cur=debug)"}}');var We=n(2339);const Oe=[];function Be(e,t){switch(e.scheme){case"ws-file":u.workspace.openTextDocument(t+e.path).then((e=>u.window.showTextDocument(e)));break;case"ws-folder":u.env.openExternal(u.Uri.file(t+e.path));break;default:u.env.openExternal(e)}}const Me="SKYNovel Task";class Je{ctx;actBar;#Nn=[];#jn=new Map;#Ln;constructor(e,t){this.ctx=e,this.actBar=t;const n=this.#Wn("init");n.text="初期化中...",n.busy=!0,n.detail="refresh";const i=e.asAbsolutePath("dist/LangSrv.js"),r={run:{module:i,transport:We.TransportKind.ipc},debug:{module:i,transport:We.TransportKind.ipc,options:{execArgv:["--nolazy","--inspect="+String(7e3+Math.round(999*Math.random()))]}}},o={documentSelector:[a.hF],synchronize:{fileEvents:[u.workspace.createFileSystemWatcher("**/doc/prj/path.json")]}};this.#Ln=new We.LanguageClient("SKYNovelLangSrv","SKYNovel Language Server",r,o),e.subscriptions.push(u.languages.registerHoverProvider(a.hF,this),u.window.registerTreeDataProvider("skynovel-ws",this),{dispose:()=>this.#Ln.stop()},this.#Ln.onRequest(a.Xp,(e=>{switch(e.cmd){case"log":case"error":return void console.error(e.txt)}this.onRequest(e)})),u.workspace.onDidChangeWorkspaceFolders((e=>this.#On(e))));const c=Me.length;u.tasks.onDidEndTaskProcess((e=>this.#Bn.get(e.execution.task.definition.type.slice(c))?.(e))),n.detail="initDebug";const l=new u.EventEmitter;!function(e,t){const n=a.hF.language||"";u.debug.registerDebugConfigurationProvider(n,{provideDebugConfigurations:e=>[{name:"10.ブラウザ版",request:"launch",type:"pwa-node",runtimeExecutable:"npm",runtimeArgs:["run-script","watch:wdsdbg"],skipFiles:["<node_internals>/**"],console:"internalConsole",internalConsoleOptions:"openOnSessionStart"},{name:"1.アプリ版",request:"launch",type:"node",port:3776,console:"internalConsole",internalConsoleOptions:"openOnSessionStart"},{name:"2.デバッガ",request:"attach",type:"skynovel",port:3776,weburi:"http://localhost:8080",stopOnEntry:!1}]}),e.subscriptions.push(u.debug.registerDebugConfigurationProvider("node",{resolveDebugConfiguration(e,t){const n="${workspaceFolder}/node_modules/.bin/electron";return{program:"${workspaceFolder}/doc/app.js",runtimeExecutable:n,windows:{runtimeExecutable:n+".cmd"},console:"integratedTerminal",autoAttachChildProcesses:!0,skipFiles:["<node_internals>/**/*.js"],...t,env:{SKYNOVEL_DBG:"on",SKYNOVEL_PORT:t.port??3776,...t.env}}}})),e.subscriptions.push(u.debug.registerDebugConfigurationProvider(n,{resolveDebugConfiguration:(e,t)=>({cwd:"${workspaceFolder}",port:3776,weburi:"http://localhost:8080",...t})}));const s={createDebugAdapterDescriptor:e=>{if(e.workspaceFolder)return De??=new u.DebugAdapterInlineImplementation(new He(e.workspaceFolder,t))}};e.subscriptions.push(u.debug.registerDebugAdapterDescriptorFactory(n,s))}(e,(e=>{switch(e.タグ名){case":connect":this.#Mn=[];break;case":disconnect":this.#Mn=[],l.fire(void 0);break;case"add_lay":{const t=new u.TreeItem(e.layer??"");"txt"===e.class?(t.iconPath=(0,s.Vt)("comment"),t.tooltip=`文字レイヤ layer=${e.layer??""}`,t.collapsibleState=u.TreeItemCollapsibleState.Expanded):(t.iconPath=(0,s.Vt)("base"===e.layer?"image":"user"),t.tooltip=`画像レイヤ layer=${e.layer??""}`),t.command={command:"skynovel.tiLayers.selectNode",title:"Select Node",arguments:[e.layer]},this.#Mn.push(t),l.fire(void 0)}}})),e.subscriptions.push(u.commands.registerCommand("skynovel.tiLayers.selectNode",(e=>Ee.send2SN("_selectNode",{node:e})))),n.detail="layers",e.subscriptions.push(u.window.registerTreeDataProvider("skynovel-layers",{getChildren:e=>{if(!e)return this.#Mn;const t=e.iconPath;return t?("string"==typeof t||t instanceof u.ThemeIcon||t instanceof u.Uri||t.dark.path.endsWith("comment.svg")?[{label:"ボタン",icon:"hand-point-down"}]:[]).map((t=>Object.assign(new u.TreeItem(t.label),{iconPath:(0,s.Vt)(t.icon),command:{command:"skynovel.tiLayers.selectNode",title:"Select Node",arguments:[e.label+"/"+t.label]}}))):this.#Mn},getTreeItem:e=>e,onDidChangeTreeData:l.event})),e.subscriptions.push(u.languages.registerDocumentDropEditProvider(a.hF,this)),je.init(e),this.#Jn("init");for(const[e,{sum:t}]of Object.entries(Le))Oe.push({label:e,description:t,uri:u.Uri.parse("https://famibee.github.io/SKYNovel/tag.html#"+e)})}#Mn=[];async provideDocumentDropEdits(e,t,n,a){const s=n.get("text/uri-list");if(!s)return null;const i=await s.asString();if(a.isCancellationRequested)return null;const r=[];for(const e of i.split("\n"))try{r.push(u.Uri.parse(e))}catch{}if(0===r.length)return null;for(const[n,a]of this.#jn.entries())if(e.uri.path.startsWith(n+"/doc/prj/"))return await a.drop(e,t,r)??{insertText:""};return null}provideHover(e,t){for(const[n,a]of this.#jn.entries())if(e.uri.path.startsWith(n+"/doc/prj/"))return a.provideHover(e,t);return null}async start(){await this.#Ln.start(),this.#Yn=(e,t)=>this.#Ln.sendRequest(a.Xp,{...t,pathWs:(0,a.px)(e.path)}),this.ctx.subscriptions.push(u.commands.registerCommand("skynovel.openReferencePallet",(()=>this.#Kn())),u.commands.registerCommand("skynovel.opView",(e=>{const{path:t}=e;for(const[n,a]of this.#jn.entries())t.startsWith(n)&&a.opView(e)}))),a.Hd?b("&&"):a.Ex&&b(String(u.workspace.getConfiguration("terminal.integrated.shell").get("windows")).endsWith("cmd.exe")?"&":";"),this.#On()}#Yn=async()=>{};#Kn(){const e=u.workspace.workspaceFolders,t=u.window.activeTextEditor;if(!e||!t)return void u.window.showQuickPick(Oe,{placeHolder:"どのリファレンスを開きますか?",matchOnDescription:!0}).then((e=>{e?.uri&&Be(e.uri,"")}));const n=t.document.uri.path;for(const[e,t]of this.#jn.entries())n.startsWith(e)&&t.openReferencePallet()}get aLocalSNVer(){return this.#jn.values().map((e=>e.getLocalSNVer())).toArray()}#In={};#Wn(e){return this.#In[e]=u.languages.createLanguageStatusItem(e,a.hF)}#Jn(e){this.#In[e]?.dispose(),delete this.#In[e]}#On(e){const t=u.workspace.workspaceFolders;if(t){if(!e){for(const e of t)this.#Gn(e);if(0===this.#Nn.length)return;return this.#Nn[0].collapsibleState=u.TreeItemCollapsibleState.Expanded,void this.#Un.fire(void 0)}if(e.added.length>0)this.#Gn(t.slice(-1)[0]);else{const t=e.removed[0],n=t.name,a=this.#Nn.findIndex((e=>e.label===n));this.#Nn.splice(a,1),this.#jn.get(t.uri.path)?.dispose()}this.#Un.fire(void 0)}}#Un=new u.EventEmitter;onDidChangeTreeData=this.#Un.event;onRequest(e){const t=this.#jn.get((a.Ex?"/c:":"")+e.pathWs);t?t.onRequest(e):console.error(`fn:WorkSpaces.ts onRequest 'project ${e.pathWs} does not exist'`)}enableBtn(e){for(const t of this.#jn.values())t.enableBtn(e)}#Gn(e){const t=e.uri.path,n=(0,a.DH)(t);(0,f.existsSync)(n+"/package.json")&&(0,f.existsSync)(n+"/doc/prj/prj.json")&&this.#jn.set(t,new qe(this.ctx,this.actBar,e,this.#Nn,this.#Un,this.#Bn,(t=>this.#Yn(e.uri,t))))}#Bn=new Map([]);getTreeItem=e=>e;getChildren=e=>e?e.children:this.#Nn;dispose(){for(const e of this.#jn.values())e.dispose();this.#jn.clear();for(const[e,t]of Object.entries(this.#In))Object.prototype.hasOwnProperty.call(this.#In,e)&&t.dispose()}}},57422:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=57422,e.exports=t},63595:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=63595,e.exports=t},93655:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=93655,e.exports=t}};
//# sourceMappingURL=993.extension.js.map