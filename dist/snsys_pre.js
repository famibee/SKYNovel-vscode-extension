var U=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function C(e){return typeof e=="string"&&U.test(e)}var B=C;function L(e){if(!B(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,t&255,(t=parseInt(e.slice(9,13),16))>>>8,t&255,(t=parseInt(e.slice(14,18),16))>>>8,t&255,(t=parseInt(e.slice(19,23),16))>>>8,t&255,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255)}var m=L;var c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function I(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}function R(e){e=unescape(encodeURIComponent(e));let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}var S="6ba7b810-9dad-11d1-80b4-00c04fd430c8",P="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function g(e,t,r,o,l,s){let u=typeof r=="string"?R(r):r,a=typeof o=="string"?m(o):o;if(typeof o=="string"&&(o=m(o)),o?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let n=new Uint8Array(16+u.length);if(n.set(a),n.set(u,a.length),n=t(n),n[6]=n[6]&15|e,n[8]=n[8]&63|128,l){s=s||0;for(let i=0;i<16;++i)l[s+i]=n[i];return l}return I(n)}function K(e,t,r,o){switch(e){case 0:return t&r^~t&o;case 1:return t^r^o;case 2:return t&r^t&o^r&o;case 3:return t^r^o}}function w(e,t){return e<<t|e>>>32-t}function M(e){let t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520],o=new Uint8Array(e.length+1);o.set(e),o[e.length]=128,e=o;let l=e.length/4+2,s=Math.ceil(l/16),u=new Array(s);for(let a=0;a<s;++a){let n=new Uint32Array(16);for(let i=0;i<16;++i)n[i]=e[a*64+i*4]<<24|e[a*64+i*4+1]<<16|e[a*64+i*4+2]<<8|e[a*64+i*4+3];u[a]=n}u[s-1][14]=(e.length-1)*8/Math.pow(2,32),u[s-1][14]=Math.floor(u[s-1][14]),u[s-1][15]=(e.length-1)*8&4294967295;for(let a=0;a<s;++a){let n=new Uint32Array(80);for(let f=0;f<16;++f)n[f]=u[a][f];for(let f=16;f<80;++f)n[f]=w(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);let i=r[0],d=r[1],p=r[2],x=r[3],y=r[4];for(let f=0;f<80;++f){let v=Math.floor(f/20),E=w(i,5)+K(v,d,p,x)+y+t[v]+n[f]>>>0;y=x,x=p,p=w(d,30)>>>0,d=i,i=E}r[0]=r[0]+i>>>0,r[1]=r[1]+d>>>0,r[2]=r[2]+p>>>0,r[3]=r[3]+x>>>0,r[4]=r[4]+y>>>0}return Uint8Array.of(r[0]>>24,r[0]>>16,r[0]>>8,r[0],r[1]>>24,r[1]>>16,r[1]>>8,r[1],r[2]>>24,r[2]>>16,r[2]>>8,r[2],r[3]>>24,r[3]>>16,r[3]>>8,r[3],r[4]>>24,r[4]>>16,r[4]>>8,r[4])}var D=M;function A(e,t,r,o){return g(80,D,e,t,r,o)}A.DNS=S;A.URL=P;var b=A;function T(e){return new Uint8Array((e.match(/../g)??[]).map(t=>parseInt(t,16))).buffer}function N(e){return btoa(new Uint8Array(e).reduce((t,r)=>t+String.fromCharCode(r),""))}function H(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))}var h=class{constructor(t,r){this.hPass=t;this.subtle=r;this.#r=JSON.stringify(this.hPass),this.#t={name:"AES-GCM",iv:T(t.iv)}}#r;#t;get strHPass(){return this.#r}#n(t){return this.subtle.digest("SHA-512",new TextEncoder().encode(t))}uuidv5(t){return b(t,this.hPass.pass)}async init(){let t=await this.subtle.importKey("raw",await this.#n(this.hPass.pass),"PBKDF2",!1,["deriveKey"]);this.#e=await this.subtle.deriveKey({name:"PBKDF2",hash:"SHA-512",iterations:this.hPass.ite,salt:T(this.hPass.salt)},t,{name:this.#t.name,length:256},!1,["encrypt","decrypt"])}#e;async encAb(t){return await this.subtle.encrypt(this.#t,this.#e,t)}async enc(t){return N(await this.encAb(new TextEncoder().encode(t)))}async decAb(t){return await this.subtle.decrypt(this.#t,this.#e,t)}async dec(t){return new TextDecoder().decode(await this.decAb(H(t)))}};var{subtle:k}=crypto;async function nt(e){let t=e.tstDecryptInfo(),r=new h(t,k);await r.init(),e.setDec(async(l,s)=>o.test(l)?await r.dec(s):s);let o=/(^|\.)(sn|ssn|json|html?)$/;e.setDecAB(async l=>{let s=new DataView(l.slice(0,4)).getUint32(0,!0),u=l.slice(4,4+s),a=await r.decAb(u),n=new DataView(a.slice(1,2)).getUint8(0),i=a.slice(2),d=l.slice(4+s),p=await new Blob([i,d]).arrayBuffer();return{ext_num:n,ab:p}}),e.setEnc(l=>r.enc(l)),e.getStK(()=>t.stk),e.getHash(l=>r.uuidv5(l))}export{nt as init};
