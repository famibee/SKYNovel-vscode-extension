var t=require("fs-extra");const[,,d,w,l]=process.argv,f=require("sharp"),{BICUBIC2:u,BILINEAR:b,createICNS:$,createICO:y}=require("png2icons");f(d).metadata().then(n=>{const a={...n,err:"",exif:"",icc:"",iptc:"",xmp:""},o=(i=-1)=>{(0,t.writeJsonSync)(__filename+"on",a,{encoding:"utf8"}),i>-1&&process.exit(i)};o();const e=1024;(n.width<e||n.height<e)&&(a.err=`\u5143\u753B\u50CF\u306E\u30B5\u30A4\u30BA\u306F ${e} x ${e} \u4EE5\u4E0A\u306B\u3057\u3066\u4E0B\u3055\u3044\u3002\uFF08width:${n.width} height:${n.height}\uFF09`,o(10));const s=process.cwd()+"/",h=f(d).png().resize({width:e,height:e,fit:"cover",background:{r:0,g:0,b:0,alpha:0}});switch(parseInt(w)){case 1:h.composite([{input:Buffer.from(`<svg><circle cx="${e/2}" cy="${e/2}" r="${e/2}"/></svg>`),blend:"dest-in"}]);break;case 2:h.composite([{input:Buffer.from(`<svg><rect width="${e}" height="${e}" rx="${e/4.5}" ry="${e/4.5}"/></svg>`),blend:"dest-in"}]);break}h.toFile(s+l).then(async()=>{const i=s+"build/icon.png";if(!(0,t.existsSync)(i))return;const g=(await(0,t.stat)(i)).mtimeMs,m=await(0,t.readFile)(i);await(0,t.ensureDir)(s+"build/icon/"),await Promise.allSettled([async()=>{const c=s+"build/icon/icon.icns",p=(0,t.existsSync)(c)?(await(0,t.stat)(c)).mtimeMs:0;if(g>p){const r=$(m,b,0);r&&await(0,t.writeFile)(c,r)}},async()=>{const c=s+"build/icon/icon.ico",p=(0,t.existsSync)(c)?(await(0,t.stat)(c)).mtimeMs:0;if(g>p){const r=y(m,u,0,!1,!0);r&&await(0,t.writeFile)(c,r)}},()=>(0,t.copy)(i,s+"doc/app/icon.png")].map(c=>c())).then(()=>process.exit(0))}).catch(i=>{a.err=i.message,o(20)})});
