var t=require("fs-extra");const[,,g,f,l]=process.argv,d=require("sharp"),{BICUBIC2:u,BILINEAR:w,createICNS:b,createICO:y}=require("png2icons");d(g).metadata().then(n=>{const r={...n,err:"",exif:"",icc:"",iptc:"",xmp:""},o=(i=-1)=>{(0,t.writeJsonSync)(__filename+"on",r,{encoding:"utf8"}),i>-1&&process.exit(i)};o(),(n.width<1024||n.height<1024)&&(r.err=`\u5143\u753B\u50CF\u306E\u30B5\u30A4\u30BA\u306F 1024 x 1024 \u4EE5\u4E0A\u306B\u3057\u3066\u4E0B\u3055\u3044\u3002\uFF08width:${n.width} height:${n.height}\uFF09`,o(10));const c=process.cwd()+"/",p=d(g).png().resize({width:1024,height:1024,fit:"cover",background:{r:0,g:0,b:0,alpha:0}});f=="true"&&p.composite([{input:Buffer.from(`<svg><circle cx="${512}" cy="${512}" r="${512}"/></svg>`),blend:"dest-in"}]),p.toFile(c+l).then(async()=>{const i=c+"build/icon.png";if(!(0,t.existsSync)(i))return;const h=(await(0,t.stat)(i)).mtimeMs,m=await(0,t.readFile)(i);await(0,t.ensureDir)(c+"build/icon/"),await Promise.allSettled([async()=>{const e=c+"build/icon/icon.icns",a=(0,t.existsSync)(e)?(await(0,t.stat)(e)).mtimeMs:0;if(h>a){const s=b(m,w,0);s&&await(0,t.writeFile)(e,s)}},async()=>{const e=c+"build/icon/icon.ico",a=(0,t.existsSync)(e)?(await(0,t.stat)(e)).mtimeMs:0;if(h>a){const s=y(m,u,0,!1,!0);s&&await(0,t.writeFile)(e,s)}},()=>(0,t.copy)(i,c+"doc/app/icon.png")].map(e=>e())).then(()=>process.exit(0))}).catch(i=>{r.err=i.message,o(20)})});
